<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì ê²€í‘œ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</title>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-section {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 { color: #333; }
    h2 { color: #0052CC; margin-top: 0; }
    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 4px;
      font-weight: bold;
      margin-left: 10px;
    }
    .status.success { background: #4CAF50; color: white; }
    .status.error { background: #F44336; color: white; }
    .status.pending { background: #FF9800; color: white; }
    .inspection-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    .inspection-card {
      border: 2px solid #ddd;
      padding: 15px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .inspection-card:hover {
      border-color: #0052CC;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .inspection-card h3 {
      margin: 0 0 10px 0;
      color: #333;
    }
    .inspection-card p {
      margin: 5px 0;
      font-size: 14px;
      color: #666;
    }
    .rating {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 12px;
    }
    .rating.ì•ˆì „ { background: #4CAF50; color: white; }
    .rating.ê´€ì‹¬ { background: #2196F3; color: white; }
    .rating.ì£¼ì˜ { background: #FF9800; color: white; }
    .rating.ê²½ê³„ { background: #FF5722; color: white; }
    .rating.ìœ„í—˜ { background: #F44336; color: white; }
    pre {
      background: #f4f4f4;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }
    .btn {
      background: #0052CC;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
    }
    .btn:hover {
      background: #003d99;
    }
    .btn.secondary {
      background: #4CAF50;
    }
    .btn.secondary:hover {
      background: #388E3C;
    }
  </style>
</head>
<body>
  <h1>ğŸ§ª TLSM ì ê²€í‘œ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h1>

  <!-- 1. DataLoader í…ŒìŠ¤íŠ¸ -->
  <div class="test-section">
    <h2>1. DataLoader ëª¨ë“ˆ ë¡œë“œ í…ŒìŠ¤íŠ¸</h2>
    <div id="dataloader-status">í…ŒìŠ¤íŠ¸ ì¤‘...</div>
  </div>

  <!-- 2. ì „ì²´ ì ê²€í‘œ ë¡œë“œ í…ŒìŠ¤íŠ¸ -->
  <div class="test-section">
    <h2>2. ì „ì²´ ì ê²€í‘œ ë°ì´í„° ë¡œë“œ (12ê°œ)</h2>
    <div id="inspections-status">ë¡œë”© ì¤‘...</div>
    <div id="inspections-list" class="inspection-list"></div>
  </div>

  <!-- 3. ê°œë³„ ì ê²€í‘œ ìƒì„¸ í…ŒìŠ¤íŠ¸ -->
  <div class="test-section">
    <h2>3. ê°œë³„ ì ê²€í‘œ ìƒì„¸ ë³´ê¸°</h2>
    <button class="btn" onclick="testInspection('pl1_wall')">pl1_wall (ì„ì¶•)</button>
    <button class="btn" onclick="testInspection('pt2_tree')">pt2_tree (ë‹¨ì¼ëª©)</button>
    <button class="btn" onclick="testInspection('pt4_grove')">pt4_grove (êµ°ë½)</button>
    <button class="btn" onclick="testInspection('pt5_chimney')">pt5_chimney (êµ´ëš)</button>
    <button class="btn" onclick="testInspection('drain')">drain (ì§‘ìˆ˜ì •)</button>
    <div id="detail-result" style="margin-top: 15px;"></div>
  </div>

  <!-- 4. í¼ ë Œë”ë§ í…ŒìŠ¤íŠ¸ -->
  <div class="test-section">
    <h2>4. ë™ì  í¼ ë Œë”ë§ í…ŒìŠ¤íŠ¸</h2>
    <button class="btn secondary" onclick="testForm('pl1_wall')">ì„ì¶• í¼</button>
    <button class="btn secondary" onclick="testForm('pt2_tree')">ë‹¨ì¼ëª© í¼</button>
    <button class="btn secondary" onclick="testForm('pt4_grove')">êµ°ë½ í¼</button>
    <button class="btn secondary" onclick="testForm('pt5_chimney')">êµ´ëš í¼</button>
    <button class="btn secondary" onclick="testForm('drain')">ì§‘ìˆ˜ì • í¼</button>
    <div id="form-result" style="margin-top: 15px;"></div>
  </div>

  <!-- 5. í˜ì´ì§€ ë§í¬ í…ŒìŠ¤íŠ¸ -->
  <div class="test-section">
    <h2>5. ì‹¤ì œ í˜ì´ì§€ í…ŒìŠ¤íŠ¸</h2>
    <p>ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‹¤ì œ í˜ì´ì§€ë¥¼ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”:</p>
    <a href="site-detail.html" class="btn" target="_blank">ğŸ“ site-detail.html (ì§€ë„ + ì ê²€ ì´ë ¥)</a>
    <a href="inspection-confirm.html?id=pl1_wall" class="btn" target="_blank">ğŸ“‹ inspection-confirm.html (ë³´ê³ ì„œ)</a>
    <a href="inspection-checklist.html?id=pl1_wall" class="btn secondary" target="_blank">âœï¸ inspection-checklist.html (ì ê²€í‘œ ìˆ˜ì •)</a>
  </div>

  <script src="js/data-loader.js"></script>
  <script src="js/form-renderer.js"></script>
  <script>
    // 1. DataLoader ëª¨ë“ˆ í…ŒìŠ¤íŠ¸
    function testDataLoader() {
      const status = document.getElementById('dataloader-status');
      if (typeof DataLoader !== 'undefined') {
        status.innerHTML = '<span class="status success">âœ“ ì„±ê³µ</span> DataLoader ëª¨ë“ˆì´ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.';
      } else {
        status.innerHTML = '<span class="status error">âœ— ì‹¤íŒ¨</span> DataLoader ëª¨ë“ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
      }
    }

    // 2. ì „ì²´ ì ê²€í‘œ ë¡œë“œ í…ŒìŠ¤íŠ¸
    async function testAllInspections() {
      const status = document.getElementById('inspections-status');
      const list = document.getElementById('inspections-list');

      try {
        const inspections = await DataLoader.loadAllInspections();

        if (inspections && inspections.length > 0) {
          status.innerHTML = `<span class="status success">âœ“ ì„±ê³µ</span> ${inspections.length}ê°œ ì ê²€í‘œ ë¡œë“œ ì™„ë£Œ`;

          list.innerHTML = inspections.map(ins => `
            <div class="inspection-card" onclick="testInspection('${ins.id}')">
              <h3>${ins.targetName}</h3>
              <p><strong>íƒ€ì…:</strong> ${ins.targetType}</p>
              <p><strong>ì¼ì:</strong> ${ins.inspectionDate}</p>
              <p><strong>íŒì •:</strong> <span class="rating ${ins.overallAssessment?.rating}">${ins.overallAssessment?.rating || 'ë¯¸í™•ì¸'}</span></p>
              <p style="font-size: 12px; color: #999;">ID: ${ins.id}</p>
            </div>
          `).join('');
        } else {
          status.innerHTML = '<span class="status error">âœ— ì‹¤íŒ¨</span> ì ê²€í‘œ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.';
        }
      } catch (error) {
        status.innerHTML = `<span class="status error">âœ— ì‹¤íŒ¨</span> ${error.message}`;
        console.error('ì ê²€í‘œ ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }

    // 3. ê°œë³„ ì ê²€í‘œ ìƒì„¸ í…ŒìŠ¤íŠ¸
    async function testInspection(id) {
      const result = document.getElementById('detail-result');
      result.innerHTML = '<p>ë¡œë”© ì¤‘...</p>';

      try {
        const inspection = await DataLoader.loadInspection(id);

        result.innerHTML = `
          <h3>${inspection.targetName}</h3>
          <pre>${JSON.stringify(inspection, null, 2)}</pre>
        `;
      } catch (error) {
        result.innerHTML = `<span class="status error">âœ— ì‹¤íŒ¨</span> ${error.message}`;
      }
    }

    // 4. í¼ ë Œë”ë§ í…ŒìŠ¤íŠ¸
    async function testForm(id) {
      const result = document.getElementById('form-result');
      result.innerHTML = '<p>ë Œë”ë§ ì¤‘...</p>';

      try {
        const inspection = await DataLoader.loadInspection(id);

        if (typeof FormRenderer === 'undefined') {
          result.innerHTML = '<span class="status error">âœ— ì‹¤íŒ¨</span> FormRenderer ëª¨ë“ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
          return;
        }

        const formHTML = FormRenderer.renderChecklistForm(
          inspection.targetType,
          inspection
        );

        result.innerHTML = `
          <h3>${inspection.targetName} - ${inspection.targetType} í¼</h3>
          <div style="border: 2px solid #ddd; padding: 20px; border-radius: 8px; background: white;">
            ${formHTML}
          </div>
        `;
      } catch (error) {
        result.innerHTML = `<span class="status error">âœ— ì‹¤íŒ¨</span> ${error.message}`;
        console.error('í¼ ë Œë”ë§ ì‹¤íŒ¨:', error);
      }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    window.addEventListener('DOMContentLoaded', () => {
      testDataLoader();
      testAllInspections();
    });
  </script>
</body>
</html>
