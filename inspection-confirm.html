<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>안전 점검 실시 - 확인하기 | 전통조경 안전지도 시범서비스</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/photo-gallery.css">

  <!-- Data Loading Modules -->
  <script src="js/data-loader.js"></script>
  <script src="js/photo-gallery.js"></script>

  <style>
    /* 확인 페이지 - 디자인 시안 기준 */
    .confirm-page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background-color: #EBF3FF;
    }

    /* Header - 디자인 시안 기준 */
    .header {
      position: relative;
      background-color: #FFFFFF;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
    }

    .header__logo {
      display: inline-flex;
      align-items: center;
      padding: 8px 20px;
      background-color: #E8F4FD;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      color: #333333;
      text-decoration: none;
    }

    .header__title {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      font-size: 18px;
      font-weight: 600;
      color: #333333;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px 120px;
    }

    /* Report Preview - 디자인 시안: 파란색 테두리(좌측/상단 강조) */
    .report-preview {
      width: 100%;
      max-width: 960px;
      background-color: #FFFFFF;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      border: 2px solid #4A90E2;
      border-left-width: 4px;
      border-top-width: 4px;
      font-family: 'KoPub Dotum', 'Noto Sans KR', sans-serif;
    }

    .report-header {
      background-color: #0052CC;
      color: #FFFFFF;
      padding: 24px;
      text-align: center;
    }

    .report-header__title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .report-header__subtitle {
      font-size: 14px;
      opacity: 0.9;
    }

    .report-body {
      padding: 32px;
    }

    .report-section {
      margin-bottom: 24px;
    }

    .report-section:last-child {
      margin-bottom: 0;
    }

    .report-section__title {
      font-size: 14px;
      font-weight: 600;
      color: #0052CC;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid #E0E0E0;
    }

    .report-info {
      display: grid;
      grid-template-columns: 120px 1fr;
      gap: 8px 16px;
    }

    .report-info__label {
      font-size: 13px;
      color: #666666;
    }

    .report-info__value {
      font-size: 13px;
      color: #333333;
      font-weight: 500;
    }

    .report-summary {
      background-color: #F5F5F5;
      border-radius: 8px;
      padding: 16px;
    }

    .report-summary__item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .report-summary__item:last-child {
      margin-bottom: 0;
    }

    .report-summary__label {
      font-size: 13px;
      color: #666666;
    }

    .report-summary__value {
      font-size: 13px;
      color: #333333;
      font-weight: 600;
    }

    .report-summary__value--warning {
      color: #FFC107;
    }

    .report-summary__value--danger {
      color: #DC3545;
    }

    /* Buttons - 디자인 시안 기준 */
    .action-buttons {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 32px;
    }

    .btn-action {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      min-width: 160px;
      height: 48px;
      padding: 0 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-submit {
      background-color: #0052CC;
      color: #FFFFFF;
      border: none;
    }

    .btn-submit:hover {
      background-color: #003D99;
    }

    .btn-download {
      background-color: #FFFFFF;
      color: #0052CC;
      border: 2px solid #0052CC;
    }

    .btn-download:hover {
      background-color: #E8F4FD;
    }

    /* Navigation Buttons - 디자인 시안 기준 */
    .nav-buttons {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      padding: 16px 24px;
      background-color: #EBF3FF;
      z-index: 100;
    }

    .btn-nav {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 24px;
      border-radius: 24px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-prev {
      background-color: #FFFFFF;
      color: #0052CC;
      border: 2px solid #0052CC;
    }

    .btn-prev:hover {
      background-color: #E8F4FD;
    }

    .btn-nav svg {
      width: 18px;
      height: 18px;
    }

    /* Modal - 디자인 시안 기준 */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 500;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background-color: #FFFFFF;
      border-radius: 16px;
      padding: 40px;
      text-align: center;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 16px 32px rgba(0, 0, 0, 0.15);
    }

    .modal__icon {
      width: 64px;
      height: 64px;
      background-color: #4CAF50;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 24px;
    }

    .modal__icon svg {
      width: 32px;
      height: 32px;
      color: #FFFFFF;
    }

    .modal__title {
      font-size: 18px;
      font-weight: 700;
      color: #333333;
      margin-bottom: 12px;
    }

    .modal__message {
      font-size: 14px;
      color: #666666;
      margin-bottom: 24px;
      line-height: 1.6;
    }

    .modal__buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .btn-modal {
      min-width: 120px;
      height: 44px;
      padding: 0 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-modal--primary {
      background-color: #0052CC;
      color: #FFFFFF;
      border: none;
    }

    .btn-modal--primary:hover {
      background-color: #003D99;
    }

    .btn-modal--secondary {
      background-color: #FFFFFF;
      color: #333333;
      border: 1px solid #D0D0D0;
    }

    .btn-modal--secondary:hover {
      background-color: #F5F5F5;
    }

    /* Footer - 디자인 시안 기준 */
    .footer {
      background-color: #1A1A1A;
      color: #FFFFFF;
      padding: 24px 40px;
    }

    .footer__content {
      max-width: 1400px;
      margin: 0 auto;
    }

    .footer__links {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      font-size: 12px;
    }

    .footer__link {
      color: #CCCCCC;
      text-decoration: none;
    }

    .footer__separator {
      color: #666666;
    }

    .footer__info {
      display: flex;
      gap: 16px;
      margin-bottom: 8px;
    }

    .footer__info-item {
      color: #999999;
      font-size: 11px;
    }

    .footer__copyright {
      color: #666666;
      font-size: 11px;
    }

    /* 점검표 테이블 - 디자인 시안 기준 */
    .checklist-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      border: 1px solid #333;
      table-layout: fixed;
    }

    .checklist-table th,
    .checklist-table td {
      border: 1px solid #D0D0D0;
      padding: 10px 8px;
      text-align: center;
      vertical-align: middle;
      word-break: keep-all;
    }

    .checklist-table th {
      background-color: #F5F5F5;
      font-weight: 600;
      color: #333;
    }

    .checklist-table .row-header {
      background-color: #FAFAFA;
      font-weight: 500;
      text-align: center;
      width: 50px;
    }

    .checklist-table .sub-header {
      background-color: #F0F0F0;
      font-weight: 600;
      width: 50px;
    }

    .checklist-table .col-item {
      width: 70px;
    }

    .checklist-table .col-rating {
      width: 100px;
    }

    .checklist-table .col-note {
      width: 80px;
    }

    /* 체크박스 스타일 */
    .check-cell {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .check-box {
      width: 14px;
      height: 14px;
      border: 1px solid #CCC;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .check-box.checked {
      background-color: #4A90E2;
      border-color: #4A90E2;
    }

    .check-box.checked::after {
      content: '';
      width: 8px;
      height: 8px;
      background-color: #FFFFFF;
    }

    .check-label {
      font-size: 11px;
      color: #333;
    }

    /* 일반 현황 테이블 */
    .status-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      border: 1px solid #333;
      margin-bottom: 16px;
    }

    .status-table th,
    .status-table td {
      border: 1px solid #D0D0D0;
      padding: 10px 12px;
      vertical-align: middle;
    }

    .status-table th {
      background-color: #F5F5F5;
      font-weight: 600;
      text-align: center;
      width: 120px;
    }

    .status-table td {
      text-align: left;
    }

    .status-table .option-group {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }

    .status-table .option-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    /* Report Judgment */
    .report-judgment {
      display: flex;
      gap: 8px;
      margin-top: 16px;
      flex-wrap: wrap;
    }

    .report-judgment__item {
      flex: 1;
      min-width: 100px;
      padding: 12px 8px;
      text-align: center;
      border: 2px solid #E0E0E0;
      border-radius: 8px;
      background-color: #FFFFFF;
    }

    .report-judgment__item--selected {
      border-color: #0052CC;
      background-color: #E8F4FD;
    }

    .report-judgment__item--selected .report-judgment__label {
      color: #0052CC;
    }

    .report-judgment__label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #333333;
      margin-bottom: 2px;
    }

    .report-judgment__desc {
      font-size: 11px;
      color: #999999;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .report-info {
        grid-template-columns: 100px 1fr;
      }

      .action-buttons {
        flex-direction: column;
      }

      .btn-action {
        width: 100%;
      }

      .checklist-table {
        font-size: 10px;
      }

      .checklist-table th,
      .checklist-table td {
        padding: 6px 4px;
      }

      .report-judgment {
        flex-direction: column;
      }

      .report-judgment__item {
        min-width: auto;
      }
    }
  </style>
</head>
<body class="confirm-page">
  <!-- Header -->
  <header class="header">
    <a href="index.html" class="header__logo">전통조경 안전지도 시범서비스</a>
    <h1 class="header__title">안전 점검 실시</h1>
    <div style="width: 180px;"></div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div class="report-preview">
      <div class="report-header">
        <h2 class="report-header__title">안전 점검 보고서</h2>
        <p class="report-header__subtitle">전통조경 안전지도 시범서비스</p>
      </div>

      <div class="report-body">
        <!-- 점검 기본 정보 (Phase 5 추가) -->
        <div class="report-section">
          <h3 class="report-section__title">점검 기본 정보</h3>
          <div class="report-info">
            <div class="report-info__label">점검 유형</div>
            <div class="report-info__value" id="inspectionTypeDisplay">-</div>

            <div class="report-info__label">대상지</div>
            <div class="report-info__value" id="siteDisplay">-</div>

            <div class="report-info__label">점검 대상</div>
            <div class="report-info__value" id="targetDisplay">-</div>

            <div class="report-info__label">점검 일자</div>
            <div class="report-info__value" id="dateDisplay">-</div>

            <div class="report-info__label">점검자</div>
            <div class="report-info__value" data-field="inspector">-</div>
          </div>
        </div>

        <!-- 일반 현황 - 디자인 시안 기준 테이블 형식 -->
        <div class="report-section">
          <h3 class="report-section__title">일반 현황</h3>
          <table class="status-table">
            <tr>
              <th>항목</th>
              <td colspan="3">내용</td>
              <th>비고</th>
            </tr>
            <tr>
              <th>재료</th>
              <td colspan="3">
                <div class="option-group">
                  <span class="option-item"><span class="check-box checked"></span> <span class="check-label">석재</span></span>
                  <span class="option-item"><span class="check-box"></span> <span class="check-label">콘크리트</span></span>
                  <span class="option-item"><span class="check-box"></span> <span class="check-label">기타(　　)</span></span>
                </div>
              </td>
              <td></td>
            </tr>
            <tr>
              <th>상단 식물 여부</th>
              <td colspan="3">
                <div class="option-group">
                  <span class="option-item"><span class="check-box checked"></span> <span class="check-label">교목</span></span>
                  <span class="option-item"><span class="check-box"></span> <span class="check-label">관목</span></span>
                  <span class="option-item"><span class="check-box checked"></span> <span class="check-label">초화류</span></span>
                  <span class="option-item"><span class="check-box"></span> <span class="check-label">없음</span></span>
                </div>
              </td>
              <td></td>
            </tr>
            <tr>
              <th>상단 시설물 여부</th>
              <td colspan="3">
                <div class="option-group">
                  <span class="option-item"><span class="check-box"></span> <span class="check-label">있음(　　)</span></span>
                  <span class="option-item"><span class="check-box checked"></span> <span class="check-label">없음</span></span>
                </div>
              </td>
              <td></td>
            </tr>
            <tr>
              <th>상단 경사 여부</th>
              <td colspan="3">
                <div class="option-group">
                  <span class="option-item"><span class="check-box"></span> <span class="check-label">있음</span></span>
                  <span class="option-item"><span class="check-box checked"></span> <span class="check-label">없음</span></span>
                </div>
              </td>
              <td></td>
            </tr>
          </table>
        </div>

        <!-- 점검 항목 - 디자인 시안 기준 테이블 형식 -->
        <div class="report-section">
          <h3 class="report-section__title">점검 항목</h3>
          <table class="checklist-table">
            <colgroup>
              <col style="width: 50px;"><!-- 대분류 -->
              <col style="width: 50px;"><!-- 중분류 -->
              <col style="width: 70px;"><!-- 항목명 -->
              <col style="width: 100px;"><!-- 안전 -->
              <col style="width: 100px;"><!-- 관심 -->
              <col style="width: 100px;"><!-- 주의 -->
              <col style="width: 100px;"><!-- 경계 -->
              <col style="width: 100px;"><!-- 위험 -->
              <col style="width: 90px;"><!-- 비고 -->
            </colgroup>
            <thead>
              <tr>
                <th colspan="2" rowspan="2">구분</th>
                <th rowspan="2"></th>
                <th colspan="5">평가 척도</th>
                <th rowspan="2">비고</th>
              </tr>
              <tr>
                <th>안전</th>
                <th>관심</th>
                <th>주의</th>
                <th>경계</th>
                <th>위험</th>
              </tr>
            </thead>
            <tbody>
              <!-- 당해시설 - 기초부 -->
              <tr>
                <td rowspan="12" class="sub-header">당해<br>시설<br>(12)</td>
                <td rowspan="3" class="row-header">기초부</td>
                <td>세굴</td>
                <td><span class="check-cell"><span class="check-box checked"></span> 없음</span></td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td><span class="check-cell"><span class="check-box"></span> 있음</span></td>
                <td></td>
              </tr>
              <tr>
                <td>침하</td>
                <td><span class="check-cell"><span class="check-box checked"></span> 없음</span></td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td><span class="check-cell"><span class="check-box"></span> 있음</span></td>
                <td></td>
              </tr>
              <tr>
                <td>우수침투흔</td>
                <td><span class="check-cell"><span class="check-box checked"></span> 없음</span></td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td><span class="check-cell"><span class="check-box"></span> 있음</span></td>
                <td></td>
              </tr>
              <!-- 당해시설 - 전면부 -->
              <tr>
                <td rowspan="9" class="row-header">전면부</td>
                <td>균열</td>
                <td><span class="check-cell"><span class="check-box"></span> 없음</span></td>
                <td><span class="check-cell"><span class="check-box"></span> 경미</span></td>
                <td><span class="check-cell"><span class="check-box checked"></span> 심각(국부)</span></td>
                <td><span class="check-cell"><span class="check-box"></span> 심각(광대)</span></td>
                <td><span class="check-cell"><span class="check-box"></span> 파괴예상</span></td>
                <td></td>
              </tr>
              <tr>
                <td>파손·탈락</td>
                <td><span class="check-cell"><span class="check-box"></span> 없음</span></td>
                <td><span class="check-cell"><span class="check-box checked"></span> 경미</span></td>
                <td><span class="check-cell"><span class="check-box"></span> 심각(국부)</span></td>
                <td><span class="check-cell"><span class="check-box"></span> 심각(광대)</span></td>
                <td><span class="check-cell"><span class="check-box"></span> 파괴예상</span></td>
                <td></td>
              </tr>
              <tr>
                <td>열화</td>
                <td><span class="check-cell"><span class="check-box"></span> 없음</span></td>
                <td><span class="check-cell"><span class="check-box"></span> 경미</span></td>
                <td><span class="check-cell"><span class="check-box checked"></span> 심각(국부)</span></td>
                <td><span class="check-cell"><span class="check-box"></span> 심각(광대)</span></td>
                <td><span class="check-cell"><span class="check-box"></span> 파괴예상</span></td>
                <td style="font-size:10px;">풍화, 배흘,<br>벌리박락, 탄화/<br>철근 노출</td>
              </tr>
              <tr>
                <td>누수흔</td>
                <td><span class="check-cell"><span class="check-box"></span> 없음</span></td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td><span class="check-cell"><span class="check-box checked"></span> 있음</span></td>
                <td>지의류</td>
              </tr>
              <tr>
                <td>유실-채움재</td>
                <td><span class="check-cell"><span class="check-box"></span> 없음</span></td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td><span class="check-cell"><span class="check-box checked"></span> 있음</span></td>
                <td></td>
              </tr>
              <tr>
                <td>유실-줄눈</td>
                <td><span class="check-cell"><span class="check-box"></span> 없음</span></td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td><span class="check-cell"><span class="check-box checked"></span> 있음</span></td>
                <td></td>
              </tr>
              <tr>
                <td>변형</td>
                <td><span class="check-cell"><span class="check-box checked"></span> 없음</span></td>
                <td><span class="check-cell"><span class="check-box"></span> 경미</span></td>
                <td><span class="check-cell"><span class="check-box"></span> 심각(국부)</span></td>
                <td><span class="check-cell"><span class="check-box"></span> 심각(광대)</span></td>
                <td><span class="check-cell"><span class="check-box"></span> 파괴예상</span></td>
                <td style="font-size:10px;">기울기, 배부름<br>등 석렬이탈</td>
              </tr>
              <tr>
                <td>배수공</td>
                <td><span class="check-cell"><span class="check-box"></span> 양호</span></td>
                <td><span class="check-cell"><span class="check-box checked"></span> 없음</span></td>
                <td><span class="check-cell"><span class="check-box"></span> 불량</span></td>
                <td>-</td>
                <td>-</td>
                <td></td>
              </tr>
              <tr>
                <td>낙석 흔적</td>
                <td><span class="check-cell"><span class="check-box checked"></span> 없음</span></td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td><span class="check-cell"><span class="check-box"></span> 있음</span></td>
                <td></td>
              </tr>
              <!-- 추가 피해 요소 -->
              <tr>
                <td rowspan="3" class="sub-header">추가<br>피해<br>요소<br>(3)</td>
                <td class="row-header">상부</td>
                <td>지반 침하<br>여부</td>
                <td><span class="check-cell"><span class="check-box checked"></span> 없음</span></td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td><span class="check-cell"><span class="check-box"></span> 있음</span></td>
                <td></td>
              </tr>
              <tr>
                <td rowspan="2" class="row-header">인접<br>요소</td>
                <td>위치</td>
                <td><span class="check-cell"><span class="check-box"></span> 없음</span></td>
                <td>-</td>
                <td><span class="check-cell"><span class="check-box checked"></span> 석축·옹벽<br>높이 2배 이내</span></td>
                <td>-</td>
                <td><span class="check-cell"><span class="check-box"></span> 석축·옹벽<br>높이 1/2배 이내</span></td>
                <td></td>
              </tr>
              <tr>
                <td>유형</td>
                <td><span class="check-cell"><span class="check-box"></span> 건조물</span></td>
                <td><span class="check-cell"><span class="check-box"></span> 시설물</span></td>
                <td><span class="check-cell"><span class="check-box"></span> 보행로</span></td>
                <td><span class="check-cell"><span class="check-box checked"></span> 수목</span></td>
                <td><span class="check-cell"><span class="check-box"></span> 기타</span></td>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- 예상 피해 유형 -->
        <div class="report-section" id="damageTypeSection">
          <h3 class="report-section__title">예상 피해 유형 (중복가능)</h3>
          <div class="option-group damage-type-options" style="padding: 12px 0;">
            <span class="option-item" data-type="손상"><span class="check-box"></span> <span class="check-label">손상</span></span>
            <span class="option-item" data-type="침하"><span class="check-box"></span> <span class="check-label">침하</span></span>
            <span class="option-item" data-type="전도"><span class="check-box"></span> <span class="check-label">전도</span></span>
            <span class="option-item" data-type="배부름"><span class="check-box"></span> <span class="check-label">배부름</span></span>
            <span class="option-item" data-type="붕괴"><span class="check-box"></span> <span class="check-label">붕괴</span></span>
          </div>
        </div>

        <!-- 종합 판정 -->
        <div class="report-section">
          <h3 class="report-section__title">종합 판정</h3>
          <div class="report-info" style="margin-bottom: 16px;">
            <div class="report-info__label">판정 등급</div>
            <div class="report-info__value" data-field="rating" style="font-weight: 700; font-size: 16px;">-</div>

            <div class="report-info__label">점검자 의견</div>
            <div class="report-info__value" data-field="inspectorOpinion" style="grid-column: 2; white-space: pre-wrap;">(의견 없음)</div>
          </div>
          <div style="font-size: 13px; font-weight: 500; color: #333; margin-bottom: 12px;">점검 결과에 따른 보수 필요성</div>
          <div class="report-judgment">
            <div class="report-judgment__item" data-rating="안전">
              <span class="report-judgment__label">안전</span>
              <span class="report-judgment__desc">(현상유지)</span>
            </div>
            <div class="report-judgment__item" data-rating="관심">
              <span class="report-judgment__label">관심</span>
              <span class="report-judgment__desc">(모니터링)</span>
            </div>
            <div class="report-judgment__item" data-rating="주의">
              <span class="report-judgment__label">주의</span>
              <span class="report-judgment__desc">(경미보수)</span>
            </div>
            <div class="report-judgment__item" data-rating="경계">
              <span class="report-judgment__label">경계</span>
              <span class="report-judgment__desc">(수리)</span>
            </div>
            <div class="report-judgment__item" data-rating="위험">
              <span class="report-judgment__label">위험</span>
              <span class="report-judgment__desc">(즉시 조치)</span>
            </div>
          </div>
        </div>

        <!-- 사진 기록 (Phase 5 추가) -->
        <div class="report-section" id="photoSection" style="display: none;">
          <h3 class="report-section__title">사진 기록</h3>
          <div id="photoContainer" class="photo-container" style="display: flex; flex-wrap: wrap; gap: 12px;"></div>
        </div>

        <!-- 제출 버튼 (디자인 시안 기준: 제출하기만 표시) -->
        <div class="action-buttons">
          <button type="button" class="btn-action btn-submit" onclick="submitReport()">
            제출하기
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20,6 9,17 4,12"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- Navigation Buttons -->
  <div class="nav-buttons">
    <button type="button" class="btn-nav btn-prev" onclick="goBack()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5"/>
        <path d="M12 19l-7-7 7-7"/>
      </svg>
      이전
    </button>
    <div></div>
  </div>

  <!-- 제출 완료 모달 (디자인 시안 02_07_02 기준) -->
  <div class="modal-overlay" id="submitModal">
    <div class="modal" style="text-align: left;">
      <h3 class="modal__title" style="text-align: left; display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#0052CC" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="16" x2="12" y2="12"/>
          <line x1="12" y1="8" x2="12" y2="8"/>
        </svg>
        알림
      </h3>
      <p class="modal__message" style="background-color: #F5F5F5; padding: 16px; border-radius: 8px; margin-bottom: 24px;">제출 완료되었습니다.</p>
      <div class="modal__buttons" style="display: flex; gap: 12px;">
        <button type="button" class="btn-modal btn-modal--secondary" style="flex: 1; display: flex; align-items: center; justify-content: center; gap: 6px;" onclick="downloadReport()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
            <polyline points="7,10 12,15 17,10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          보고서 다운로드
        </button>
        <button type="button" class="btn-modal btn-modal--primary" style="flex: 1;" onclick="goHome()">
          종료
        </button>
      </div>
    </div>
  </div>

  <!-- 다운로드 완료 모달 -->
  <div class="modal-overlay" id="downloadModal">
    <div class="modal">
      <div class="modal__icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
          <polyline points="20,6 9,17 4,12"/>
        </svg>
      </div>
      <h3 class="modal__title">다운로드 완료</h3>
      <p class="modal__message">보고서 다운로드가 완료되었습니다.</p>
      <div class="modal__buttons">
        <button type="button" class="btn-modal btn-modal--primary" onclick="closeDownloadModal()">
          확인
        </button>
      </div>
    </div>
  </div>

  <script>
    // URL 파라미터
    const urlParams = new URLSearchParams(window.location.search);
    const inspectionId = urlParams.get('id'); // 새로운 방식: inspection ID
    const siteId = urlParams.get('site') || '3';
    const inspectionType = urlParams.get('type') || 'regular';
    const target = urlParams.get('target') || '석축 및 옹벽';

    // sessionStorage에서 점검 데이터 불러오기
    let inspectionData = JSON.parse(sessionStorage.getItem('inspectionData') || '{}');

    // 전역 변수로 현재 점검표 저장
    window.currentInspection = null;

    // 사이트 정보 (설계서 기준: 낙선재, 주합루, 의두합)
    const sites = {
      1: '창덕궁 낙선재 권역',
      2: '창덕궁 주합루 권역',
      3: '창덕궁 의두합 권역'
    };

    // 화면 초기화 (ID가 존재하는 경우에만 업데이트)
    const inspectionTypeEl = document.getElementById('inspectionTypeDisplay');
    const siteEl = document.getElementById('siteDisplay');
    const targetEl = document.getElementById('targetDisplay');
    const dateEl = document.getElementById('dateDisplay');

    // sessionStorage 데이터가 있으면 우선 사용, 없으면 URL 파라미터 사용
    if (inspectionTypeEl) inspectionTypeEl.textContent = inspectionData.inspectionTypeName || (inspectionType === 'regular' ? '정기점검' : '상시점검');
    if (siteEl) siteEl.textContent = (inspectionData.basicInfo && inspectionData.basicInfo['국가유산명']) || sites[siteId] || '창덕궁 낙선재 권역';
    if (targetEl) targetEl.textContent = inspectionData.target || decodeURIComponent(target);
    if (dateEl) dateEl.textContent = inspectionData.inspectionDate || new Date().toLocaleDateString('ko-KR').replace(/\./g, '.').slice(0, -1);

    // 일반현황 정보 업데이트
    function updateBasicInfo() {
      if (inspectionData.basicInfo) {
        // 국가유산유형
        const typeEl = document.querySelector('.report-info__value');
        if (typeEl && inspectionData.basicInfo['국가유산유형']) {
          typeEl.textContent = inspectionData.basicInfo['국가유산유형'];
        }

        // 소재지
        const addressEl = document.querySelectorAll('.report-info__value')[1];
        if (addressEl && inspectionData.basicInfo['소재지']) {
          addressEl.textContent = inspectionData.basicInfo['소재지'];
        }

        // 소유자/관리자
        const ownerEl = document.querySelectorAll('.report-info__value')[2];
        if (ownerEl && inspectionData.basicInfo['소유자관리자']) {
          ownerEl.textContent = inspectionData.basicInfo['소유자관리자'];
        }

        // 관리 항목 체크박스 업데이트
        if (inspectionData.basicInfo['관리항목']) {
          const items = inspectionData.basicInfo['관리항목'];
          const checkItems = document.querySelectorAll('.management-item');
          checkItems.forEach(item => {
            const label = item.querySelector('.check-label')?.textContent;
            const checkbox = item.querySelector('.check-box');
            if (checkbox && label) {
              if (items[label]) {
                checkbox.classList.add('checked');
              } else {
                checkbox.classList.remove('checked');
              }
            }
          });
        }
      }
    }

    // 점검결과 업데이트
    function updateResultInfo() {
      if (inspectionData.result && inspectionData.result.rating) {
        const rating = inspectionData.result.rating;
        const judgmentItems = document.querySelectorAll('.report-judgment__item');

        judgmentItems.forEach(item => {
          const itemRating = item.getAttribute('data-rating');
          if (itemRating === rating) {
            item.classList.add('report-judgment__item--selected');
          } else {
            item.classList.remove('report-judgment__item--selected');
          }
        });
      }
    }

    // 종합판정 업데이트
    function updateFinalInfo() {
      if (inspectionData.final) {
        // 예상 피해 유형
        if (inspectionData.final.damageTypes && inspectionData.final.damageTypes.length > 0) {
          const damageItems = document.querySelectorAll('.damage-type-options .option-item');
          damageItems.forEach(item => {
            const damageType = item.getAttribute('data-type');
            const checkbox = item.querySelector('.check-box');
            if (checkbox && damageType) {
              if (inspectionData.final.damageTypes.includes(damageType)) {
                checkbox.classList.add('checked');
              } else {
                checkbox.classList.remove('checked');
              }
            }
          });
        }

        // 조사자 의견
        const opinionEl = document.getElementById('inspectorOpinion');
        if (opinionEl) {
          if (inspectionData.final.opinion && inspectionData.final.opinion.trim()) {
            opinionEl.textContent = inspectionData.final.opinion;
          } else {
            opinionEl.textContent = '(의견 없음)';
          }
        }
      }
    }

    // 페이지 로드 시 데이터 업데이트
    updateBasicInfo();
    updateResultInfo();
    updateFinalInfo();

    // 이전 버튼
    function goBack() {
      window.location.href = `inspection-final.html?site=${siteId}&type=${inspectionType}&target=${encodeURIComponent(target)}`;
    }

    // 제출하기
    function submitReport() {
      document.getElementById('submitModal').classList.add('active');
    }

    // 보고서 다운로드
    function downloadReport() {
      document.getElementById('submitModal').classList.remove('active');
      document.getElementById('downloadModal').classList.add('active');
    }

    // 다운로드 모달 닫기
    function closeDownloadModal() {
      document.getElementById('downloadModal').classList.remove('active');
    }

    // 홈으로
    function goHome() {
      window.location.href = 'index.html';
    }

    // 모달 바깥 클릭 시 닫기
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', function(e) {
        if (e.target === this) {
          this.classList.remove('active');
        }
      });
    });

    // ESC 키로 모달 닫기
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
          overlay.classList.remove('active');
        });
      }
    });

    // ============================================================
    // 실제 점검표 데이터 로딩 (Phase 5)
    // ============================================================

    // 점검표 데이터 로드 및 렌더링
    async function loadInspectionData(inspectionId) {
      try {
        console.log('Loading inspection data for:', inspectionId);

        // 데이터 로더를 통해 점검표 로드
        const inspection = await DataLoader.loadInspection(inspectionId);

        if (!inspection) {
          console.error('Inspection not found:', inspectionId);
          return;
        }

        console.log('Loaded inspection:', inspection);
        window.currentInspection = inspection;

        // 페이지 렌더링
        renderInspectionData(inspection);
        renderPhotos(inspection);

      } catch (error) {
        console.error('Failed to load inspection:', error);
      }
    }

    // 점검표 데이터를 페이지에 렌더링
    function renderInspectionData(inspection) {
      // 헤더 정보
      const inspectionTypeEl = document.getElementById('inspectionTypeDisplay');
      const siteEl = document.getElementById('siteDisplay');
      const targetEl = document.getElementById('targetDisplay');
      const dateEl = document.getElementById('dateDisplay');

      if (inspectionTypeEl) inspectionTypeEl.textContent = inspection.targetType || '정기점검';
      if (siteEl) siteEl.textContent = inspection.site || '낙선재 권역';
      if (targetEl) targetEl.textContent = inspection.targetName || '';
      if (dateEl) dateEl.textContent = inspection.inspectionDate || new Date().toLocaleDateString('ko-KR');

      // 점검자 정보 (있는 경우)
      const inspectorEl = document.querySelector('[data-field="inspector"]');
      if (inspectorEl && inspection.inspector) {
        inspectorEl.textContent = inspection.inspector;
      }

      // 일반 현황 정보
      if (inspection.generalInfo) {
        renderGeneralInfo(inspection.generalInfo);
      }

      // 점검 항목
      if (inspection.checklistItems) {
        console.log('Rendering checklist items:', inspection.checklistItems);
        // 점검 항목 구조는 타입마다 다르므로 일반적인 처리만
        // 실제 세부 렌더링은 타입별로 처리 필요
      }

      // 종합 판정
      if (inspection.overallAssessment) {
        renderOverallAssessment(inspection.overallAssessment);
      }
    }

    // 일반 현황 정보 렌더링
    function renderGeneralInfo(generalInfo) {
      // 위치
      const locationEl = document.querySelector('[data-field="location"]');
      if (locationEl && generalInfo.location) {
        locationEl.textContent = generalInfo.location;
      }

      // 코드
      const codeEl = document.querySelector('[data-field="code"]');
      if (codeEl && generalInfo.code) {
        codeEl.textContent = generalInfo.code;
      }

      // extractedText가 있으면 표시 (디버깅용)
      if (generalInfo.extractedText) {
        console.log('Extracted text available:', generalInfo.extractedText.substring(0, 200) + '...');
      }
    }

    // 종합 판정 렌더링
    function renderOverallAssessment(assessment) {
      // 판정 등급 표시
      const ratingEl = document.querySelector('[data-field="rating"]');
      if (ratingEl && assessment.rating) {
        ratingEl.textContent = assessment.rating;
        // 등급별 색상
        const colors = {
          '안전': '#4CAF50',
          '관심': '#2196F3',
          '주의': '#FF9800',
          '경계': '#FF5722',
          '위험': '#F44336'
        };
        ratingEl.style.color = colors[assessment.rating] || '#333';
      }

      // 종합 판정 등급 (기존 선택 UI)
      const ratingEls = document.querySelectorAll('.report-judgment__item');
      ratingEls.forEach(el => {
        const itemRating = el.getAttribute('data-rating');
        if (itemRating === assessment.rating) {
          el.classList.add('report-judgment__item--selected');
        } else {
          el.classList.remove('report-judgment__item--selected');
        }
      });

      // 점검자 의견
      const opinionEl = document.querySelector('[data-field="inspectorOpinion"]');
      if (opinionEl && assessment.inspectorOpinion) {
        opinionEl.textContent = assessment.inspectorOpinion;
      }
    }

    // 사진 렌더링
    function renderPhotos(inspection) {
      if (!inspection.photos || inspection.photos.length === 0) {
        console.warn('No photos found for inspection:', inspection.id);
        return;
      }

      console.log('Rendering photos:', inspection.photos.length);

      // 사진 URL 생성
      const photoUrls = DataLoader.getPhotoUrls(inspection);

      // 사진 섹션 및 컨테이너 찾기
      const photoSection = document.getElementById('photoSection');
      const photoContainer = document.getElementById('photoContainer');

      if (photoContainer && photoUrls.length > 0) {
        // 사진 섹션 표시
        if (photoSection) {
          photoSection.style.display = 'block';
        }

        // 썸네일 그리드 생성
        photoContainer.innerHTML = photoUrls.map((url, index) => `
          <img src="${url}"
               alt="점검 사진 ${index + 1}"
               class="photo-thumbnail"
               onclick="openPhotoGallery(${index})"
               style="width: 150px; height: 150px; object-fit: cover; cursor: pointer; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"
               onerror="console.error('Failed to load:', this.src); this.style.display='none';">
        `).join('');

        console.log('Photos rendered successfully:', photoUrls.length);
      } else {
        console.warn('Photo container not found or no photo URLs');
      }
    }

    // 사진 갤러리 열기
    function openPhotoGallery(startIndex) {
      if (!window.currentInspection || !window.currentInspection.photos) {
        console.error('No inspection data available');
        return;
      }

      const photoUrls = DataLoader.getPhotoUrls(window.currentInspection);

      // PhotoGallery 모듈 사용
      const galleryContainer = document.getElementById('photoGalleryContainer') ||
                              document.body.appendChild(Object.assign(document.createElement('div'), {id: 'photoGalleryContainer'}));

      PhotoGallery.init('photoGalleryContainer', photoUrls);
      PhotoGallery.openModal(startIndex);
    }

    // 페이지 로드 시 실행
    window.addEventListener('DOMContentLoaded', async function() {
      console.log('Page loaded, inspectionId:', inspectionId);

      if (inspectionId) {
        // 새로운 방식: inspection ID로 데이터 로드
        await loadInspectionData(inspectionId);
      } else {
        // 기존 방식: sessionStorage 또는 URL 파라미터 사용
        console.log('Using legacy flow (no inspection ID)');
        updateBasicInfo();
        updateResultInfo();
        updateFinalInfo();
      }
    });
  </script>
</body>
</html>
