<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>안전 점검 실시 - 점검항목 | 전통조경 안전지도 시범서비스</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/components.css">

  <style>
    /* 점검 페이지 - 통일된 디자인 */
    .inspection-page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background-color: var(--color-bg-page);
    }

    /* Header - 통일된 스타일 */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background-color: var(--color-bg-white);
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      z-index: var(--z-header);
      box-shadow: var(--shadow-sm);
    }

    .header__logo {
      display: inline-flex;
      align-items: center;
      padding: 8px 20px;
      background-color: var(--color-logo-bg);
      border-radius: var(--radius-full);
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-semibold);
      color: var(--color-logo-text);
      text-decoration: none;
      transition: all var(--transition-fast);
    }

    .header__logo:hover {
      background-color: var(--color-primary-lighter);
    }

    .header__title {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-semibold);
      color: var(--color-text-primary);
    }

    /* Layout */
    .page-layout {
      display: flex;
      margin-top: 60px;
      min-height: calc(100vh - 60px);
    }

    /* Sidebar - 통일된 스타일 */
    .sidebar {
      width: 240px;
      background-color: var(--color-bg-white);
      border-right: 1px solid var(--color-border-light);
      padding: 16px 0;
      flex-shrink: 0;
      position: fixed;
      top: 60px;
      left: 0;
      bottom: 80px;
      overflow-y: auto;
    }

    .sidebar__item {
      padding: 14px 20px;
      font-size: var(--font-size-base);
      color: var(--color-text-primary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: all var(--transition-fast);
    }

    .sidebar__item:hover {
      background-color: var(--color-bg-gray);
    }

    .sidebar__item--active {
      background-color: var(--color-primary-light);
      color: var(--color-primary);
      font-weight: var(--font-weight-medium);
      border-left: 4px solid var(--color-primary);
      padding-left: 16px;
    }

    .sidebar__item--sub {
      padding-left: 36px;
      font-size: var(--font-size-sm);
    }

    .sidebar__item--sub.sidebar__item--active {
      padding-left: 32px;
    }

    .sidebar__arrow {
      width: 16px;
      height: 16px;
      transition: transform var(--transition-fast);
    }

    .sidebar__arrow--expanded {
      transform: rotate(180deg);
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: 240px;
      padding: 32px;
      padding-bottom: 100px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* 체크리스트 컨테이너 - 심플한 디자인 */
    .checklist-card {
      background-color: var(--color-bg-white);
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      max-width: 900px;
      width: 100%;
    }

    .checklist-card__header {
      background-color: #4A7A8C;
      color: #FFFFFF;
      padding: 14px 20px;
      font-size: 15px;
      font-weight: 600;
    }

    .checklist-card__body {
      padding: 0;
    }

    /* 체크리스트 테이블 - 설계서 기준 심플한 스타일 */
    .checklist-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    .checklist-table th,
    .checklist-table td {
      border: 1px solid #333;
      padding: 8px 4px;
      text-align: center;
      vertical-align: middle;
    }

    .checklist-table th {
      background-color: #4A7A8C;
      color: #FFFFFF;
      font-weight: 500;
      font-size: 12px;
    }

    .checklist-table .section-header {
      background-color: #4A7A8C;
      color: #FFFFFF;
      font-weight: 600;
      writing-mode: vertical-rl;
      text-orientation: mixed;
      width: 32px;
    }

    .checklist-table .sub-header {
      background-color: #6B9AAD;
      color: #FFFFFF;
      font-weight: 500;
      writing-mode: vertical-rl;
      text-orientation: mixed;
      width: 28px;
    }

    .checklist-table .item-cell {
      background-color: #E8F0F2;
      font-weight: 500;
      text-align: left;
      padding-left: 8px;
      min-width: 70px;
    }

    .checklist-table .check-cell {
      width: 55px;
      background-color: #FFFFFF;
    }

    .checklist-table .check-cell input[type="checkbox"],
    .checklist-table .check-cell input[type="radio"] {
      appearance: none;
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      border: 2px solid #B0B0B0;
      border-radius: 3px;
      cursor: pointer;
      transition: all 0.15s ease;
      position: relative;
      background-color: #FFFFFF;
    }

    .checklist-table .check-cell input[type="radio"] {
      border-radius: 50%;
    }

    .checklist-table .check-cell input[type="checkbox"]:checked,
    .checklist-table .check-cell input[type="radio"]:checked {
      background-color: #0052CC;
      border-color: #0052CC;
    }

    .checklist-table .check-cell input[type="checkbox"]:checked::after {
      content: '';
      position: absolute;
      left: 4px;
      top: 1px;
      width: 5px;
      height: 9px;
      border: solid white;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
    }

    .checklist-table .check-cell input[type="radio"]:checked::after {
      content: '';
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 6px;
      height: 6px;
      background-color: white;
      border-radius: 50%;
    }

    .checklist-table .check-cell input:hover {
      border-color: #0052CC;
    }

    .checklist-table .check-label {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      font-size: 10px;
      cursor: pointer;
    }

    .checklist-table .remark-cell {
      width: 60px;
      background-color: #F5F5F5;
    }

    .checklist-table .dash-cell {
      color: #999;
    }

    /* 추가피해요소 테이블 */
    .additional-table {
      margin-top: 20px;
    }

    /* 사진 업로드 섹션 */
    .photo-upload-section {
      margin-top: 20px;
      max-width: 900px;
      width: 100%;
    }

    .photo-upload-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      width: 100%;
      padding: 20px;
      background-color: #FFFFFF;
      border: 2px dashed #4A90E2;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 500;
      color: var(--color-primary);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .photo-upload-btn:hover {
      background-color: #E8F4FD;
      border-color: var(--color-primary);
    }

    .photo-upload-btn svg {
      width: 24px;
      height: 24px;
    }

    .photo-upload-btn input[type="file"] {
      display: none;
    }

    /* Navigation Buttons - 통일된 스타일 */
    .nav-buttons {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      padding: 16px 24px;
      background-color: var(--color-bg-page);
      z-index: var(--z-dropdown);
      border-top: 1px solid var(--color-border-light);
    }

    .btn-nav {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 28px;
      border-radius: var(--radius-full);
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-medium);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .btn-prev {
      background-color: var(--color-bg-white);
      color: var(--color-primary);
      border: 2px solid var(--color-primary);
    }

    .btn-prev:hover {
      background-color: var(--color-primary-light);
    }

    .btn-next {
      background-color: var(--color-primary);
      color: var(--color-text-white);
      border: none;
      box-shadow: 0 4px 12px rgba(0, 82, 204, 0.3);
    }

    .btn-next:hover {
      background-color: var(--color-primary-hover);
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(0, 82, 204, 0.4);
    }

    .btn-nav svg {
      width: 18px;
      height: 18px;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .sidebar {
        width: 220px;
      }

      .main-content {
        margin-left: 220px;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }

      .main-content {
        margin-left: 0;
        padding: 16px;
      }

      .checklist-card {
        overflow-x: auto;
      }

      .checklist-table {
        min-width: 700px;
      }
    }

    /* 동적 폼 스타일 */
    .form-container {
      padding: 20px;
    }

    .form-section {
      margin-bottom: 32px;
      background: var(--color-bg-white);
      padding: 24px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .form-section h3 {
      margin: 0 0 20px 0;
      padding-bottom: 12px;
      border-bottom: 2px solid var(--color-primary);
      font-size: 18px;
      font-weight: 600;
      color: var(--color-text-primary);
    }

    .form-field {
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .field-label {
      min-width: 120px;
      font-weight: 500;
      color: var(--color-text-primary);
    }

    .field-controls {
      display: flex;
      gap: 8px;
      flex: 1;
      align-items: center;
    }

    .status-select,
    .severity-select,
    .grade-select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      background: white;
      cursor: pointer;
    }

    .status-select {
      min-width: 100px;
    }

    .severity-select {
      min-width: 80px;
    }

    .grade-select {
      min-width: 100px;
    }

    .remark-input {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    .info-text {
      color: var(--color-text-secondary);
      font-size: 14px;
      margin: 20px 0;
    }
  </style>
</head>
<body class="inspection-page">
  <!-- Header -->
  <header class="header">
    <a href="index.html" class="header__logo">전통조경 안전지도 시범서비스</a>
    <h1 class="header__title">안전 점검 실시</h1>
    <div style="width: 180px;"></div>
  </header>

  <!-- Page Layout -->
  <div class="page-layout">
    <!-- Sidebar - 설계서 p.14 기준 -->
    <aside class="sidebar">
      <div class="sidebar__item" onclick="location.href='inspection-general.html' + window.location.search">
        일반현황
      </div>
      <div class="sidebar__item sidebar__item--active" onclick="toggleSubmenu('checklist')">
        점검항목
        <svg class="sidebar__arrow sidebar__arrow--expanded" id="checklistArrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="6,9 12,15 18,9"/>
        </svg>
      </div>
      <div id="checklistSubmenu">
        <div class="sidebar__item sidebar__item--sub sidebar__item--active" id="facilityTab" onclick="showSection('facility')">
          당해시설
        </div>
        <div class="sidebar__item sidebar__item--sub" id="additionalTab" onclick="showSection('additional')">
          추가 피해요소
        </div>
      </div>
      <div class="sidebar__item" onclick="location.href='inspection-result.html' + window.location.search">
        점검결과
      </div>
      <div class="sidebar__item" onclick="location.href='inspection-final.html' + window.location.search">
        종합판정
      </div>
    </aside>

    <!-- Main Content - 설계서 p.14 기준: 체크리스트 이미지 + 사진 업로드 -->
    <main class="main-content">
      <!-- 당해시설 체크리스트 - 통일된 카드 디자인 -->
      <div class="checklist-card" id="facilityChecklist">
        <div class="checklist-card__header">당해시설 점검표</div>
        <div class="checklist-card__body">
        <table class="checklist-table">
          <thead>
            <tr>
              <th colspan="2">구분</th>
              <th>안전</th>
              <th>관심</th>
              <th>주의</th>
              <th>경계</th>
              <th>위험</th>
              <th>비고</th>
            </tr>
          </thead>
          <tbody>
            <!-- 기초부 -->
            <tr>
              <td class="section-header" rowspan="12">당<br>해<br>시<br>설</td>
              <td class="sub-header" rowspan="3">기<br>초<br>부</td>
            </tr>
            <tr>
              <td class="item-cell">세굴</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="scour" value="없음"> 없음</label></td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="scour" value="있음"> 있음</label></td>
              <td class="remark-cell"></td>
            </tr>
            <tr>
              <td class="item-cell">침하</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="subsidence" value="없음"> 없음</label></td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="subsidence" value="있음"> 있음</label></td>
              <td class="remark-cell"></td>
            </tr>
            <tr>
              <td class="item-cell">우수침투흔</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="rainwater" value="없음"> 없음</label></td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="rainwater" value="있음"> 있음</label></td>
              <td class="remark-cell"></td>
            </tr>
            <!-- 전면부 -->
            <tr>
              <td class="sub-header" rowspan="8">전<br>면<br>부</td>
            </tr>
            <tr>
              <td class="item-cell">균열</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="crack" value="없음"> 없음</label></td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="crack" value="경미"> 경미</label></td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="crack" value="약간심각"> 약간 심각</label></td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="crack" value="심각"> 심각</label></td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="crack" value="매우심각"> 매우 심각</label></td>
              <td class="remark-cell"></td>
            </tr>
            <tr>
              <td class="item-cell">파손·탈락</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="damage" value="없음"> 없음</label></td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="damage" value="경미"> 경미</label></td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="damage" value="약간심각"> 약간 심각</label></td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="damage" value="심각"> 심각</label></td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="damage" value="매우심각"> 매우 심각</label></td>
              <td class="remark-cell"></td>
            </tr>
            <tr>
              <td class="item-cell">열화</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="deterioration" value="없음"> 없음</label></td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="deterioration" value="경미"> 경미</label></td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="deterioration" value="약간심각"> 약간 심각</label></td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="deterioration" value="심각"> 심각</label></td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="deterioration" value="매우심각"> 매우 심각</label></td>
              <td class="remark-cell"></td>
            </tr>
            <tr>
              <td class="item-cell">누수흔</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="leakage" value="없음"> 없음</label></td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="leakage" value="있음"> 있음</label></td>
              <td class="remark-cell"></td>
            </tr>
            <tr>
              <td class="item-cell">채움재 유실</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="filling" value="없음"> 없음</label></td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="filling" value="있음"> 있음</label></td>
              <td class="remark-cell"></td>
            </tr>
            <tr>
              <td class="item-cell">줄눈 유실</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="joint" value="없음"> 없음</label></td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="joint" value="있음"> 있음</label></td>
              <td class="remark-cell"></td>
            </tr>
            <tr>
              <td class="item-cell">변형</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="deformation" value="없음"> 없음</label></td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="deformation" value="경미"> 경미</label></td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="deformation" value="약간심각"> 약간 심각</label></td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="deformation" value="심각"> 심각</label></td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="deformation" value="매우심각"> 매우 심각</label></td>
              <td class="remark-cell"></td>
            </tr>
            <!-- 상단부 -->
            <tr>
              <td class="sub-header" rowspan="4">상<br>단<br>부</td>
            </tr>
            <tr>
              <td class="item-cell">배수공</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="drainage" value="원활"> 원활</label></td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="drainage" value="부분막힘"> 부분 막힘</label></td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="drainage" value="막힘"> 막힘</label></td>
              <td class="remark-cell"></td>
            </tr>
            <tr>
              <td class="item-cell">낙석 흔적</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="rockfall" value="없음"> 없음</label></td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="rockfall" value="있음"> 있음</label></td>
              <td class="remark-cell"></td>
            </tr>
            <tr>
              <td class="item-cell">지반 침하</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="groundSubsidence" value="없음"> 없음</label></td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="groundSubsidence" value="있음"> 있음</label></td>
              <td class="remark-cell"></td>
            </tr>
          </tbody>
        </table>
        </div>
      </div>

      <!-- 추가 피해요소 체크리스트 - 통일된 카드 디자인 -->
      <div class="checklist-card additional-table" id="additionalChecklist" style="display: none;">
        <div class="checklist-card__header">추가 피해요소 점검표</div>
        <div class="checklist-card__body">
        <table class="checklist-table">
          <thead>
            <tr>
              <th colspan="2">구분</th>
              <th colspan="4">평가</th>
              <th>비고</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="section-header" rowspan="4">추<br>가<br>피<br>해<br>요<br>소</td>
              <td class="item-cell">유무</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="additional_exist" value="없음"> 없음</label></td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="additional_exist" value="있음"> 있음</label></td>
              <td class="remark-cell"></td>
            </tr>
            <tr>
              <td class="item-cell">유형</td>
              <td class="check-cell"><label class="check-label"><input type="checkbox" name="additional_type" value="건조물"> 건조물</label></td>
              <td class="check-cell"><label class="check-label"><input type="checkbox" name="additional_type" value="시설물"> 시설물</label></td>
              <td class="check-cell"><label class="check-label"><input type="checkbox" name="additional_type" value="수목"> 수목</label></td>
              <td class="check-cell"><label class="check-label"><input type="checkbox" name="additional_type" value="보행로"> 보행로</label></td>
              <td class="check-cell"><label class="check-label"><input type="checkbox" name="additional_type" value="기타"> 기타(<input type="text" style="width:40px;border:none;border-bottom:1px solid #333;">)</label></td>
            </tr>
            <tr>
              <td class="item-cell">수로</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="waterway" value="원활"> 원활</label></td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="waterway" value="막힘"> 막힘</label></td>
              <td class="remark-cell"></td>
            </tr>
            <tr>
              <td class="item-cell">집수정</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="sump" value="원활"> 원활</label></td>
              <td class="check-cell dash-cell">-</td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="sump" value="부분막힘"> 부분 막힘</label></td>
              <td class="check-cell"><label class="check-label"><input type="radio" name="sump" value="막힘"> 막힘</label></td>
              <td class="remark-cell"></td>
            </tr>
          </tbody>
        </table>
        </div>
      </div>

      <!-- 사진 업로드 버튼 - 설계서: 체크리스트 하단에 사진 업로드 버튼 -->
      <div class="photo-upload-section">
        <label class="photo-upload-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2"/>
            <circle cx="8.5" cy="8.5" r="1.5"/>
            <path d="M21 15l-5-5L5 21"/>
          </svg>
          <span>사진 업로드</span>
          <input type="file" accept="image/*" multiple onchange="handlePhotoUpload(this)">
        </label>
      </div>
    </main>
  </div>

  <!-- Navigation Buttons -->
  <div class="nav-buttons">
    <button type="button" class="btn-nav btn-prev" onclick="goBack()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5"/>
        <path d="M12 19l-7-7 7-7"/>
      </svg>
      이전
    </button>
    <button type="button" class="btn-nav btn-next" onclick="goNext()">
      다음
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M5 12h14"/>
        <path d="M12 5l7 7-7 7"/>
      </svg>
    </button>
  </div>

  <!-- 외부 스크립트 로드 -->
  <script src="js/data-loader.js"></script>
  <script src="js/form-renderer.js"></script>

  <script>
    // URL 파라미터
    const urlParams = new URLSearchParams(window.location.search);
    const siteId = urlParams.get('site') || '1';
    const inspectionType = urlParams.get('type') || 'regular';
    const target = urlParams.get('target') || '석축 및 옹벽';
    const section = urlParams.get('section') || 'facility';
    const inspectionId = urlParams.get('id'); // 점검표 ID (예: pl1_wall)

    // 전역 변수
    let currentInspection = null;

    // 점검 데이터 수집 및 저장
    function collectChecklistData() {
      const checklistData = {
        facility: [],
        additional: []
      };

      // 당해시설 체크리스트 수집
      document.querySelectorAll('#facilityChecklist .checklist-table tbody tr').forEach(row => {
        const itemName = row.querySelector('td:nth-child(2)')?.textContent?.trim() || '';
        const checkedRadio = row.querySelector('input[type="radio"]:checked');
        const remarkInput = row.querySelector('input[type="text"]');

        if (itemName) {
          checklistData.facility.push({
            item: itemName,
            rating: checkedRadio ? checkedRadio.value : '',
            remark: remarkInput ? remarkInput.value : ''
          });
        }
      });

      // 추가 피해요소 체크리스트 수집
      document.querySelectorAll('#additionalChecklist .checklist-table tbody tr').forEach(row => {
        const itemName = row.querySelector('td:nth-child(2)')?.textContent?.trim() || '';
        const checkedRadio = row.querySelector('input[type="radio"]:checked');
        const remarkInput = row.querySelector('input[type="text"]');

        if (itemName) {
          checklistData.additional.push({
            item: itemName,
            rating: checkedRadio ? checkedRadio.value : '',
            remark: remarkInput ? remarkInput.value : ''
          });
        }
      });

      // sessionStorage에 저장
      const existingData = JSON.parse(sessionStorage.getItem('inspectionData') || '{}');
      existingData.checklist = checklistData;
      sessionStorage.setItem('inspectionData', JSON.stringify(existingData));
    }

    // 서브메뉴 토글
    function toggleSubmenu(id) {
      const submenu = document.getElementById(id + 'Submenu');
      const arrow = document.getElementById(id + 'Arrow');

      if (submenu.style.display === 'none') {
        submenu.style.display = 'block';
        arrow.classList.add('sidebar__arrow--expanded');
      } else {
        submenu.style.display = 'none';
        arrow.classList.remove('sidebar__arrow--expanded');
      }
    }

    // 섹션 표시 (당해시설/추가피해요소)
    function showSection(sectionType) {
      // 탭 활성화 상태 변경
      document.getElementById('facilityTab').classList.remove('sidebar__item--active');
      document.getElementById('additionalTab').classList.remove('sidebar__item--active');
      document.getElementById(sectionType + 'Tab').classList.add('sidebar__item--active');

      // 체크리스트 표시 상태 변경 (설계서: 클릭 시 해당 체크리스트 이미지 표출)
      if (sectionType === 'facility') {
        document.getElementById('facilityChecklist').style.display = 'block';
        document.getElementById('additionalChecklist').style.display = 'none';
      } else {
        document.getElementById('facilityChecklist').style.display = 'none';
        document.getElementById('additionalChecklist').style.display = 'block';
      }
    }

    // 이전 버튼
    function goBack() {
      collectChecklistData();
      window.location.href = `inspection-general.html?site=${siteId}&type=${inspectionType}&target=${encodeURIComponent(target)}`;
    }

    // 다음 버튼
    function goNext() {
      collectChecklistData();
      window.location.href = `inspection-result.html?site=${siteId}&type=${inspectionType}&target=${encodeURIComponent(target)}`;
    }

    // 사진 업로드 처리 (설계서: 실제 업로드 되지 않아도 됨 - UI만 제작)
    function handlePhotoUpload(input) {
      if (input.files && input.files.length > 0) {
        alert(`${input.files.length}개의 사진이 선택되었습니다.\n(UI 데모 - 실제 업로드는 구현되지 않음)`);
      }
    }

    // 동적 폼 로드 및 렌더링
    async function loadDynamicForm() {
      if (!inspectionId) {
        console.log('inspection ID가 없습니다. 기존 정적 폼을 사용합니다.');
        return;
      }

      try {
        console.log('점검표 로딩 중:', inspectionId);

        // DataLoader를 사용하여 점검 데이터 로드
        const inspection = await DataLoader.loadInspection(inspectionId);

        if (!inspection) {
          console.error('점검표를 찾을 수 없습니다:', inspectionId);
          alert('점검표 데이터를 찾을 수 없습니다.');
          return;
        }

        currentInspection = inspection;
        console.log('점검표 로드 완료:', inspection);

        // FormRenderer를 사용하여 동적 폼 생성
        const formHTML = FormRenderer.renderChecklistForm(
          inspection.targetType,
          inspection
        );

        // 기존 facilityChecklist를 동적 폼으로 교체
        const facilityChecklistContainer = document.getElementById('facilityChecklist');
        if (facilityChecklistContainer) {
          facilityChecklistContainer.innerHTML = `
            <div class="checklist-card__header">${inspection.targetName} 점검표</div>
            <div class="checklist-card__body">
              ${formHTML}
            </div>
          `;
        }

        // additionalChecklist 숨김 (동적 폼은 모든 섹션을 하나로 통합)
        const additionalChecklistContainer = document.getElementById('additionalChecklist');
        if (additionalChecklistContainer) {
          additionalChecklistContainer.style.display = 'none';
        }

        console.log('동적 폼 렌더링 완료');
      } catch (error) {
        console.error('폼 로딩 오류:', error);
        alert('점검표 로딩 중 오류가 발생했습니다: ' + error.message);
      }
    }

    // 페이지 로드 시 동적 폼 로드
    window.addEventListener('DOMContentLoaded', () => {
      loadDynamicForm();
    });
  </script>
</body>
</html>
