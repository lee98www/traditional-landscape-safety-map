<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ëŒ€ìƒì§€ ìƒì„¸ ì •ë³´ - ì „í†µì¡°ê²½ ì•ˆì „ì§€ë„ ì‹œë²”ì„œë¹„ìŠ¤</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="css/variables.css">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Noto Sans KR', sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ì§€ë„ ì˜ì—­ - ì „ì²´í™”ë©´ ë°°ê²½ */
    #map {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
    }

    /* ë¡œê³  - ì¢Œì¸¡ ìƒë‹¨ */
    .logo {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 100;
      display: inline-flex;
      align-items: center;
      padding: 10px 24px;
      background-color: #E8F4FD;
      border-radius: 24px;
      font-size: 14px;
      font-weight: 600;
      color: #333333;
      text-decoration: none;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      transition: all 0.2s;
    }

    .logo:hover {
      background-color: #D0E8F9;
      transform: translateY(-1px);
    }

    /* ì¢Œì¸¡ ë©”ë‰´ ë²„íŠ¼ë“¤ - ì„¤ê³„ì„œ p.5 ê¸°ì¤€ 4ê°œ */
    .side-menu {
      position: fixed;
      top: 80px;
      left: 20px;
      z-index: 100;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .menu-btn {
      display: flex;
      align-items: center;
      gap: 10px;
      width: 160px;
      padding: 14px 18px;
      background-color: #FFFFFF;
      border: 2px solid #E0E0E0;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      color: #333333;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .menu-btn:hover {
      background-color: #F0F7FF;
      border-color: #0052CC;
      transform: translateX(4px);
    }

    .menu-btn--active {
      background-color: #0052CC;
      border-color: #0052CC;
      color: #FFFFFF;
    }

    .menu-btn--active:hover {
      background-color: #003D99;
    }

    .menu-btn__icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    /* ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 200;
      justify-content: center;
      align-items: center;
    }

    .modal-overlay--active {
      display: flex;
    }

    /* ëª¨ë‹¬ ì»¨í…ì¸  */
    .modal {
      position: relative;
      width: 90%;
      max-width: 900px;
      max-height: 85vh;
      background-color: #FFFFFF;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .modal__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      background-color: #4A7A8C;
      color: #FFFFFF;
    }

    .modal__title {
      font-size: 18px;
      font-weight: 600;
    }

    .modal__close {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: 8px;
      color: #FFFFFF;
      font-size: 20px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .modal__close:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .modal__body {
      padding: 24px;
      overflow-y: auto;
      flex: 1;
    }

    /* ê¸°ë³¸ ì •ë³´ í…Œì´ë¸” */
    .info-table__section {
      margin-bottom: 24px;
    }

    .info-table__section-title {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      padding: 12px 0;
      border-bottom: 2px solid #4A7A8C;
      margin-bottom: 12px;
    }

    .info-table__row {
      display: flex;
      border-bottom: 1px solid #E5E5E5;
    }

    .info-table__label {
      width: 140px;
      padding: 12px 16px;
      background-color: #F5F8FA;
      font-size: 13px;
      font-weight: 600;
      color: #555;
      flex-shrink: 0;
    }

    .info-table__value {
      flex: 1;
      padding: 12px 16px;
      font-size: 13px;
      color: #333;
    }

    .info-table__checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }

    .info-table__checkbox {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      color: #333;
    }

    .info-table__checkbox input[type="checkbox"] {
      width: 16px;
      height: 16px;
    }

    /* ì ê²€ ì´ë ¥ - í¬ì¸íŠ¸ ë¦¬ìŠ¤íŠ¸ */
    .inspection-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .inspection-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      background-color: #F9FAFB;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .inspection-item:hover {
      background-color: #EEF4FF;
      transform: translateX(4px);
    }

    .inspection-item__icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      flex-shrink: 0;
    }

    .inspection-item__icon--report {
      background-color: #DBEAFE;
    }

    .inspection-item__icon--photo {
      background-color: #D1FAE5;
    }

    .inspection-item__icon--matterport {
      background-color: #FEE2E2;
    }

    .inspection-item__content {
      flex: 1;
    }

    .inspection-item__title {
      font-size: 15px;
      font-weight: 600;
      color: #333;
      margin-bottom: 4px;
    }

    .inspection-item__desc {
      font-size: 13px;
      color: #666;
    }

    .inspection-item__arrow {
      font-size: 18px;
      color: #999;
    }

    /* ì´ë ¥ ì´ë¯¸ì§€ í‘œì‹œ ì˜ì—­ */
    .history-content {
      padding: 20px;
    }

    .history-content__text {
      font-size: 14px;
      line-height: 1.8;
      color: #333;
      padding: 20px;
      background-color: #F9FAFB;
      border-radius: 8px;
      border-left: 4px solid #4A7A8C;
    }

    /* ì ê²€ ì´ë ¥ íŒì—… - ì„¤ê³„ì„œ p.7 â‘£ */
    .inspection-popup {
      position: fixed;
      z-index: 150;
      background-color: #FFFFFF;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
      min-width: 200px;
      display: none;
      overflow: hidden;
    }

    .inspection-popup--active {
      display: block;
    }

    .inspection-popup__header {
      padding: 12px 16px;
      background-color: #4A7A8C;
      color: #FFFFFF;
      font-size: 14px;
      font-weight: 600;
    }

    .inspection-popup__body {
      padding: 8px 0;
    }

    .inspection-popup__item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      cursor: pointer;
      transition: background 0.2s;
      font-size: 14px;
      color: #333;
    }

    .inspection-popup__item:hover {
      background-color: #F0F7FF;
    }

    .inspection-popup__item-icon {
      font-size: 18px;
    }

    /* ì ê²€ ì •ë³´ ìš”ì•½ */
    .inspection-popup__summary {
      padding: 16px;
      background-color: #F8FAFC;
      border-top: 1px solid #E5E7EB;
      font-size: 12px;
      line-height: 1.6;
      color: #374151;
    }

    .inspection-popup__summary strong {
      color: #0052CC;
      font-weight: 600;
    }

    /* ë°˜ì‘í˜• */
    @media (max-width: 768px) {
      .logo {
        font-size: 12px;
        padding: 8px 16px;
      }

      .side-menu {
        top: 70px;
        left: 10px;
      }

      .menu-btn {
        width: 140px;
        padding: 12px 14px;
        font-size: 13px;
      }

      .modal {
        width: 95%;
        max-height: 90vh;
      }

      .info-table__label {
        width: 100px;
        padding: 10px 12px;
      }
    }
  </style>
</head>
<body>
  <!-- Google Maps ì§€ë„ ì˜ì—­ -->
  <div id="map"></div>

  <!-- ì ê²€ ì´ë ¥ íŒì—… - ì„¤ê³„ì„œ p.7 â‘£ -->
  <div class="inspection-popup" id="inspectionPopup">
    <div class="inspection-popup__header" id="popupHeader">ì ê²€ í¬ì¸íŠ¸</div>
    <div class="inspection-popup__body" id="popupBody">
      <!-- JavaScriptë¡œ ë™ì  ë Œë”ë§ -->
    </div>
  </div>

  <!-- ë¡œê³  -->
  <a href="index.html" class="logo">ì „í†µì¡°ê²½ ì•ˆì „ì§€ë„ ì‹œë²”ì„œë¹„ìŠ¤</a>

  <!-- ì¢Œì¸¡ ë©”ë‰´ - ì„¤ê³„ì„œ p.5 ê¸°ì¤€ 4ê°œ ë²„íŠ¼ -->
  <div class="side-menu">
    <button class="menu-btn" data-modal="basic" id="btnBasic">
      <svg class="menu-btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="16" x2="12" y2="12"/>
        <line x1="12" y1="8" x2="12.01" y2="8"/>
      </svg>
      ê¸°ë³¸ ì •ë³´
    </button>
    <button class="menu-btn" data-modal="inspection" id="btnInspection">
      <svg class="menu-btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 11l3 3L22 4"/>
        <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/>
      </svg>
      ì ê²€ ì´ë ¥
    </button>
    <button class="menu-btn" data-modal="disaster" id="btnDisaster">
      <svg class="menu-btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/>
        <line x1="12" y1="9" x2="12" y2="13"/>
        <line x1="12" y1="17" x2="12.01" y2="17"/>
      </svg>
      ì¬í•´ ì´ë ¥
    </button>
    <button class="menu-btn" data-modal="repair" id="btnRepair">
      <svg class="menu-btn__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/>
      </svg>
      ìˆ˜ë¦¬ ì´ë ¥
    </button>
  </div>

  <!-- ê¸°ë³¸ ì •ë³´ ëª¨ë‹¬ - ì„¤ê³„ì„œ p.6 ê¸°ì¤€ -->
  <div class="modal-overlay" id="modalBasic">
    <div class="modal" style="max-width: 1000px;">
      <div class="modal__header">
        <h2 class="modal__title">ê¸°ë³¸ ì •ë³´</h2>
        <button class="modal__close" onclick="closeModal('modalBasic')">&times;</button>
      </div>
      <div class="modal__body" id="basicInfoBody">
        <!-- ì„¤ê³„ì„œ p.6 ê¸°ì¤€ í…Œì´ë¸” êµ¬ì¡° -->
        <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
          <tr>
            <td rowspan="4" style="background: #4A7A8C; color: white; text-align: center; padding: 12px; width: 80px; font-weight: 600;">êµ­ê°€<br>ìœ ì‚°<br>ê°œìš”</td>
            <td style="background: #E8F4FD; padding: 10px 16px; width: 120px; font-weight: 600;">êµ­ê°€ìœ ì‚°ëª…</td>
            <td style="padding: 10px 16px; border: 1px solid #E5E5E5;" id="infoName">ì°½ë•ê¶ ë‚™ì„ ì¬ ê¶Œì—­</td>
            <td rowspan="4" style="background: #4A7A8C; color: white; text-align: center; padding: 12px; width: 80px; font-weight: 600;">êµ­ê°€<br>ìœ ì‚°<br>ê´€ë¦¬</td>
            <td style="background: #E8F4FD; padding: 10px 16px; width: 120px;">ì¢…í•©ì •ë¹„ê³„íš</td>
            <td style="padding: 10px 16px; border: 1px solid #E5E5E5; text-align: center;"><span style="color: #0052CC; font-size: 18px;">â—</span></td>
          </tr>
          <tr>
            <td style="background: #E8F4FD; padding: 10px 16px; font-weight: 600;">êµ­ê°€ìœ ì‚°ìœ í˜•</td>
            <td style="padding: 10px 16px; border: 1px solid #E5E5E5;">ì‚¬ì </td>
            <td style="background: #E8F4FD; padding: 10px 16px;">ì •ê¸°ì¡°ì‚¬</td>
            <td style="padding: 10px 16px; border: 1px solid #E5E5E5; text-align: center;"><span style="color: #0052CC; font-size: 18px;">â—</span></td>
          </tr>
          <tr>
            <td style="background: #E8F4FD; padding: 10px 16px; font-weight: 600;">ì†Œì¬ì§€</td>
            <td style="padding: 10px 16px; border: 1px solid #E5E5E5;" id="infoAddress">ì„œìš¸íŠ¹ë³„ì‹œ ì¢…ë¡œêµ¬ ìœ¨ê³¡ë¡œ 99-0</td>
            <td style="background: #E8F4FD; padding: 10px 16px;">ëŒë´„ì‚¬ì—…</td>
            <td style="padding: 10px 16px; border: 1px solid #E5E5E5; text-align: center;">-</td>
          </tr>
          <tr>
            <td style="background: #E8F4FD; padding: 10px 16px; font-weight: 600;">ì†Œìœ ì/ê´€ë¦¬ì</td>
            <td style="padding: 10px 16px; border: 1px solid #E5E5E5;">êµ­ê°€ìœ ì‚°ì²­ ì°½ë•ê¶ê´€ë¦¬ì†Œ</td>
            <td style="background: #E8F4FD; padding: 10px 16px;">ëª¨ë‹ˆí„°ë§</td>
            <td style="padding: 10px 16px; border: 1px solid #E5E5E5; text-align: center;"><span style="color: #0052CC; font-size: 18px;">â—</span></td>
          </tr>
          <tr>
            <td colspan="3"></td>
            <td style="background: #4A7A8C; color: white; text-align: center; padding: 12px; font-weight: 600;"></td>
            <td style="background: #E8F4FD; padding: 10px 16px;">êµ­ê°€ìœ ì‚°ì§€í‚´ì´</td>
            <td style="padding: 10px 16px; border: 1px solid #E5E5E5; text-align: center;"><span style="color: #0052CC; font-size: 18px;">â—</span></td>
          </tr>
        </table>

        <!-- ì£¼ë³€í™˜ê²½ ì„¹ì…˜ -->
        <table style="width: 100%; border-collapse: collapse; font-size: 13px; margin-top: 16px;">
          <tr>
            <td rowspan="6" style="background: #4A7A8C; color: white; text-align: center; padding: 12px; width: 80px; font-weight: 600;">ì£¼ë³€<br>í™˜ê²½</td>
            <td style="background: #E8F4FD; padding: 10px 16px; width: 100px; font-weight: 600;">ë²”ëŒìœ„í—˜ìš”ì†Œ</td>
            <td style="padding: 10px 16px; border: 1px solid #E5E5E5;" colspan="5">
              <label style="margin-right: 20px;"><input type="checkbox"> ê°•, í•˜ì²œ</label>
              <label style="margin-right: 20px;"><input type="checkbox"> ê³„ê³¡</label>
              <label style="margin-right: 20px;"><input type="checkbox"> ì €ìˆ˜ì§€</label>
              <label style="margin-right: 20px;"><input type="checkbox"> ë°”ë‹¤</label>
              <label><input type="checkbox"> ê¸°íƒ€</label>
            </td>
          </tr>
          <tr>
            <td style="background: #E8F4FD; padding: 10px 16px; font-weight: 600;">ì¸ì ‘ì§€í˜•</td>
            <td style="padding: 10px 16px; border: 1px solid #E5E5E5;" colspan="5">
              <label style="margin-right: 20px;"><input type="checkbox"> ê²½ì‚¬</label>
              <label style="margin-right: 20px;"><input type="checkbox" checked> ì˜¹ë²½</label>
              <label style="margin-right: 20px;"><input type="checkbox" checked> ì „ë„ìœ„í—˜</label>
              <label style="margin-right: 20px;"><input type="checkbox"> ì ˆê°œì§€</label>
              <label><input type="checkbox"> ê¸°íƒ€</label>
            </td>
          </tr>
          <tr>
            <td style="background: #E8F4FD; padding: 10px 16px; font-weight: 600;">ì£¼ë³€ ì˜í–¥</td>
            <td style="padding: 10px 16px; border: 1px solid #E5E5E5;" colspan="5">
              <label style="margin-right: 20px;"><input type="checkbox"> ìŠµí•´</label>
              <label style="margin-right: 20px;"><input type="checkbox"> ê³µí•´</label>
              <label style="margin-right: 20px;"><input type="checkbox"> ì—¼í•´</label>
              <label style="margin-right: 20px;"><input type="checkbox"> ì§„ë™</label>
              <label><input type="checkbox"> ê¸°íƒ€</label>
            </td>
          </tr>
          <tr>
            <td style="background: #E8F4FD; padding: 10px 16px; font-weight: 600;">ê³ ì €ì°¨</td>
            <td style="padding: 10px 16px; border: 1px solid #E5E5E5;" colspan="5">
              ë‹¹í•´ êµ­ê°€ìœ ì‚°ì´ ì£¼ë³€ì§€í˜•ì— ë¹„í•´ &nbsp;&nbsp;
              <label style="margin-right: 20px;"><input type="checkbox" checked> ë‚®ìŒ</label>
              <label><input type="checkbox"> ë†’ìŒ</label>
            </td>
          </tr>
          <tr>
            <td style="background: #E8F4FD; padding: 10px 16px; font-weight: 600;">ìˆ˜ë¦¬ì¡°ê±´</td>
            <td style="padding: 10px 16px; border: 1px solid #E5E5E5;" colspan="5">
              <label style="margin-right: 20px;"><input type="checkbox" checked> dry</label>
              <label style="margin-right: 20px;"><input type="checkbox"> damp</label>
              <label style="margin-right: 20px;"><input type="checkbox"> wet</label>
              <label style="margin-right: 20px;"><input type="checkbox"> dripping</label>
              <label><input type="checkbox"> flowing</label>
            </td>
          </tr>
          <tr>
            <td style="background: #E8F4FD; padding: 10px 16px; font-weight: 600;">ê°•ìš°ì´ë ¥</td>
            <td style="padding: 10px 16px; border: 1px solid #E5E5E5;" colspan="5">
              í•´ë‹¹ ì§€ì—­ ìµœê·¼ 10ê°œë…„ ìµœëŒ€ ì¼ê°•ìš°ê°•ë„ ëˆ„ë…„ í‰ê· ê°’ê³¼ ìµœê·¼ 2ê°œë…„ ìµœëŒ€ ê°•ìš°ëŸ‰
            </td>
          </tr>
        </table>
      </div>
    </div>
  </div>

  <!-- ì ê²€ ì´ë ¥ ëª¨ë‹¬ -->
  <div class="modal-overlay" id="modalInspection">
    <div class="modal">
      <div class="modal__header">
        <h2 class="modal__title">ì ê²€ ì´ë ¥</h2>
        <button class="modal__close" onclick="closeModal('modalInspection')">&times;</button>
      </div>
      <div class="modal__body">
        <p style="font-size: 14px; color: #666; margin-bottom: 16px;">ì§€ë„ì—ì„œ ì ê²€ ì´ë ¥ í¬ì¸íŠ¸ë¥¼ ì„ íƒí•˜ê±°ë‚˜ ì•„ë˜ í•­ëª©ì„ í´ë¦­í•˜ì„¸ìš”.</p>
        <div class="inspection-list" id="inspectionList">
          <!-- JavaScriptë¡œ ë™ì  ë Œë”ë§ -->
        </div>
      </div>
    </div>
  </div>

  <!-- ì¬í•´ ì´ë ¥ ëª¨ë‹¬ -->
  <div class="modal-overlay" id="modalDisaster">
    <div class="modal">
      <div class="modal__header">
        <h2 class="modal__title">ì¬í•´ ì´ë ¥</h2>
        <button class="modal__close" onclick="closeModal('modalDisaster')">&times;</button>
      </div>
      <div class="modal__body">
        <div class="history-content" id="disasterContent">
          <!-- JavaScriptë¡œ ë™ì  ë Œë”ë§ -->
        </div>
      </div>
    </div>
  </div>

  <!-- ìˆ˜ë¦¬ ì´ë ¥ ëª¨ë‹¬ -->
  <div class="modal-overlay" id="modalRepair">
    <div class="modal">
      <div class="modal__header">
        <h2 class="modal__title">ìˆ˜ë¦¬ ì´ë ¥</h2>
        <button class="modal__close" onclick="closeModal('modalRepair')">&times;</button>
      </div>
      <div class="modal__body">
        <div class="history-content" id="repairContent">
          <!-- JavaScriptë¡œ ë™ì  ë Œë”ë§ -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============================================================
    // ì „ì—­ ë³€ìˆ˜
    // ============================================================
    let currentSiteData = null;
    let currentInspectionData = [];
    let map = null;
    let mapMarkers = [];

    // URL íŒŒë¼ë¯¸í„°ì—ì„œ site ID ê°€ì ¸ì˜¤ê¸°
    const urlParams = new URLSearchParams(window.location.search);
    const siteId = parseInt(urlParams.get('site')) || 1;

    // ì‚¬ì´íŠ¸ë³„ ì¢Œí‘œ ì •ë³´
    const siteCoordinates = {
      1: { lat: 37.5795, lng: 126.9920, name: 'ë‚™ì„ ì¬' },
      2: { lat: 37.5829, lng: 126.9917, name: 'ì£¼í•©ë£¨' },
      3: { lat: 37.5825, lng: 126.9932, name: 'ì—°ê²½ë‹¹' },
      4: { lat: 37.5831, lng: 126.9915, name: 'ë¶€ìš©ì •' },
      5: { lat: 37.5838, lng: 126.9925, name: 'ì¡´ë•ì •' }
    };

    // ============================================================
    // Google Maps ì´ˆê¸°í™”
    // ============================================================
    function initMap() {
      const coords = siteCoordinates[siteId] || siteCoordinates[1];

      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: coords.lat, lng: coords.lng },
        zoom: 18,
        mapTypeId: 'satellite',  // ìœ„ì„±ì§€ë„
        mapTypeControl: true,
        mapTypeControlOptions: {
          style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
          position: google.maps.ControlPosition.TOP_RIGHT
        },
        fullscreenControl: false,
        streetViewControl: false,
        zoomControl: true,
        zoomControlOptions: {
          position: google.maps.ControlPosition.RIGHT_CENTER
        }
      });

      // ë©”ì¸ ë§ˆì»¤ ì¶”ê°€
      const mainMarker = new google.maps.Marker({
        position: { lat: coords.lat, lng: coords.lng },
        map: map,
        title: coords.name,
        icon: {
          url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40">
              <circle cx="20" cy="20" r="18" fill="#0052CC" stroke="white" stroke-width="3"/>
              <circle cx="20" cy="20" r="6" fill="white"/>
            </svg>
          `),
          scaledSize: new google.maps.Size(40, 40),
          anchor: new google.maps.Point(20, 20)
        }
      });

      // ì§€ë„ ë¡œë“œ ì™„ë£Œ í›„ ë°ì´í„° ë¡œë”©
      google.maps.event.addListenerOnce(map, 'idle', function() {
        loadSiteData();
      });
    }

    // ============================================================
    // ë°ì´í„° ë¡œë”©
    // ============================================================
    async function loadSiteData() {
      try {
        const response = await fetch('data/sites.json');
        const data = await response.json();

        // í˜„ì¬ ì‚¬ì´íŠ¸ ë°ì´í„° ì°¾ê¸°
        currentSiteData = data.sites.find(s => s.id === siteId);

        if (!currentSiteData) {
          console.error('ì‚¬ì´íŠ¸ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', siteId);
          currentSiteData = data.sites[0]; // ì²« ë²ˆì§¸ ì‚¬ì´íŠ¸ ì‚¬ìš©
        }

        currentInspectionData = currentSiteData.inspectionHistory || [];

        // UI ì—…ë°ì´íŠ¸
        updateBasicInfo();
        updateDisasterHistory();
        updateRepairHistory();
        updateInspectionList();
        renderInspectionMarkers();

      } catch (error) {
        console.error('ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
        // Fallback ë°ì´í„° ì‚¬ìš©
        useFallbackData();
      }
    }

    // Fallback ë°ì´í„° (JSON ë¡œë”© ì‹¤íŒ¨ ì‹œ)
    function useFallbackData() {
      currentSiteData = {
        id: siteId,
        name: 'ë‚™ì„ ì¬ ì¼ì›',
        address: 'ì„œìš¸íŠ¹ë³„ì‹œ ì¢…ë¡œêµ¬ ì™€ë£¡ë™ 2-71 ì°½ë•ê¶ ë‚´',
        basicInfo: {
          'ì§€ì •ë²ˆí˜¸': 'ì‚¬ì  ì œ122í˜¸',
          'ì†Œì¬ì§€': 'ì„œìš¸íŠ¹ë³„ì‹œ ì¢…ë¡œêµ¬ ì™€ë£¡ë™ 2-71',
          'ê´€ë¦¬ì£¼ì²´': 'ë¬¸í™”ì¬ì²­ ê¶ëŠ¥ìœ ì ë³¸ë¶€'
        },
        inspectionHistory: [],
        disasterHistory: { content: 'ìµœê·¼ 3ë…„ê°„ íŠ¹ì´ì‚¬í•­ ì—†ìŒ' },
        repairHistory: { content: 'ì •ê¸° ë³´ìˆ˜ ê´€ë¦¬ ì¤‘' }
      };

      updateBasicInfo();
      updateDisasterHistory();
      updateRepairHistory();
      updateInspectionList();
      renderInspectionMarkers();
    }

    // ============================================================
    // ê¸°ë³¸ ì •ë³´ ë Œë”ë§
    // ============================================================
    function updateBasicInfo() {
      const container = document.getElementById('basicInfoBody');
      if (!container || !currentSiteData.basicInfo) return;

      let html = '<div class="info-table__section">';
      html += '<div class="info-table__section-title">êµ­ê°€ìœ ì‚° ê°œìš”</div>';

      for (const [key, value] of Object.entries(currentSiteData.basicInfo)) {
        html += `
          <div class="info-table__row">
            <span class="info-table__label">${key}</span>
            <span class="info-table__value">${value}</span>
          </div>
        `;
      }

      html += '</div>';
      container.innerHTML = html;
    }

    // ============================================================
    // ì ê²€ ì´ë ¥ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
    // ============================================================
    function updateInspectionList() {
      const container = document.getElementById('inspectionList');
      if (!container) return;

      if (!currentInspectionData || currentInspectionData.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #999;">ì ê²€ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }

      let html = '';
      currentInspectionData.forEach((inspection, index) => {
        html += `
          <div class="inspection-item" onclick="highlightMarker(${index + 1})">
            <div class="inspection-item__icon inspection-item__icon--report">ğŸ“‹</div>
            <div class="inspection-item__content">
              <div class="inspection-item__title">${inspection.date} - ${inspection.inspector}</div>
              <div class="inspection-item__desc">${inspection.type} | ${inspection.element} | ${inspection.result}</div>
            </div>
            <div class="inspection-item__arrow">â†’</div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    // ============================================================
    // ì¬í•´ ì´ë ¥ ë Œë”ë§
    // ============================================================
    function updateDisasterHistory() {
      const container = document.getElementById('disasterContent');
      if (!container || !currentSiteData.disasterHistory) return;

      container.innerHTML = `
        <div class="history-content__text">
          ${currentSiteData.disasterHistory.content}
        </div>
      `;
    }

    // ============================================================
    // ìˆ˜ë¦¬ ì´ë ¥ ë Œë”ë§
    // ============================================================
    function updateRepairHistory() {
      const container = document.getElementById('repairContent');
      if (!container || !currentSiteData.repairHistory) return;

      container.innerHTML = `
        <div class="history-content__text">
          ${currentSiteData.repairHistory.content}
        </div>
      `;
    }

    // ============================================================
    // ì ê²€ ì´ë ¥ ë§ˆì»¤ ë™ì  ìƒì„± (Google Maps)
    // ============================================================
    function renderInspectionMarkers() {
      if (!map || !currentInspectionData.length) return;

      // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
      mapMarkers.forEach(marker => marker.setMap(null));
      mapMarkers = [];

      // ë§ˆì»¤ ìœ„ì¹˜ ì˜¤í”„ì…‹ (ë©”ì¸ ë§ˆì»¤ ì£¼ë³€ì— ë¶„ì‚°)
      const offsets = [
        { lat: 0.0002, lng: -0.0003 },
        { lat: -0.0002, lng: 0.0002 },
        { lat: 0.0003, lng: 0.0001 },
        { lat: -0.0001, lng: -0.0002 },
        { lat: 0.0001, lng: 0.0003 }
      ];

      const baseCoords = siteCoordinates[siteId] || siteCoordinates[1];

      currentInspectionData.forEach((inspection, index) => {
        const offset = offsets[index % offsets.length];
        const position = {
          lat: baseCoords.lat + offset.lat,
          lng: baseCoords.lng + offset.lng
        };

        const marker = new google.maps.Marker({
          position: position,
          map: null, // ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€
          title: `ì ê²€ í¬ì¸íŠ¸ ${index + 1}`,
          label: {
            text: String(index + 1),
            color: 'white',
            fontWeight: 'bold',
            fontSize: '12px'
          },
          icon: {
            url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
                <circle cx="16" cy="16" r="14" fill="#FF6B35" stroke="white" stroke-width="3"/>
              </svg>
            `),
            scaledSize: new google.maps.Size(32, 32),
            anchor: new google.maps.Point(16, 16),
            labelOrigin: new google.maps.Point(16, 16)
          },
          zIndex: 100
        });

        // í´ë¦­ ì´ë²¤íŠ¸
        marker.addListener('click', function() {
          showInspectionPopupOnMap(inspection, index + 1, position);
        });

        marker.inspectionData = inspection;
        marker.markerIndex = index + 1;
        mapMarkers.push(marker);
      });
    }

    // ì ê²€ ì´ë ¥ ë§ˆì»¤ í‘œì‹œ/ìˆ¨ê¹€
    function toggleGoogleMapMarkers(show) {
      mapMarkers.forEach(marker => {
        marker.setMap(show ? map : null);
      });
    }

    // ============================================================
    // ì ê²€ ì´ë ¥ íŒì—… í‘œì‹œ (ì„¤ê³„ì„œ p.7 â‘£) - Google Maps ë§ˆì»¤ìš©
    // ============================================================
    function showInspectionPopupOnMap(inspection, markerNumber, position) {
      const popup = document.getElementById('inspectionPopup');
      const header = document.getElementById('popupHeader');
      const body = document.getElementById('popupBody');

      // íŒì—… í—¤ë” ì—…ë°ì´íŠ¸
      header.textContent = `ì ê²€ í¬ì¸íŠ¸ ${markerNumber}`;

      // íŒì—… ë‚´ìš© ë™ì  ë Œë”ë§
      body.innerHTML = `
        <div class="inspection-popup__item" onclick="showReport(${inspection.id})">
          <span class="inspection-popup__item-icon">ğŸ“‹</span>
          ${inspection.report.title}
        </div>
        <div class="inspection-popup__item" onclick="showPhotos(${inspection.id})">
          <span class="inspection-popup__item-icon">ğŸ“·</span>
          ì‚¬ì§„ (${inspection.photos.length}ì¥)
        </div>
        <div class="inspection-popup__item" onclick="openMetafort('${inspection.metafortUrl}')">
          <span class="inspection-popup__item-icon">ğŸ”—</span>
          ë©”íƒ€í¬íŠ¸
        </div>
        <div class="inspection-popup__summary">
          <strong>ì ê²€ì¼:</strong> ${inspection.date}<br>
          <strong>ì ê²€ì:</strong> ${inspection.inspector}<br>
          <strong>ì ê²€ìœ í˜•:</strong> ${inspection.type}<br>
          <strong>ì ê²€ê²°ê³¼:</strong> ${inspection.result}<br>
          <strong>ì ê²€ìš”ì†Œ:</strong> ${inspection.element}<br>
          <strong>ìš”ì•½:</strong> ${inspection.report.summary}
        </div>
      `;

      // ë§ˆì»¤ ìœ„ì¹˜ë¥¼ í™”ë©´ ì¢Œí‘œë¡œ ë³€í™˜
      const projection = map.getProjection();
      if (projection) {
        const point = projection.fromLatLngToPoint(new google.maps.LatLng(position.lat, position.lng));
        const scale = Math.pow(2, map.getZoom());
        const worldCoords = new google.maps.Point(point.x * scale, point.y * scale);

        const mapDiv = document.getElementById('map');
        const mapRect = mapDiv.getBoundingClientRect();
        const mapCenter = projection.fromLatLngToPoint(map.getCenter());
        const centerX = mapCenter.x * scale;
        const centerY = mapCenter.y * scale;

        const screenX = (worldCoords.x - centerX) + mapRect.width / 2 + mapRect.left;
        const screenY = (worldCoords.y - centerY) + mapRect.height / 2 + mapRect.top;

        popup.style.left = (screenX + 20) + 'px';
        popup.style.top = (screenY - 50) + 'px';
      } else {
        // fallback: í™”ë©´ ì¤‘ì•™ì— í‘œì‹œ
        popup.style.left = '50%';
        popup.style.top = '40%';
      }

      popup.classList.add('inspection-popup--active');
    }

    // ë§ˆì»¤ í•˜ì´ë¼ì´íŠ¸ (ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ í´ë¦­ ì‹œ)
    function highlightMarker(markerNumber) {
      const marker = mapMarkers[markerNumber - 1];
      if (marker) {
        google.maps.event.trigger(marker, 'click');
      }
    }

    // ë³´ê³ ì„œ í‘œì‹œ
    function showReport(inspectionId) {
      const inspection = currentInspectionData.find(i => i.id === inspectionId);
      if (inspection) {
        alert(`[${inspection.report.title}]\n\n${inspection.report.summary}\n\n(ì‹¤ì œ êµ¬í˜„ ì‹œ ëª¨ë‹¬ë¡œ ìƒì„¸ ë³´ê³ ì„œ í‘œì‹œ)`);
      }
    }

    // ì‚¬ì§„ í‘œì‹œ
    function showPhotos(inspectionId) {
      const inspection = currentInspectionData.find(i => i.id === inspectionId);
      if (inspection) {
        alert(`ì´ ${inspection.photos.length}ì¥ì˜ ì‚¬ì§„ì´ ìˆìŠµë‹ˆë‹¤:\n\n${inspection.photos.join('\n')}\n\n(ì‹¤ì œ êµ¬í˜„ ì‹œ ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ ëª¨ë‹¬ í‘œì‹œ)`);
      }
    }

    // ë©”íƒ€í¬íŠ¸ ì—´ê¸°
    function openMetafort(url) {
      alert(`ë©”íƒ€í¬íŠ¸ë¡œ ì´ë™í•©ë‹ˆë‹¤:\n${url}\n\n(ì‹¤ì œ êµ¬í˜„ ì‹œ ìƒˆ íƒ­ì—ì„œ URL ì—´ê¸°)`);
      // window.open(url, '_blank');
    }

    // ============================================================
    // í˜ì´ì§€ ë¡œë“œ ì‹œ - Google Mapsê°€ initMapì„ callbackìœ¼ë¡œ í˜¸ì¶œ
    // ============================================================
    // initMap() í•¨ìˆ˜ ë‚´ì—ì„œ ì§€ë„ ë¡œë“œ ì™„ë£Œ í›„ loadSiteData() í˜¸ì¶œë¨

    // ============================================================
    // ë©”ë‰´ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    // ============================================================
    document.querySelectorAll('.menu-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const modalId = this.dataset.modal;

        // ì ê²€ ì´ë ¥ ë²„íŠ¼ í´ë¦­ ì‹œ ì§€ë„ì— ë§ˆì»¤ í‘œì‹œ (ì„¤ê³„ì„œ p.7)
        if (modalId === 'inspection') {
          toggleGoogleMapMarkers(true);
          // ëª¨ë‹¬ë„ í•¨ê»˜ í‘œì‹œ
          openModal('modalInspection');
          // í™œì„±í™” ìƒíƒœ í† ê¸€
          document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('menu-btn--active'));
          this.classList.add('menu-btn--active');
          return;
        } else {
          toggleGoogleMapMarkers(false);
          hideInspectionPopup();
        }

        openModal('modal' + modalId.charAt(0).toUpperCase() + modalId.slice(1));

        // í™œì„±í™” ìƒíƒœ í† ê¸€
        document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('menu-btn--active'));
        this.classList.add('menu-btn--active');
      });
    });

    // ì ê²€ ì´ë ¥ íŒì—… ìˆ¨ê¹€
    function hideInspectionPopup() {
      const popup = document.getElementById('inspectionPopup');
      popup.classList.remove('inspection-popup--active');
    }

    // ì§€ë„ í´ë¦­ ì‹œ íŒì—… ë‹«ê¸°
    document.getElementById('map').addEventListener('click', function() {
      hideInspectionPopup();
    });

    // ëª¨ë‹¬ ì—´ê¸°
    function openModal(modalId) {
      document.getElementById(modalId).classList.add('modal-overlay--active');
    }

    // ëª¨ë‹¬ ë‹«ê¸°
    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('modal-overlay--active');
      document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('menu-btn--active'));

      // ì ê²€ ì´ë ¥ ëª¨ë‹¬ ë‹«ì„ ë•Œ ë§ˆì»¤ë„ ìˆ¨ê¹€
      if (modalId === 'modalInspection') {
        toggleGoogleMapMarkers(false);
        hideInspectionPopup();
      }
    }

    // ì˜¤ë²„ë ˆì´ í´ë¦­ìœ¼ë¡œ ëª¨ë‹¬ ë‹«ê¸°
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', function(e) {
        if (e.target === this) {
          const modalId = this.id;
          closeModal(modalId);
        }
      });
    });

    // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
          if (overlay.classList.contains('modal-overlay--active')) {
            closeModal(overlay.id);
          }
        });
      }
    });

    // initMapì´ window ìŠ¤ì½”í”„ì— ìˆë„ë¡ ì„¤ì •
    window.initMap = initMap;
  </script>

  <!-- Google Maps API - initMap ì •ì˜ í›„ ë¡œë“œ -->
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVpHmM8qjvVqpGergGbXNw3V4fIscaNEE&callback=initMap"></script>
</body>
</html>
