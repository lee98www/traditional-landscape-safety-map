<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ëŒ€ìƒì§€ ìƒì„¸ ì •ë³´ | ì „í†µì¡°ê²½ ì•ˆì „ì§€ë„ ì‹œë²”ì„œë¹„ìŠ¤</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/reset.css">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-family);
      height: 100vh;
      overflow: hidden;
    }

    /* Map Container - ì „ì²´ í™”ë©´ */
    #map {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 1;
    }

    /* Sidebar */
    .sidebar {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 100;
      width: 240px;
    }

    .sidebar__logo {
      display: inline-flex;
      align-items: center;
      padding: 10px 20px;
      background-color: var(--color-logo-bg);
      border-radius: var(--radius-full);
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-semibold);
      color: var(--color-logo-text);
      text-decoration: none;
      border: 1px solid #D4E8FF;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .sidebar__logo:hover {
      background-color: #D4E8FF;
    }

    .sidebar__menu {
      background: var(--color-bg-white);
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
      overflow: hidden;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 20px;
      font-size: var(--font-size-base);
      color: var(--color-text-primary);
      cursor: pointer;
      transition: all var(--transition-fast);
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      border-bottom: 1px solid #F0F0F0;
    }

    .menu-item:last-child {
      border-bottom: none;
    }

    .menu-item:hover {
      background: #F5F9FC;
    }

    .menu-item.active {
      background: var(--color-primary-light);
      color: var(--color-primary);
      font-weight: var(--font-weight-medium);
    }

    .menu-item__icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    /* Modal Overlay */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 200;
      display: none;
      justify-content: center;
      align-items: center;
    }

    .modal-overlay.active {
      display: flex;
    }

    /* Modal Content */
    .modal {
      background: var(--color-bg-white);
      border-radius: 12px;
      max-width: 900px;
      max-height: 85vh;
      width: 90%;
      overflow: hidden;
      box-shadow: 0 16px 48px rgba(0,0,0,0.2);
    }

    .modal__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 24px;
      border-bottom: 1px solid var(--color-border-light);
    }

    .modal__title {
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-semibold);
    }

    .modal__close {
      width: 32px;
      height: 32px;
      border: none;
      background: none;
      cursor: pointer;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background var(--transition-fast);
    }

    .modal__close:hover {
      background: #F0F0F0;
    }

    .modal__close svg {
      width: 20px;
      height: 20px;
    }

    .modal__body {
      padding: 24px;
      max-height: calc(85vh - 60px);
      overflow-y: auto;
    }

    /* ê¸°ë³¸ ì •ë³´ í…Œì´ë¸” */
    .info-table {
      width: 100%;
      border-collapse: collapse;
      font-size: var(--font-size-sm);
    }

    .info-table th,
    .info-table td {
      padding: 12px 16px;
      border: 1px solid #E0E0E0;
      text-align: left;
    }

    .info-table th {
      background: #4A7A8C;
      color: white;
      font-weight: var(--font-weight-medium);
      width: 140px;
    }

    .info-table td {
      background: white;
    }

    .info-table .section-header {
      background: #5A8A9C;
      color: white;
      text-align: center;
      font-weight: var(--font-weight-semibold);
    }

    /* ì¬í•´/ìˆ˜ë¦¬ ì´ë ¥ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
    .history-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    .history-table th,
    .history-table td {
      padding: 12px;
      border: 1px solid #E0E0E0;
      text-align: center;
    }

    .history-table th {
      background: #C8E6F5;
      color: #333;
      font-weight: 600;
    }

    .history-table tbody tr:hover {
      background: #F5F5F5;
    }

    /* Hover íˆ´íŒ ìŠ¤íƒ€ì¼ */
    .history-tooltip {
      min-width: 220px;
      padding: 12px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      font-family: 'Noto Sans KR', sans-serif;
      animation: tooltipFadeIn 0.6s ease-out;
    }

    @keyframes tooltipFadeIn {
      from {
        opacity: 0;
        transform: translateY(12px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .tooltip-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      padding-bottom: 8px;
      border-bottom: 1px solid #E0E0E0;
    }

    .tooltip-header strong {
      font-size: 14px;
      color: #333;
    }

    .tooltip-badge {
      background: #E53935;
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }

    .tooltip-badge.repair {
      background: #6A1B9A;
    }

    .tooltip-body {
      margin-bottom: 8px;
    }

    .tooltip-item {
      display: flex;
      font-size: 12px;
      margin-bottom: 4px;
    }

    .tooltip-label {
      color: #666;
      margin-right: 8px;
      min-width: 50px;
    }

    .tooltip-value {
      color: #333;
      font-weight: 500;
    }

    .tooltip-footer {
      padding-top: 8px;
      border-top: 1px solid #E0E0E0;
    }

    .tooltip-action {
      font-size: 11px;
      color: #1976D2;
      font-weight: 500;
      animation: tooltipActionPulse 2s ease-in-out infinite;
    }

    @keyframes tooltipActionPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    /* ì ê²€ ì´ë ¥ íŒì—… ë©”ë‰´ ìŠ¤íƒ€ì¼ */
    .inspection-popup-menu {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      z-index: 10000;
      min-width: 300px;
      animation: popupFadeIn 0.2s ease-out;
    }

    @keyframes popupFadeIn {
      from {
        opacity: 0;
        transform: translate(-50%, -45%);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%);
      }
    }

    .popup-menu-content {
      padding: 20px;
    }

    .popup-menu-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 2px solid #E0E0E0;
    }

    .popup-menu-header h4 {
      margin: 0;
      font-size: 16px;
      color: #333;
    }

    .popup-menu-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
      padding: 0;
      width: 30px;
      height: 30px;
    }

    .popup-menu-close:hover {
      color: #333;
    }

    .popup-menu-body {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .popup-menu-btn {
      display: flex;
      align-items: center;
      padding: 16px;
      background: #F5F5F5;
      border: 2px solid transparent;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: #333;
      transition: all 0.2s ease;
    }

    .popup-menu-btn:hover {
      background: #E3F2FD;
      border-color: #1976D2;
      color: #1976D2;
    }

    .menu-icon {
      font-size: 20px;
      margin-right: 12px;
    }

    /* ì ê²€ ì´ë ¥ ê°„ë‹¨ íŒì—… ìŠ¤íƒ€ì¼ */
    .inspection-simple-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.25);
      z-index: 10000;
      min-width: 320px;
      max-width: 400px;
      animation: popupSlideIn 0.25s ease-out;
    }

    @keyframes popupSlideIn {
      from {
        opacity: 0;
        transform: translate(-50%, -46%);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%);
      }
    }

    .inspection-simple-header {
      padding: 20px 24px;
      border-bottom: 1px solid #E0E0E0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .inspection-simple-title {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin: 0;
    }

    .inspection-simple-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #999;
      padding: 0;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s;
    }

    .inspection-simple-close:hover {
      color: #333;
    }

    .inspection-simple-body {
      padding: 20px 24px 24px 24px;
    }

    .inspection-simple-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .inspection-simple-btn {
      padding: 14px 20px;
      background: #F8F9FA;
      border: 1px solid #E0E0E0;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: #333;
      transition: all 0.2s ease;
      text-align: left;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .inspection-simple-btn:hover {
      background: #E8F4FD;
      border-color: #1976D2;
      color: #1976D2;
    }

    .inspection-simple-btn-icon {
      font-size: 18px;
    }

    /* ì ê²€ ì´ë ¥ 2ì°¨ íŒì—… ìŠ¤íƒ€ì¼ */
    .inspection-second-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.25);
      z-index: 10001;
      width: 90%;
      max-width: 800px;
      max-height: 85vh;
      overflow-y: auto;
      animation: popupSlideIn 0.25s ease-out;
    }

    .inspection-second-header {
      padding: 20px 24px;
      border-bottom: 1px solid #E0E0E0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background: white;
      z-index: 1;
      border-radius: 12px 12px 0 0;
    }

    .inspection-back-btn {
      background: none;
      border: none;
      font-size: 14px;
      font-weight: 500;
      color: #1976D2;
      cursor: pointer;
      padding: 6px 12px;
      border-radius: 6px;
      transition: background 0.2s;
    }

    .inspection-back-btn:hover {
      background: #E3F2FD;
    }

    .inspection-second-title {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin: 0;
      flex: 1;
      text-align: center;
    }

    .inspection-second-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #999;
      padding: 0;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s;
    }

    .inspection-second-close:hover {
      color: #333;
    }

    .inspection-second-body {
      padding: 24px;
    }

    /* ì‚¬ì§„ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
    .photo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
    }

    .photo-item {
      position: relative;
      cursor: pointer;
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid #E0E0E0;
      transition: all 0.2s;
    }

    .photo-item:hover {
      border-color: #1976D2;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .photo-item img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
    }

    .photo-item-label {
      padding: 8px 12px;
      background: white;
      font-size: 13px;
      color: #333;
      text-align: center;
      border-top: 1px solid #E0E0E0;
    }

    /* ë³´ê³ ì„œ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
    .report-image-container {
      text-align: center;
    }

    .report-image-container img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .checkbox-item input {
      width: 16px;
      height: 16px;
    }

    .check-mark {
      display: inline-block;
      width: 12px;
      height: 12px;
      background: var(--color-primary);
      border-radius: 50%;
      margin-right: 6px;
    }

    /* ì´ë ¥ ì˜¤ë²„ë ˆì´ (ì¬í•´/ìˆ˜ë¦¬) */
    .history-overlay {
      position: absolute;
      top: 0;
      left: 260px;
      right: 0;
      bottom: 0;
      z-index: 50;
      pointer-events: none;
      display: none;
    }

    .history-overlay.active {
      display: block;
    }

    /* ìƒë‹¨ í•„í„° ë°” - ìš°ì¸¡ ì •ë ¬ */
    .filter-bar {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,0.95);
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: flex;
      gap: 16px;
      align-items: center;
      pointer-events: auto;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .filter-label {
      font-size: 11px;
      font-weight: 600;
      color: #666;
      white-space: nowrap;
    }

    .filter-select {
      padding: 8px 12px;
      border: 1px solid #DDD;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
    }

    /* ë²”ë¡€ */
    .legend {
      position: absolute;
      bottom: 30px;
      right: 30px;
      background: var(--color-bg-white);
      border-radius: 8px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.15);
      padding: 16px;
      min-width: 160px;
      pointer-events: auto;
    }

    .legend__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      font-size: 14px;
      font-weight: var(--font-weight-semibold);
    }

    .legend__toggle {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    .legend__item {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .legend__item:last-child {
      margin-bottom: 0;
    }

    .legend__color {
      width: 16px;
      height: 16px;
      border-radius: 50%;
    }

    /* ì¬í•´ ë²”ë¡€ ìƒ‰ìƒ */
    .legend__color--disaster-high { background: #E53935; }
    .legend__color--disaster-mid { background: #FB8C00; }
    .legend__color--disaster-low { background: #FFD54F; }

    /* ìˆ˜ë¦¬ ë²”ë¡€ ìƒ‰ìƒ */
    .legend__color--repair-high { background: #8E24AA; }
    .legend__color--repair-mid { background: #AB47BC; }
    .legend__color--repair-low { background: #CE93D8; }

    /* ê²½ê³  ë°°ë„ˆ - ì¤‘ì•™ í•˜ë‹¨ìœ¼ë¡œ ì´ë™ */
    .warning-banner {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.75);
      color: white;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 13px;
      pointer-events: auto;
      z-index: 60;
      line-height: 1.4;
      white-space: nowrap;
    }

    /* ì ê²€ ì´ë ¥ íŒì—… */
    .inspection-popup {
      position: absolute;
      background: var(--color-bg-white);
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.2);
      padding: 16px;
      min-width: 200px;
      z-index: 150;
      display: none;
    }

    .inspection-popup.active {
      display: block;
    }

    .popup-item {
      padding: 10px 16px;
      cursor: pointer;
      border-radius: 6px;
      font-size: 14px;
      transition: background var(--transition-fast);
    }

    .popup-item:hover {
      background: #F5F5F5;
    }

    /* ì ê²€ ì´ë ¥ ë§ˆì»¤ë“¤ */
    .inspection-markers {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      z-index: 60;
      display: none;
    }

    .inspection-markers.active {
      display: block;
    }

    /* ìˆ˜ë¦¬ ì´ì—­ ì„œë¸Œë©”ë‰´ ì»¨í…Œì´ë„ˆ */
    .repair-submenu-container {
      margin-top: 8px;
      display: none;
    }

    .repair-submenu-container.active {
      display: block;
    }

    .submenu-label {
      font-size: 11px;
      font-weight: 600;
      color: #666;
      padding: 0 16px 6px 16px;
    }

    /* ìˆ˜ë¦¬ ì´ë ¥ ì„œë¸Œë©”ë‰´ */
    .repair-submenu {
      background: var(--color-bg-white);
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .submenu-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 16px;
      font-size: 13px;
      color: var(--color-text-primary);
      cursor: pointer;
      transition: all var(--transition-fast);
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      border-bottom: 1px solid #F0F0F0;
    }

    .submenu-item:last-child {
      border-bottom: none;
    }

    .submenu-item:hover {
      background: #F5F9FC;
    }

    .submenu-item.active {
      background: var(--color-primary-light);
      color: var(--color-primary);
    }

    .submenu-item__radio {
      width: 16px;
      height: 16px;
      border: 2px solid #CCC;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .submenu-item.active .submenu-item__radio {
      border-color: var(--color-primary);
    }

    .submenu-item__radio-inner {
      width: 8px;
      height: 8px;
      background: var(--color-primary);
      border-radius: 50%;
      display: none;
    }

    .submenu-item.active .submenu-item__radio-inner {
      display: block;
    }

    /* ì ê²€ ìƒì„¸ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .inspection-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      max-width: 600px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      padding: 30px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }

    .close-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      font-size: 28px;
      color: #999;
      cursor: pointer;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .close-btn:hover {
      background: #f0f0f0;
      color: #333;
    }

    .modal-body {
      margin: 20px 0;
    }

    .modal-footer {
      margin-top: 20px;
    }

    .photo-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <!-- Google Map -->
  <div id="map"></div>

  <!-- Sidebar -->
  <div class="sidebar">
    <a href="index.html" class="sidebar__logo">ì „í†µì¡°ê²½ ì•ˆì „ì§€ë„ ì‹œë²”ì„œë¹„ìŠ¤</a>

    <div class="sidebar__menu">
      <button class="menu-item" onclick="showBasicInfo()">
        <svg class="menu-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 16v-4"/>
          <path d="M12 8h.01"/>
        </svg>
        ê¸°ë³¸ ì •ë³´
      </button>
      <button class="menu-item" onclick="showInspectionHistory()">
        <svg class="menu-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
          <line x1="16" y1="13" x2="8" y2="13"/>
          <line x1="16" y1="17" x2="8" y2="17"/>
        </svg>
        ì ê²€ ì´ë ¥
      </button>
      <button class="menu-item" onclick="showDisasterHistory()">
        <svg class="menu-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
        </svg>
        ì¬í•´ ì´ë ¥
      </button>
      <button class="menu-item" onclick="showRepairHistory()">
        <svg class="menu-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
        </svg>
        ìˆ˜ë¦¬ ì´ë ¥
      </button>
    </div>

    <!-- ìˆ˜ë¦¬ ì´ë ¥ ì„œë¸Œë©”ë‰´ -->
    <div class="repair-submenu-container">
      <div class="repair-submenu" id="repairSubmenu">
        <button class="submenu-item active" onclick="selectRepairFilter('all')">
          <span class="submenu-item__radio"><span class="submenu-item__radio-inner"></span></span>
          ëª¨ë‘ë³´ê¸°
        </button>
        <button class="submenu-item" onclick="selectRepairFilter('flood')">
          <span class="submenu-item__radio"><span class="submenu-item__radio-inner"></span></span>
          ë²”ëŒ ìœ„í—˜ ìš”ì†Œ
        </button>
        <button class="submenu-item" onclick="selectRepairFilter('terrain')">
          <span class="submenu-item__radio"><span class="submenu-item__radio-inner"></span></span>
          ì¸ì ‘ ì§€í˜•
        </button>
        <button class="submenu-item" onclick="selectRepairFilter('surrounding')">
          <span class="submenu-item__radio"><span class="submenu-item__radio-inner"></span></span>
          ì£¼ë³€ ì˜í–¥
        </button>
        <button class="submenu-item" onclick="selectRepairFilter('elevation')">
          <span class="submenu-item__radio"><span class="submenu-item__radio-inner"></span></span>
          ê³ ì €ì°¨
        </button>
        <button class="submenu-item" onclick="selectRepairFilter('hydraulic')">
          <span class="submenu-item__radio"><span class="submenu-item__radio-inner"></span></span>
          ìˆ˜ë¦¬ ì¡°ê±´
        </button>
        <button class="submenu-item" onclick="selectRepairFilter('rainfall')">
          <span class="submenu-item__radio"><span class="submenu-item__radio-inner"></span></span>
          ê°•ìš° ì´ë ¥
        </button>
      </div>
    </div>
  </div>

  <!-- ê¸°ë³¸ ì •ë³´ ëª¨ë‹¬ -->
  <div class="modal-overlay" id="basicInfoModal">
    <div class="modal">
      <div class="modal__header">
        <h2 class="modal__title">ê¸°ë³¸ ì •ë³´</h2>
        <button class="modal__close" onclick="closeModal('basicInfoModal')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18"/>
            <path d="M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="modal__body">
        <table class="info-table">
          <tr>
            <th rowspan="4" class="section-header">êµ­ê°€<br>ìœ ì‚°<br>ê°œìš”</th>
            <th>êµ­ê°€ìœ ì‚°ëª…</th>
            <td>ì°½ë•ê¶ ë‚™ì„ ì¬ ê¶Œì—­</td>
            <th rowspan="5" class="section-header">êµ­ê°€<br>ìœ ì‚°<br>ê´€ë¦¬</th>
            <th>ì¢…í•©ì •ë¹„ê³„íš</th>
            <td><span class="check-mark"></span></td>
          </tr>
          <tr>
            <th>êµ­ê°€ìœ ì‚°ìœ í˜•</th>
            <td>ì‚¬ì </td>
            <th>ì •ê¸°ì¡°ì‚¬</th>
            <td><span class="check-mark"></span></td>
          </tr>
          <tr>
            <th>ì†Œì¬ì§€</th>
            <td>ì„œìš¸íŠ¹ë³„ì‹œ ì¢…ë¡œêµ¬ ìœ¨ê³¡ë¡œ 99-0</td>
            <th>ëŒë´„ì‚¬ì—…</th>
            <td>-</td>
          </tr>
          <tr>
            <th>ì†Œìœ ì/ê´€ë¦¬ì</th>
            <td>êµ­ê°€ìœ ì‚°ì²­ ì°½ë•ê¶ê´€ë¦¬ì†Œ</td>
            <th>ëª¨ë‹ˆí„°ë§</th>
            <td><span class="check-mark"></span></td>
          </tr>
          <tr>
            <th rowspan="6" class="section-header">ì£¼ë³€<br>í™˜ê²½</th>
            <th>ë²”ëŒìœ„í—˜ìš”ì†Œ</th>
            <td colspan="2">
              <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" checked disabled> ê°•, í•˜ì²œ</label>
                <label class="checkbox-item"><input type="checkbox" disabled> ê³„ê³¡</label>
                <label class="checkbox-item"><input type="checkbox" disabled> ì €ìˆ˜ì§€</label>
                <label class="checkbox-item"><input type="checkbox" disabled> ë°”ë‹¤</label>
                <label class="checkbox-item"><input type="checkbox" disabled> ê¸°íƒ€</label>
              </div>
            </td>
            <th>êµ­ê°€ìœ ì‚°ì§€í‚´ì´</th>
            <td><span class="check-mark"></span></td>
          </tr>
          <tr>
            <th>ì¸ì ‘ì§€í˜•</th>
            <td colspan="4">
              <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" checked disabled> ê²½ì‚¬</label>
                <label class="checkbox-item"><input type="checkbox" disabled> ì˜¹ë²½</label>
                <label class="checkbox-item"><input type="checkbox" checked disabled> ì „ë„ìœ„í—˜</label>
                <label class="checkbox-item"><input type="checkbox" disabled> ì ˆê°œì§€</label>
                <label class="checkbox-item"><input type="checkbox" disabled> ê¸°íƒ€</label>
              </div>
            </td>
          </tr>
          <tr>
            <th>ì£¼ë³€ ì˜í–¥</th>
            <td colspan="4">
              <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" disabled> ìŠµí•´</label>
                <label class="checkbox-item"><input type="checkbox" disabled> ê³µí•´</label>
                <label class="checkbox-item"><input type="checkbox" disabled> ì—¼í•´</label>
                <label class="checkbox-item"><input type="checkbox" disabled> ì§„ë™</label>
                <label class="checkbox-item"><input type="checkbox" disabled> ê¸°íƒ€</label>
              </div>
            </td>
          </tr>
          <tr>
            <th>ê³ ì €ì°¨</th>
            <td colspan="4">
              ë‹¹í•´ êµ­ê°€ìœ ì‚°ì´ ì£¼ë³€ì§€í˜•ì— ë¹„í•´ &nbsp;
              <label class="checkbox-item"><input type="checkbox" checked disabled> ë‚®ìŒ</label>
              <label class="checkbox-item"><input type="checkbox" disabled> ë†’ìŒ</label>
            </td>
          </tr>
          <tr>
            <th>ìˆ˜ë¦¬ì¡°ê±´</th>
            <td colspan="4">
              <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" checked disabled> dry</label>
                <label class="checkbox-item"><input type="checkbox" disabled> damp</label>
                <label class="checkbox-item"><input type="checkbox" disabled> wet</label>
                <label class="checkbox-item"><input type="checkbox" disabled> dripping</label>
                <label class="checkbox-item"><input type="checkbox" disabled> flowing</label>
              </div>
            </td>
          </tr>
          <tr>
            <th>ê°•ìš°ì´ë ¥</th>
            <td colspan="4">í•´ë‹¹ ì§€ì—­ ìµœê·¼ 10ê°œë…„ ìµœëŒ€ ì¼ê°•ìš°ê°•ë„ ëˆ„ë…„ í‰ê· ê°’ê³¼ ìµœê·¼ 2ê°œë…„ ìµœëŒ€ ê°•ìš°ëŸ‰</td>
          </tr>
        </table>
      </div>
    </div>
  </div>

  <!-- ì¬í•´ ì´ë ¥ í…Œì´ë¸” ëª¨ë‹¬ -->
  <div class="modal-overlay" id="disasterTableModal" style="display: none;" onclick="closeDisasterModal()">
    <div class="modal" style="max-width: 1000px;" onclick="event.stopPropagation()">
      <div class="modal__header">
        <h2 class="modal__title">ì¬í•´ ì´ë ¥</h2>
        <button class="modal__close" onclick="closeDisasterModal()">Ã—</button>
      </div>
      <div class="modal__body" style="padding: 20px;">
        <table class="history-table" id="disasterTableContent">
          <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
        </table>
      </div>
    </div>
  </div>

  <!-- ìˆ˜ë¦¬ ì´ë ¥ í…Œì´ë¸” ëª¨ë‹¬ -->
  <div class="modal-overlay" id="repairTableModal" style="display: none;" onclick="closeRepairModal()">
    <div class="modal" style="max-width: 1000px;" onclick="event.stopPropagation()">
      <div class="modal__header">
        <h2 class="modal__title">ìˆ˜ë¦¬ ì´ë ¥</h2>
        <button class="modal__close" onclick="closeRepairModal()">Ã—</button>
      </div>
      <div class="modal__body" style="padding: 20px;">
        <table class="history-table" id="repairTableContent">
          <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
        </table>
      </div>
    </div>
  </div>

  <!-- ì ê²€ ì´ë ¥ 1ì°¨ íŒì—… (ë©”ë‰´ ì„ íƒ) -->
  <div class="modal-overlay" id="inspectionDetailModal" style="display: none;" onclick="closeInspectionDetail()">
    <div class="inspection-simple-popup" onclick="event.stopPropagation()">
      <div class="inspection-simple-header">
        <h4 class="inspection-simple-title" id="inspectionSimpleTitle"></h4>
        <button class="inspection-simple-close" onclick="closeInspectionDetail()">Ã—</button>
      </div>
      <div class="inspection-simple-body">
        <div class="inspection-simple-buttons">
          <button class="inspection-simple-btn" onclick="viewInspectionReport()">
            <span>ì•ˆì „ ì ê²€ ë³´ê³ ì„œ</span>
            <span class="inspection-simple-btn-icon">ğŸ“„</span>
          </button>
          <button class="inspection-simple-btn" onclick="viewPhotos()">
            <span>ì‚¬ì§„</span>
            <span class="inspection-simple-btn-icon">ğŸ“·</span>
          </button>
          <button class="inspection-simple-btn" onclick="viewMetaReport()">
            <span>ë©”íƒ€í¬íŠ¸</span>
            <span class="inspection-simple-btn-icon">ğŸ“Š</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ì ê²€ ì´ë ¥ 2ì°¨ íŒì—… (ìƒì„¸ ì •ë³´) -->
  <div class="modal-overlay" id="inspectionSecondModal" style="display: none;" onclick="closeSecondModal()">
    <div class="inspection-second-popup" onclick="event.stopPropagation()">
      <div class="inspection-second-header">
        <button class="inspection-back-btn" onclick="backToFirstModal()">â† ë’¤ë¡œ</button>
        <h4 class="inspection-second-title" id="inspectionSecondTitle"></h4>
        <button class="inspection-second-close" onclick="closeSecondModal()">Ã—</button>
      </div>
      <div class="inspection-second-body" id="inspectionSecondBody">
        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
      </div>
    </div>
  </div>

  <!-- ì¬í•´ ì´ë ¥ ì˜¤ë²„ë ˆì´ -->
  <div class="history-overlay" id="disasterOverlay">
    <div class="filter-bar">
      <div class="filter-group">
        <label class="filter-label">ì „í†µì¡°ê²½ìš”ì†Œ</label>
        <select class="filter-select" id="disasterElementFilter" onchange="applyDisasterFilters()">
          <option value="all" selected>ëª¨ë‘ë³´ê¸°</option>
          <option value="ì„ì¶•">ì„ì¶•</option>
          <option value="ì˜¹ë²½">ì˜¹ë²½</option>
          <option value="ë‹´ì¥">ë‹´ì¥</option>
          <option value="ìˆ˜ëª©">ìˆ˜ëª©</option>
          <option value="ë¬¸">ë¬¸</option>
        </select>
      </div>
      <div class="filter-group">
        <label class="filter-label">ì¬í•´</label>
        <select class="filter-select" id="disasterTypeFilter" onchange="applyDisasterFilters()">
          <option value="all" selected>ëª¨ë‘ë³´ê¸°</option>
          <option value="í˜¸ìš°">í˜¸ìš°</option>
          <option value="ê°•í’">ê°•í’</option>
          <option value="íƒœí’">íƒœí’</option>
        </select>
      </div>
      <div class="filter-group">
        <label class="filter-label">ì—°ë„</label>
        <select class="filter-select" id="disasterYearFilter" onchange="applyDisasterFilters()">
          <option value="all" selected>ëª¨ë‘ë³´ê¸°</option>
          <option value="2023">2023</option>
          <option value="2022">2022</option>
          <option value="2021">2021</option>
          <option value="2020">2020</option>
          <option value="2019">2019</option>
          <option value="2017">2017</option>
        </select>
      </div>
    </div>
    <div class="warning-banner">
      â€» ë³¸ ì§€ë„ì˜ ì¡°ì‚¬ ì˜ì—­ê³¼ ê²°ê³¼ëŠ” ì‹¤ì œ ì¡°ì‚¬ ê²°ê³¼ê°€ ì•„ë‹Œ ì´í•´ë¥¼ ë•ê¸° ìœ„í•œ ì˜ˆì‹œ ì´ë¯¸ì§€ ì…ë‹ˆë‹¤
    </div>
    <div class="legend" id="disasterLegend">
      <div class="legend__header">
        ì¬í•´ ì´ë ¥ ë²”ë¡€
        <svg class="legend__toggle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 15l-6-6-6 6"/>
        </svg>
      </div>
      <div class="legend__item">
        <span class="legend__color legend__color--disaster-high"></span>
        10íšŒ ì´ìƒ ë°œìƒ
      </div>
      <div class="legend__item">
        <span class="legend__color legend__color--disaster-mid"></span>
        5íšŒ ì´ìƒ ë°œìƒ
      </div>
      <div class="legend__item">
        <span class="legend__color legend__color--disaster-low"></span>
        1íšŒ ì´ìƒ ë°œìƒ
      </div>
    </div>
  </div>

  <!-- ìˆ˜ë¦¬ ì´ë ¥ ì˜¤ë²„ë ˆì´ -->
  <div class="history-overlay" id="repairOverlay">
    <div class="warning-banner">
      â€» ë³¸ ì§€ë„ì˜ ì¡°ì‚¬ ì˜ì—­ê³¼ ê²°ê³¼ëŠ” ì‹¤ì œ ì¡°ì‚¬ ê²°ê³¼ê°€ ì•„ë‹Œ ì´í•´ë¥¼ ë•ê¸° ìœ„í•œ ì˜ˆì‹œ ì´ë¯¸ì§€ ì…ë‹ˆë‹¤
    </div>
    <div class="legend" id="repairLegend">
      <div class="legend__header">
        ìˆ˜ë¦¬ ì´ë ¥ ë²”ë¡€
        <svg class="legend__toggle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 15l-6-6-6 6"/>
        </svg>
      </div>
      <div class="legend__item">
        <span class="legend__color legend__color--repair-high"></span>
        10íšŒ ì´ìƒ
      </div>
      <div class="legend__item">
        <span class="legend__color legend__color--repair-mid"></span>
        5íšŒ ì´ìƒ
      </div>
      <div class="legend__item">
        <span class="legend__color legend__color--repair-low"></span>
        1íšŒ ì´ìƒ
      </div>
    </div>
  </div>

  <!-- ì ê²€ ì´ë ¥ íŒì—… -->
  <div class="inspection-popup" id="inspectionPopup">
    <div class="popup-item" onclick="showReport()">ì•ˆì „ ì ê²€ ë³´ê³ ì„œ</div>
    <div class="popup-item" onclick="showPhotos()">ì‚¬ì§„</div>
    <div class="popup-item" onclick="openMetafort()">ë©”íƒ€í¬íŠ¸</div>
  </div>

  <!-- Config -->
  <script src="config.js"></script>

  <!-- ë°ì´í„° ë¡œë” ë° GIS ë Œë”ëŸ¬ -->
  <script src="js/data-loader.js"></script>
  <script src="js/gis-renderer.js"></script>

  <script>
    let map;
    let mainMarker;
    let inspectionMarkers = [];
    let polygons = [];
    let currentMode = null;
    let inspectionsData = [];
    let gisData = {};
    let allDisasterHistory = [];
    let allRepairHistory = [];
    let buildingPolygons = null; // ê±´ë¬¼ í´ë¦¬ê³¤ GeoJSON ë°ì´í„°

    // ëŒ€ìƒì§€ ì¢Œí‘œ (ì°½ë•ê¶ ë‚™ì„ ì¬)
    const siteInfo = DataLoader.getSiteInfo();
    const siteLocation = siteInfo.center;

    // ë”ë¯¸ í´ë¦¬ê³¤ ë°ì´í„°ëŠ” ì‚­ì œí•˜ê³  ì‹¤ì œ ë°ì´í„°ë¥¼ JSONì—ì„œ ë¡œë“œí•©ë‹ˆë‹¤
    // (ì•„ë˜ ì£¼ì„ ì²˜ë¦¬ëœ ì½”ë“œëŠ” ì°¸ê³ ìš©ìœ¼ë¡œ ë‚¨ê²¨ë‘ )
    /*
    // ì¬í•´ ì´ë ¥ í´ë¦¬ê³¤ ë°ì´í„° - ë§¤ìš° ì‘ì€ í¬ê¸°, ì¢ì€ ë²”ìœ„ (ì¤‘ì‹¬: 37.5795, 126.9910)
    const disasterPolygons_OLD = [
      // ê³ ìœ„í—˜ (ë¹¨ê°•) - 4ê°œ
      { paths: [
        { lat: 37.57962, lng: 126.99065 }, { lat: 37.57968, lng: 126.99072 },
        { lat: 37.57963, lng: 126.99078 }, { lat: 37.57957, lng: 126.99070 }
      ], color: '#E53935', level: 'high' },
      { paths: [
        { lat: 37.57985, lng: 126.99120 }, { lat: 37.57990, lng: 126.99125 }, { lat: 37.57992, lng: 126.99132 },
        { lat: 37.57986, lng: 126.99135 }, { lat: 37.57982, lng: 126.99128 }
      ], color: '#E53935', level: 'high' },
      { paths: [
        { lat: 37.57925, lng: 126.99085 }, { lat: 37.57932, lng: 126.99088 },
        { lat: 37.57930, lng: 126.99095 }, { lat: 37.57923, lng: 126.99092 }
      ], color: '#E53935', level: 'high' },
      { paths: [
        { lat: 37.57970, lng: 126.99145 }, { lat: 37.57976, lng: 126.99148 }, { lat: 37.57978, lng: 126.99154 },
        { lat: 37.57972, lng: 126.99156 }, { lat: 37.57968, lng: 126.99150 }
      ], color: '#E53935', level: 'high' },
      // ì¤‘ìœ„í—˜ (ì£¼í™©) - 4ê°œ
      { paths: [
        { lat: 37.57945, lng: 126.99105 }, { lat: 37.57952, lng: 126.99108 },
        { lat: 37.57950, lng: 126.99115 }, { lat: 37.57943, lng: 126.99112 }
      ], color: '#FB8C00', level: 'mid' },
      { paths: [
        { lat: 37.57998, lng: 126.99095 }, { lat: 37.58003, lng: 126.99100 }, { lat: 37.58000, lng: 126.99107 },
        { lat: 37.57995, lng: 126.99102 }
      ], color: '#FB8C00', level: 'mid' },
      { paths: [
        { lat: 37.57938, lng: 126.99135 }, { lat: 37.57944, lng: 126.99138 }, { lat: 37.57946, lng: 126.99145 },
        { lat: 37.57940, lng: 126.99147 }, { lat: 37.57936, lng: 126.99140 }
      ], color: '#FB8C00', level: 'mid' },
      { paths: [
        { lat: 37.57978, lng: 126.99078 }, { lat: 37.57984, lng: 126.99082 },
        { lat: 37.57982, lng: 126.99088 }, { lat: 37.57976, lng: 126.99085 }
      ], color: '#FB8C00', level: 'mid' },
      // ì €ìœ„í—˜ (ë…¸ë‘) - 4ê°œ
      { paths: [
        { lat: 37.57955, lng: 126.99125 }, { lat: 37.57960, lng: 126.99128 },
        { lat: 37.57958, lng: 126.99134 }, { lat: 37.57953, lng: 126.99131 }
      ], color: '#FFD54F', level: 'low' },
      { paths: [
        { lat: 37.57990, lng: 126.99060 }, { lat: 37.57995, lng: 126.99063 }, { lat: 37.57993, lng: 126.99070 },
        { lat: 37.57988, lng: 126.99067 }
      ], color: '#FFD54F', level: 'low' },
      { paths: [
        { lat: 37.57918, lng: 126.99115 }, { lat: 37.57924, lng: 126.99118 }, { lat: 37.57926, lng: 126.99124 },
        { lat: 37.57920, lng: 126.99126 }, { lat: 37.57916, lng: 126.99120 }
      ], color: '#FFD54F', level: 'low' },
      { paths: [
        { lat: 37.57968, lng: 126.99098 }, { lat: 37.57973, lng: 126.99102 },
        { lat: 37.57970, lng: 126.99108 }, { lat: 37.57965, lng: 126.99104 }
      ], color: '#FFD54F', level: 'low' }
    ];
    */

    // ìˆ˜ë¦¬ ì´ë ¥ í´ë¦¬ê³¤ ë°ì´í„°ë„ JSONì—ì„œ ë¡œë“œí•©ë‹ˆë‹¤
    /*
    const repairPolygons_OLD = [
      // ìˆ˜ë¦¬ í•„ìš” ë†’ìŒ (ë³´ë¼) - 4ê°œ
      { paths: [
        { lat: 37.57942, lng: 126.99075 }, { lat: 37.57948, lng: 126.99080 },
        { lat: 37.57945, lng: 126.99087 }, { lat: 37.57939, lng: 126.99082 }
      ], color: '#8E24AA', level: 'high' },
      { paths: [
        { lat: 37.57975, lng: 126.99110 }, { lat: 37.57980, lng: 126.99115 }, { lat: 37.57982, lng: 126.99122 },
        { lat: 37.57976, lng: 126.99124 }, { lat: 37.57972, lng: 126.99117 }
      ], color: '#8E24AA', level: 'high' },
      { paths: [
        { lat: 37.57995, lng: 126.99082 }, { lat: 37.58000, lng: 126.99085 },
        { lat: 37.57998, lng: 126.99092 }, { lat: 37.57993, lng: 126.99089 }
      ], color: '#8E24AA', level: 'high' },
      { paths: [
        { lat: 37.57932, lng: 126.99140 }, { lat: 37.57938, lng: 126.99143 }, { lat: 37.57940, lng: 126.99150 },
        { lat: 37.57934, lng: 126.99152 }, { lat: 37.57930, lng: 126.99145 }
      ], color: '#8E24AA', level: 'high' },
      // ìˆ˜ë¦¬ í•„ìš” ì¤‘ê°„ (ì—°ë³´ë¼) - 4ê°œ
      { paths: [
        { lat: 37.57958, lng: 126.99092 }, { lat: 37.57964, lng: 126.99095 },
        { lat: 37.57962, lng: 126.99102 }, { lat: 37.57956, lng: 126.99099 }
      ], color: '#AB47BC', level: 'mid' },
      { paths: [
        { lat: 37.57988, lng: 126.99135 }, { lat: 37.57993, lng: 126.99138 }, { lat: 37.57990, lng: 126.99145 },
        { lat: 37.57985, lng: 126.99142 }
      ], color: '#AB47BC', level: 'mid' },
      { paths: [
        { lat: 37.57922, lng: 126.99102 }, { lat: 37.57928, lng: 126.99105 }, { lat: 37.57930, lng: 126.99112 },
        { lat: 37.57924, lng: 126.99114 }, { lat: 37.57920, lng: 126.99107 }
      ], color: '#AB47BC', level: 'mid' },
      { paths: [
        { lat: 37.57965, lng: 126.99058 }, { lat: 37.57970, lng: 126.99062 },
        { lat: 37.57968, lng: 126.99068 }, { lat: 37.57963, lng: 126.99065 }
      ], color: '#AB47BC', level: 'mid' },
      // ìˆ˜ë¦¬ í•„ìš” ë‚®ìŒ (ì—°í•œ ë³´ë¼) - 4ê°œ
      { paths: [
        { lat: 37.57948, lng: 126.99118 }, { lat: 37.57953, lng: 126.99122 },
        { lat: 37.57950, lng: 126.99128 }, { lat: 37.57945, lng: 126.99125 }
      ], color: '#CE93D8', level: 'low' },
      { paths: [
        { lat: 37.57982, lng: 126.99068 }, { lat: 37.57987, lng: 126.99072 }, { lat: 37.57985, lng: 126.99078 },
        { lat: 37.57980, lng: 126.99075 }
      ], color: '#CE93D8', level: 'low' },
      { paths: [
        { lat: 37.57935, lng: 126.99125 }, { lat: 37.57940, lng: 126.99128 }, { lat: 37.57942, lng: 126.99135 },
        { lat: 37.57936, lng: 126.99137 }, { lat: 37.57933, lng: 126.99130 }
      ], color: '#CE93D8', level: 'low' },
      { paths: [
        { lat: 37.58002, lng: 126.99115 }, { lat: 37.58007, lng: 126.99118 }, { lat: 37.58005, lng: 126.99125 },
        { lat: 37.58000, lng: 126.99122 }
      ], color: '#CE93D8', level: 'low' }
    ];
    */

    // Google Maps ì´ˆê¸°í™”
    async function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: siteLocation,
        zoom: siteInfo.zoom,
        mapTypeId: 'satellite',
        mapTypeControl: false,
        streetViewControl: false,
        fullscreenControl: false,
      });

      // GIS ë Œë”ëŸ¬ ì´ˆê¸°í™”
      GISRenderer.init(map);

      // ì ê²€í‘œ ë°ì´í„° ë¡œë“œ (í‘œì‹œëŠ” í•˜ì§€ ì•ŠìŒ - ë²„íŠ¼ í´ë¦­ ì‹œì—ë§Œ í‘œì‹œ)
      inspectionsData = await DataLoader.loadAllInspections();
      console.log(`ì ê²€í‘œ ${inspectionsData.length}ê°œ ë¡œë“œ ì™„ë£Œ`);

      // GIS ë°ì´í„° ë¡œë“œë§Œ ìˆ˜í–‰ (ë Œë”ë§ì€ í•˜ì§€ ì•ŠìŒ - ë²„íŠ¼ í´ë¦­ ì‹œì—ë§Œ)
      gisData = await DataLoader.loadAllGIS();
      console.log('GIS ë°ì´í„° ë¡œë“œ ì™„ë£Œ (ë Œë”ë§ ëŒ€ê¸° ì¤‘)');

      // ì¬í•´/ìˆ˜ë¦¬ ì´ë ¥ ë°ì´í„° ë¡œë“œ
      allDisasterHistory = await DataLoader.loadDisasterHistory();
      allRepairHistory = await DataLoader.loadRepairHistory();
      console.log(`ì¬í•´ ì´ë ¥ ${allDisasterHistory.length}ê°œ, ìˆ˜ë¦¬ ì´ë ¥ ${allRepairHistory.length}ê°œ ë¡œë“œ ì™„ë£Œ`);

      // ê±´ë¬¼ í´ë¦¬ê³¤ ë°ì´í„° ë¡œë“œ
      try {
        const response = await fetch('data/gis/nakseonjae-buildings.geojson');
        buildingPolygons = await response.json();
        console.log(`ê±´ë¬¼ í´ë¦¬ê³¤ ${buildingPolygons.features.length}ê°œ ë¡œë“œ ì™„ë£Œ`);
      } catch (error) {
        console.error('ê±´ë¬¼ í´ë¦¬ê³¤ ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }

    // ë©”ë‰´ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
    function setActiveMenu(index) {
      const menuItems = document.querySelectorAll('.menu-item');
      menuItems.forEach((item, i) => {
        item.classList.toggle('active', i === index);
      });
    }

    // ëª¨ë“  ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
    function hideAllOverlays() {
      document.getElementById('disasterOverlay').classList.remove('active');
      document.getElementById('repairOverlay').classList.remove('active');
      document.querySelector('.repair-submenu-container').classList.remove('active');

      // ëª¨ë“  íŒì—… ëª¨ë‹¬ ë‹«ê¸°
      closeDisasterModal();
      closeRepairModal();
      closeInspectionDetail();
      closeSecondModal();

      clearPolygons();
      clearInspectionMarkers();
      currentMode = null;
    }

    // ê¸°ë³¸ ì •ë³´ í‘œì‹œ
    function showBasicInfo() {
      hideAllOverlays();
      setActiveMenu(0);
      document.getElementById('basicInfoModal').classList.add('active');
    }

    // ì ê²€ ì´ë ¥ í‘œì‹œ
    let currentInspectionId = null;

    function showInspectionHistory() {
      hideAllOverlays();
      setActiveMenu(1);
      currentMode = 'inspection';

      // ì‹¤ì œ ì ê²€í‘œ ë°ì´í„°ë¡œ ë§ˆì»¤ ìƒì„± (í´ë¦­ ì´ë²¤íŠ¸ í™œì„±í™”)
      if (inspectionsData && inspectionsData.length > 0) {
        GISRenderer.addAllInspectionMarkers(inspectionsData, onInspectionMarkerClick);
      } else {
        console.warn('ì ê²€í‘œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
      }
    }

    // ë§ˆì»¤ í´ë¦­ ì‹œ ê°„ë‹¨ íŒì—… í‘œì‹œ
    function onInspectionMarkerClick(inspection) {
      currentInspectionId = inspection.id;

      // íŒì—… ì œëª© ì„¤ì •
      document.getElementById('inspectionSimpleTitle').textContent =
        `${inspection.targetName} (${inspection.targetType})`;

      // íŒì—… í‘œì‹œ
      document.getElementById('inspectionDetailModal').style.display = 'flex';
    }

    // íŒì—… ë‹«ê¸°
    function closeInspectionDetail() {
      const modal = document.getElementById('inspectionDetailModal');
      if (modal) {
        modal.style.display = 'none';
      }
      currentInspectionId = null;
    }

    // 2ì°¨ íŒì—… ì—´ê¸° (1ì°¨ íŒì—… ìˆ¨ê¸°ê¸°)
    function openSecondModal(title, content) {
      document.getElementById('inspectionDetailModal').style.display = 'none';
      document.getElementById('inspectionSecondTitle').textContent = title;
      document.getElementById('inspectionSecondBody').innerHTML = content;
      document.getElementById('inspectionSecondModal').style.display = 'flex';
    }

    // 2ì°¨ íŒì—… ë‹«ê¸°
    function closeSecondModal() {
      document.getElementById('inspectionSecondModal').style.display = 'none';
      currentInspectionId = null;
    }

    // 2ì°¨ íŒì—…ì—ì„œ 1ì°¨ íŒì—…ìœ¼ë¡œ ëŒì•„ê°€ê¸°
    function backToFirstModal() {
      document.getElementById('inspectionSecondModal').style.display = 'none';
      document.getElementById('inspectionDetailModal').style.display = 'flex';
    }

    // ì•ˆì „ ì ê²€ ë³´ê³ ì„œ ë³´ê¸° (2ì°¨ íŒì—…)
    function viewInspectionReport() {
      if (!currentInspectionId) return;

      const inspection = inspectionsData.find(i => i.id === currentInspectionId);
      if (!inspection) {
        alert('ì ê²€ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      // í†µì¼ëœ ì•ˆì „ ì ê²€ ë³´ê³ ì„œ PNG ì´ë¯¸ì§€ ê²½ë¡œ
      const reportImagePath = `assets/photos/nakseonjae/ì•ˆì „ ì ê²€ ë³´ê³ ì„œ.PNG`;

      const content = `
        <div class="report-image-container">
          <img src="${reportImagePath}" alt="ì•ˆì „ì ê²€ ë³´ê³ ì„œ" onerror="this.parentElement.innerHTML='<p style=\\'text-align:center;color:#999;padding:40px;\\'>ë³´ê³ ì„œ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>'">
        </div>
      `;

      openSecondModal('ì•ˆì „ ì ê²€ ë³´ê³ ì„œ', content);
    }

    // ë©”íƒ€í¬íŠ¸ ë³´ê¸° (2ì°¨ íŒì—…)
    function viewMetaReport() {
      if (!currentInspectionId) return;

      const content = `
        <div style="text-align: center; padding: 40px; color: #999;">
          <p style="font-size: 16px; margin-bottom: 12px;">ğŸ“Š</p>
          <p>ë©”íƒ€í¬íŠ¸ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</p>
        </div>
      `;

      openSecondModal('ë©”íƒ€í¬íŠ¸', content);
    }

    // ì‚¬ì§„ ë¦¬ìŠ¤íŠ¸ ë³´ê¸° (2ì°¨ íŒì—…)
    function viewPhotos() {
      if (!currentInspectionId) return;

      const inspection = inspectionsData.find(i => i.id === currentInspectionId);
      if (!inspection || !inspection.photos || inspection.photos.length === 0) {
        alert('ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      // ì‚¬ì§„ ê²½ë¡œ ì²˜ë¦¬
      const photoUrls = inspection.photos.map(photoPath => {
        if (photoPath.includes('assets/photos')) {
          return photoPath;
        } else {
          return `assets/photos/nakseonjae/${photoPath}`;
        }
      });

      // ì‚¬ì§„ ê·¸ë¦¬ë“œ HTML ìƒì„±
      let photoGridHTML = '<div class="photo-grid">';
      photoUrls.forEach((url, index) => {
        const filename = url.split('/').pop();
        photoGridHTML += `
          <div class="photo-item" onclick="openPhotoGallery(${index})">
            <img src="${url}" alt="${filename}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'200\\' height=\\'200\\'%3E%3Crect fill=\\'%23f0f0f0\\' width=\\'200\\' height=\\'200\\'/%3E%3Ctext x=\\'50%25\\' y=\\'50%25\\' dominant-baseline=\\'middle\\' text-anchor=\\'middle\\' fill=\\'%23999\\'%3Eì´ë¯¸ì§€ ì—†ìŒ%3C/text%3E%3C/svg%3E'">
            <div class="photo-item-label">${filename}</div>
          </div>
        `;
      });
      photoGridHTML += '</div>';

      // ì „ì—­ ë³€ìˆ˜ë¡œ ì‚¬ì§„ URL ì €ì¥ (ê°¤ëŸ¬ë¦¬ ì˜¤í”ˆìš©)
      window.currentPhotoUrls = photoUrls;

      openSecondModal(`ì‚¬ì§„ (${photoUrls.length}ì¥)`, photoGridHTML);
    }

    // ì‚¬ì§„ ê°¤ëŸ¬ë¦¬ ì—´ê¸°
    function openPhotoGallery(index) {
      if (window.currentPhotoUrls && window.currentPhotoUrls.length > 0) {
        if (typeof PhotoGallery !== 'undefined' && PhotoGallery.showModal) {
          PhotoGallery.showModal(window.currentPhotoUrls, index);
        } else {
          // PhotoGalleryê°€ ì—†ìœ¼ë©´ ìƒˆ íƒ­ì—ì„œ ì´ë¯¸ì§€ ì—´ê¸°
          window.open(window.currentPhotoUrls[index], '_blank');
        }
      }
    }

    // ì ê²€ ìƒì„¸ ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜
    function showInspectionModal(inspection) {
      // ê¸°ì¡´ ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ì œê±°
      const existingModal = document.querySelector('.inspection-modal');
      if (existingModal) {
        existingModal.remove();
      }

      // ë“±ê¸‰ë³„ ìƒ‰ìƒ ê²°ì •
      const getRatingColor = (rating) => {
        const colors = {
          'ì•ˆì „': '#4CAF50',
          'ê´€ì‹¬': '#2196F3',
          'ì£¼ì˜': '#FF9800',
          'ê²½ê³„': '#FF5722',
          'ìœ„í—˜': '#F44336'
        };
        return colors[rating] || '#666';
      };

      const overallRating = inspection.overallAssessment ? inspection.overallAssessment.rating : 'ë¯¸í™•ì¸';
      const ratingColor = getRatingColor(overallRating);

      // ì‚¬ì§„ ëª©ë¡ ìƒì„±
      const photoUrls = DataLoader.getPhotoUrls(inspection);
      const photoGridHTML = photoUrls.length > 0 ? `
        <div class="photo-grid">
          ${photoUrls.slice(0, 6).map((url, index) => `
            <img src="${url}"
                 alt="ì ê²€ ì‚¬ì§„ ${index + 1}"
                 style="width: 100px; height: 100px; object-fit: cover; cursor: pointer; border-radius: 4px;"
                 onerror="this.style.display='none';">
          `).join('')}
        </div>
      ` : '<p style="color: #999;">ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.</p>';

      // ëª¨ë‹¬ HTML ìƒì„±
      const modal = document.createElement('div');
      modal.className = 'inspection-modal';
      modal.innerHTML = `
        <div class="modal-content">
          <button class="close-btn" onclick="this.closest('.inspection-modal').remove()">&times;</button>
          <h3 style="margin-top: 0; color: #333;">${inspection.targetName} ì ê²€ ìƒì„¸</h3>
          <div class="modal-body">
            <p style="margin: 8px 0;"><strong>ì ê²€ ìœ í˜•:</strong> ${inspection.targetType}</p>
            <p style="margin: 8px 0;"><strong>ì ê²€ ì¼ì:</strong> ${inspection.inspectionDate}</p>
            <p style="margin: 8px 0;">
              <strong>ì¢…í•© íŒì •:</strong>
              <span style="color: ${ratingColor}; font-weight: 700; font-size: 16px;">${overallRating}</span>
            </p>
            <div style="margin-top: 16px;">
              <strong>ì‚¬ì§„ ê¸°ë¡:</strong>
              <div style="margin-top: 8px;">
                ${photoGridHTML}
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button onclick="window.location.href='inspection-confirm.html?id=${inspection.id}'"
                    style="width: 100%; padding: 12px; background: #0052CC; color: white; border: none;
                           border-radius: 8px; cursor: pointer; font-size: 16px; margin-bottom: 8px;">
              ì „ì²´ ë³´ê³ ì„œ ë³´ê¸° â†’
            </button>
            <button onclick="window.location.href='inspection-checklist.html?id=${inspection.id}'"
                    style="width: 100%; padding: 12px; background: #4CAF50; color: white; border: none;
                           border-radius: 8px; cursor: pointer; font-size: 16px;">
              ì ê²€í‘œ ìˆ˜ì •í•˜ê¸° â†’
            </button>
          </div>
        </div>
      `;

      document.body.appendChild(modal);

      // ëª¨ë‹¬ í´ë¦­ ì‹œ ë‹«ê¸° (ë°°ê²½ í´ë¦­)
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.remove();
        }
      });
    }

    // ì ê²€ ì´ë ¥ íŒì—… í‘œì‹œ
    function showInspectionPopup(x, y, point) {
      const popup = document.getElementById('inspectionPopup');
      popup.style.left = x + 'px';
      popup.style.top = y + 'px';
      popup.classList.add('active');
      popup.dataset.pointId = point.id;
    }

    // ì ê²€ ì´ë ¥ ë§ˆì»¤ ì œê±°
    function clearInspectionMarkers() {
      GISRenderer.clearMarkers();
      document.getElementById('inspectionPopup').classList.remove('active');
    }

    // ì¬í•´ ì´ë ¥ í‘œì‹œ
    function showDisasterHistory() {
      hideAllOverlays();
      setActiveMenu(2);
      currentMode = 'disaster';
      document.getElementById('disasterOverlay').classList.add('active');

      // ì „ì²´ ì¬í•´ ì´ë ¥ í‘œì‹œ
      renderDisasterHistory(allDisasterHistory);
    }

    // ì¬í•´ ì´ë ¥ í•„í„° ì ìš©
    function applyDisasterFilters() {
      const elementFilter = document.getElementById('disasterElementFilter').value;
      const typeFilter = document.getElementById('disasterTypeFilter').value;
      const yearFilter = document.getElementById('disasterYearFilter').value;

      console.log('ì¬í•´ ì´ë ¥ í•„í„°:', { elementFilter, typeFilter, yearFilter });

      let filtered = allDisasterHistory;

      // elementType í•„í„°
      if (elementFilter !== 'all') {
        filtered = filtered.filter(item => item.elementType === elementFilter);
      }

      // type í•„í„° (í˜¸ìš°, ê°•í’, íƒœí’)
      if (typeFilter !== 'all') {
        filtered = filtered.filter(item => item.type && item.type.includes(typeFilter));
      }

      // year í•„í„°
      if (yearFilter !== 'all') {
        const year = parseInt(yearFilter);
        filtered = filtered.filter(item => item.year === year);
      }

      console.log(`ì¬í•´ ì´ë ¥ í•„í„°ë§ ê²°ê³¼: ${filtered.length}ê°œ í•­ëª©`);
      renderDisasterHistory(filtered);
    }

    // ì¬í•´ ì´ë ¥ ë Œë”ë§ í•¨ìˆ˜ (ê±´ë¬¼ í´ë¦¬ê³¤ ê¸°ë°˜)
    function renderDisasterHistory(disasters) {
      clearPolygons();

      if (!buildingPolygons || !buildingPolygons.features) {
        console.error('ê±´ë¬¼ í´ë¦¬ê³¤ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      // ìœ„ì¹˜ë³„ ì¬í•´ íšŸìˆ˜ ê³„ì‚° (ì¢Œí‘œê°€ ë¹„ìŠ·í•œ ê²ƒë“¤ì„ ê·¸ë£¹í•‘)
      const locationGroups = {};
      disasters.forEach(disaster => {
        // ì¢Œí‘œë¥¼ ì†Œìˆ˜ì  4ìë¦¬ë¡œ ë°˜ì˜¬ë¦¼í•˜ì—¬ ê·¸ë£¹í•‘ í‚¤ ìƒì„±
        const key = `${disaster.coordinates.lat.toFixed(4)},${disaster.coordinates.lng.toFixed(4)}`;
        if (!locationGroups[key]) {
          locationGroups[key] = [];
        }
        locationGroups[key].push(disaster);
      });

      // ê° ì¬í•´ ê·¸ë£¹ì— ëŒ€í•´ ê°€ì¥ ê°€ê¹Œìš´ ê±´ë¬¼ ì°¾ì•„ì„œ í´ë¦¬ê³¤ í‘œì‹œ
      Object.entries(locationGroups).forEach(([key, groupDisasters]) => {
        const disasterCount = groupDisasters.length;
        const representativeDisaster = groupDisasters[0];

        // íšŸìˆ˜ì— ë”°ë¥¸ ìƒ‰ìƒ ê²°ì • (ë²”ë¡€ì™€ ì¼ì¹˜)
        let color;
        if (disasterCount >= 10) {
          color = '#E53935'; // ë¹¨ê°• - 10íšŒ ì´ìƒ (ë²”ë¡€ ì¼ì¹˜)
        } else if (disasterCount >= 5) {
          color = '#FB8C00'; // ì£¼í™© - 5íšŒ ì´ìƒ (ë²”ë¡€ ì¼ì¹˜)
        } else {
          color = '#FFD54F'; // ë…¸ë‘ - 1íšŒ ì´ìƒ (ë²”ë¡€ ì¼ì¹˜)
        }

        // ê°€ì¥ ê°€ê¹Œìš´ ê±´ë¬¼ ì°¾ê¸°
        const nearestBuilding = findNearestBuilding(representativeDisaster.coordinates);

        if (nearestBuilding) {
          // ê±´ë¬¼ í´ë¦¬ê³¤ í‘œì‹œ
          const polygon = new google.maps.Polygon({
            paths: nearestBuilding.geometry.coordinates[0].map(coord => ({
              lat: coord[1],
              lng: coord[0]
            })),
            strokeColor: color,
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: color,
            fillOpacity: 0.4,
            map: map,
            clickable: true
          });

          // Hover ì´ë²¤íŠ¸: ê°œì„ ëœ íˆ´íŒ í‘œì‹œ
          let hoverInfoWindow = null;
          polygon.addListener('mouseover', (event) => {
            // í´ë¦¬ê³¤ ê°•ì¡° íš¨ê³¼
            polygon.setOptions({
              strokeWeight: 3,
              fillOpacity: 0.5
            });

            // í´ë¦¬ê³¤ì˜ ìƒë‹¨ ì¤‘ì‹¬ ì¢Œí‘œ ê³„ì‚°
            const coords = nearestBuilding.geometry.coordinates[0];
            const lats = coords.map(c => c[1]);
            const lngs = coords.map(c => c[0]);
            const topLat = Math.max(...lats);
            const centerLng = lngs.reduce((sum, lng) => sum + lng, 0) / lngs.length;

            const tooltipContent = `
              <div class="history-tooltip">
                <div class="tooltip-header">
                  <strong>${representativeDisaster.year}ë…„ ì¬í•´</strong>
                  <span class="tooltip-badge">${disasterCount}ê±´</span>
                </div>
                <div class="tooltip-body">
                  <div class="tooltip-item">
                    <span class="tooltip-label">ì¢…ë¥˜:</span>
                    <span class="tooltip-value">${representativeDisaster.type}</span>
                  </div>
                  <div class="tooltip-item">
                    <span class="tooltip-label">ëŒ€ìƒ:</span>
                    <span class="tooltip-value">${representativeDisaster.target || 'ë¯¸ìƒ'}</span>
                  </div>
                </div>
                <div class="tooltip-footer">
                  <span class="tooltip-action">ğŸ“‹ í´ë¦­í•˜ì—¬ ìì„¸íˆ ë³´ê¸°</span>
                </div>
              </div>
            `;
            hoverInfoWindow = new google.maps.InfoWindow({
              content: tooltipContent,
              position: { lat: topLat, lng: centerLng },
              disableAutoPan: true
            });
            hoverInfoWindow.open(map);
          });

          polygon.addListener('mouseout', () => {
            // í´ë¦¬ê³¤ ì›ìƒë³µêµ¬
            polygon.setOptions({
              strokeWeight: 2,
              fillOpacity: 0.4
            });

            if (hoverInfoWindow) {
              hoverInfoWindow.close();
              hoverInfoWindow = null;
            }
          });

          // í´ë¦­ ì´ë²¤íŠ¸: í…Œì´ë¸” ëª¨ë‹¬ í‘œì‹œ
          polygon.addListener('click', () => {
            if (hoverInfoWindow) {
              hoverInfoWindow.close();
            }
            showDisasterTableModal(groupDisasters);
          });

          polygons.push(polygon);
        }
      });
    }

    // ê°€ì¥ ê°€ê¹Œìš´ ê±´ë¬¼ ì°¾ê¸° í•¨ìˆ˜
    function findNearestBuilding(coordinates) {
      if (!buildingPolygons || !buildingPolygons.features) return null;

      let nearestBuilding = null;
      let minDistance = Infinity;

      buildingPolygons.features.forEach(feature => {
        // ê±´ë¬¼ í´ë¦¬ê³¤ì˜ ì¤‘ì‹¬ì  ê³„ì‚°
        const coords = feature.geometry.coordinates[0];
        const centerLat = coords.reduce((sum, c) => sum + c[1], 0) / coords.length;
        const centerLng = coords.reduce((sum, c) => sum + c[0], 0) / coords.length;

        // ê±°ë¦¬ ê³„ì‚° (ê°„ë‹¨í•œ ìœ í´ë¦¬ë“œ ê±°ë¦¬)
        const distance = Math.sqrt(
          Math.pow(coordinates.lat - centerLat, 2) +
          Math.pow(coordinates.lng - centerLng, 2)
        );

        if (distance < minDistance) {
          minDistance = distance;
          nearestBuilding = feature;
        }
      });

      // ê±°ë¦¬ê°€ ë„ˆë¬´ ë¨¼ ê²½ìš° (0.001ë„ = ì•½ 100m ì´ìƒ) null ë°˜í™˜
      if (minDistance > 0.001) {
        return null;
      }

      return nearestBuilding;
    }

    // ì¬í•´ ì •ë³´ í‘œì‹œ í•¨ìˆ˜
    function showDisasterInfo(disaster, groupDisasters = null, disasterCount = 1) {
      const hasGroup = groupDisasters && groupDisasters.length > 1;

      let infoContent = `
        <div style="padding: 10px; max-width: 300px;">
          <h4 style="margin: 0 0 8px 0; color: #E53935;">ì¬í•´ ì´ë ¥</h4>
          ${hasGroup ? `<p style="margin: 4px 0; font-weight: bold; color: #E53935;">ì´ ìœ„ì¹˜ ì´ ${disasterCount}íšŒ ì¬í•´</p>` : ''}
          <p style="margin: 4px 0;"><strong>ì—°ë„:</strong> ${disaster.year}ë…„</p>
          <p style="margin: 4px 0;"><strong>ìœ„ì¹˜:</strong> ${disaster.location}</p>
          <p style="margin: 4px 0;"><strong>ì¢…ë¥˜:</strong> ${disaster.type}</p>
          <p style="margin: 4px 0;"><strong>ëŒ€ìƒ:</strong> ${disaster.target}</p>
          <p style="margin: 4px 0;"><strong>í”¼í•´:</strong> ${disaster.damage}</p>
      `;

      // ê·¸ë£¹ì´ ìˆìœ¼ë©´ ì „ì²´ ëª©ë¡ í‘œì‹œ
      if (hasGroup && groupDisasters.length > 1) {
        infoContent += `
          <hr style="margin: 10px 0; border: none; border-top: 1px solid #ddd;">
          <p style="margin: 4px 0; font-size: 12px; color: #666;"><strong>ì „ì²´ ì¬í•´ ì´ë ¥:</strong></p>
          <div style="max-height: 150px; overflow-y: auto;">
        `;
        groupDisasters.forEach((d, index) => {
          infoContent += `
            <p style="margin: 4px 0; font-size: 11px; padding: 4px; background: #f5f5f5; border-radius: 3px;">
              ${index + 1}. ${d.year}ë…„ - ${d.type} (${d.damage.substring(0, 30)}${d.damage.length > 30 ? '...' : ''})
            </p>
          `;
        });
        infoContent += '</div>';
      }
      infoContent += '</div>';

      const infoWindow = new google.maps.InfoWindow({
        content: infoContent,
        position: disaster.coordinates
      });

      infoWindow.open(map);
    }

    // ì¬í•´ ì´ë ¥ í…Œì´ë¸” ëª¨ë‹¬ í‘œì‹œ
    function showDisasterTableModal(disasters) {
      const tableContent = document.getElementById('disasterTableContent');
      let html = `
        <thead>
          <tr>
            <th style="width: 80px;">ì—°ë„</th>
            <th style="width: 100px;">ì§€ì—­</th>
            <th style="width: 120px;">ì¬í•´ì¢…ë¥˜</th>
            <th style="width: 150px;">ì¬í•´ ëŒ€ìƒ</th>
            <th>ë‚´ìš©</th>
            <th style="width: 100px;">íŠ¹ê¸°ì‚¬í•­</th>
          </tr>
        </thead>
        <tbody>
      `;

      disasters.forEach(disaster => {
        html += `
          <tr>
            <td>${disaster.year}</td>
            <td>${disaster.location}</td>
            <td>${disaster.type}</td>
            <td>${disaster.target}</td>
            <td style="text-align: left;">${disaster.damage}</td>
            <td>${disaster.severity === 'high' ? 'ì§€ì²´ì—†êµ¬' : (disaster.severity === 'medium' ? 'ìì œí™•êµ¬' : '')}</td>
          </tr>
        `;
      });

      html += '</tbody>';
      tableContent.innerHTML = html;
      document.getElementById('disasterTableModal').style.display = 'flex';
    }

    // ì¬í•´ ì´ë ¥ ëª¨ë‹¬ ë‹«ê¸°
    function closeDisasterModal() {
      document.getElementById('disasterTableModal').style.display = 'none';
    }

    // ìˆ˜ë¦¬ ì´ë ¥ í…Œì´ë¸” ëª¨ë‹¬ í‘œì‹œ
    function showRepairTableModal(repairs) {
      const tableContent = document.getElementById('repairTableContent');
      let html = `
        <thead>
          <tr>
            <th style="width: 80px;">ì—°ë„</th>
            <th style="width: 120px;">ì£¼ë³€ ì§€í˜•</th>
            <th style="width: 120px;">ìˆ˜ë¦¬ ëŒ€ìƒ</th>
            <th>ì •ë¹„ ë³´ìˆ˜ ìˆ˜ë¦¬</th>
            <th style="width: 100px;">ì˜ˆì‚°(ì²œì›)</th>
          </tr>
        </thead>
        <tbody>
      `;

      repairs.forEach(repair => {
        const isDummy = repair.note === "ë”ë¯¸ ë°ì´í„°";
        html += `
          <tr ${isDummy ? 'style="background: #FFF9C4;"' : ''}>
            <td>${repair.year}${isDummy ? ' <span style="color: #F57C00; font-size: 10px; font-weight: bold;">ë”ë¯¸</span>' : ''}</td>
            <td>${repair.elementType}</td>
            <td>${repair.target}</td>
            <td style="text-align: left;">${repair.workDescription}</td>
            <td>${repair.cost || '-'}</td>
          </tr>
        `;
      });

      html += '</tbody>';
      tableContent.innerHTML = html;
      document.getElementById('repairTableModal').style.display = 'flex';
    }

    // ìˆ˜ë¦¬ ì´ë ¥ ëª¨ë‹¬ ë‹«ê¸°
    function closeRepairModal() {
      document.getElementById('repairTableModal').style.display = 'none';
    }

    // ìˆ˜ë¦¬ ì´ë ¥ í‘œì‹œ
    function showRepairHistory() {
      hideAllOverlays();
      setActiveMenu(3);
      currentMode = 'repair';
      document.getElementById('repairOverlay').classList.add('active');
      document.querySelector('.repair-submenu-container').classList.add('active');

      // ì „ì²´ ìˆ˜ë¦¬ ì´ë ¥ í‘œì‹œ (í•„í„°: 'ì „í†µì¡°ê²½ìš”ì†Œ')
      renderRepairHistory(allRepairHistory);
    }

    // ìˆ˜ë¦¬ ì´ë ¥ ë Œë”ë§ í•¨ìˆ˜ (ê±´ë¬¼ í´ë¦¬ê³¤ ê¸°ë°˜)
    function renderRepairHistory(repairs) {
      clearPolygons();

      if (!buildingPolygons || !buildingPolygons.features) {
        console.error('ê±´ë¬¼ í´ë¦¬ê³¤ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      // ìœ„ì¹˜ë³„ ìˆ˜ë¦¬ íšŸìˆ˜ ê³„ì‚° (ì¢Œí‘œê°€ ë¹„ìŠ·í•œ ê²ƒë“¤ì„ ê·¸ë£¹í•‘)
      const locationGroups = {};
      repairs.forEach(repair => {
        // ì¢Œí‘œë¥¼ ì†Œìˆ˜ì  4ìë¦¬ë¡œ ë°˜ì˜¬ë¦¼í•˜ì—¬ ê·¸ë£¹í•‘ í‚¤ ìƒì„±
        const key = `${repair.coordinates.lat.toFixed(4)},${repair.coordinates.lng.toFixed(4)}`;
        if (!locationGroups[key]) {
          locationGroups[key] = [];
        }
        locationGroups[key].push(repair);
      });

      // ê° ìˆ˜ë¦¬ ê·¸ë£¹ì— ëŒ€í•´ ê°€ì¥ ê°€ê¹Œìš´ ê±´ë¬¼ ì°¾ì•„ì„œ í´ë¦¬ê³¤ í‘œì‹œ
      Object.entries(locationGroups).forEach(([key, groupRepairs]) => {
        const repairCount = groupRepairs.length;
        const representativeRepair = groupRepairs[0];

        // íšŸìˆ˜ì— ë”°ë¥¸ ìƒ‰ìƒ ê²°ì • (ë²”ë¡€ì™€ ì¼ì¹˜)
        let color;
        if (repairCount >= 10) {
          color = '#6A1B9A'; // ë³´ë¼ìƒ‰ (ì§„í•œ) - 10íšŒ ì´ìƒ
        } else if (repairCount >= 5) {
          color = '#8E24AA'; // ë³´ë¼ìƒ‰ (ì¤‘ê°„) - 5íšŒ ì´ìƒ
        } else {
          color = '#BA68C8'; // ë³´ë¼ìƒ‰ (ì—°í•œ) - 1íšŒ ì´ìƒ
        }

        // ê°€ì¥ ê°€ê¹Œìš´ ê±´ë¬¼ ì°¾ê¸°
        const nearestBuilding = findNearestBuilding(representativeRepair.coordinates);

        if (nearestBuilding) {
          // ê±´ë¬¼ í´ë¦¬ê³¤ í‘œì‹œ
          const polygon = new google.maps.Polygon({
            paths: nearestBuilding.geometry.coordinates[0].map(coord => ({
              lat: coord[1],
              lng: coord[0]
            })),
            strokeColor: color,
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: color,
            fillOpacity: 0.4,
            map: map,
            clickable: true
          });

          // Hover ì´ë²¤íŠ¸: ê°œì„ ëœ íˆ´íŒ í‘œì‹œ
          let hoverInfoWindow = null;
          polygon.addListener('mouseover', (event) => {
            // í´ë¦¬ê³¤ ê°•ì¡° íš¨ê³¼
            polygon.setOptions({
              strokeWeight: 3,
              fillOpacity: 0.5
            });

            // í´ë¦¬ê³¤ì˜ ìƒë‹¨ ì¤‘ì‹¬ ì¢Œí‘œ ê³„ì‚°
            const coords = nearestBuilding.geometry.coordinates[0];
            const lats = coords.map(c => c[1]);
            const lngs = coords.map(c => c[0]);
            const topLat = Math.max(...lats);
            const centerLng = lngs.reduce((sum, lng) => sum + lng, 0) / lngs.length;

            const tooltipContent = `
              <div class="history-tooltip">
                <div class="tooltip-header">
                  <strong>${representativeRepair.year}ë…„ ìˆ˜ë¦¬</strong>
                  <span class="tooltip-badge repair">${repairCount}ê±´</span>
                </div>
                <div class="tooltip-body">
                  <div class="tooltip-item">
                    <span class="tooltip-label">ì¢…ë¥˜:</span>
                    <span class="tooltip-value">${representativeRepair.repairType}</span>
                  </div>
                  <div class="tooltip-item">
                    <span class="tooltip-label">ëŒ€ìƒ:</span>
                    <span class="tooltip-value">${representativeRepair.target || 'ë¯¸ìƒ'}</span>
                  </div>
                </div>
                <div class="tooltip-footer">
                  <span class="tooltip-action">ğŸ“‹ í´ë¦­í•˜ì—¬ ìì„¸íˆ ë³´ê¸°</span>
                </div>
              </div>
            `;
            hoverInfoWindow = new google.maps.InfoWindow({
              content: tooltipContent,
              position: { lat: topLat, lng: centerLng },
              disableAutoPan: true
            });
            hoverInfoWindow.open(map);
          });

          polygon.addListener('mouseout', () => {
            // í´ë¦¬ê³¤ ì›ìƒë³µêµ¬
            polygon.setOptions({
              strokeWeight: 2,
              fillOpacity: 0.4
            });

            if (hoverInfoWindow) {
              hoverInfoWindow.close();
              hoverInfoWindow = null;
            }
          });

          // í´ë¦­ ì´ë²¤íŠ¸: í…Œì´ë¸” ëª¨ë‹¬ í‘œì‹œ
          polygon.addListener('click', () => {
            if (hoverInfoWindow) {
              hoverInfoWindow.close();
            }
            showRepairTableModal(groupRepairs);
          });

          polygons.push(polygon);
        }
      });
    }

    // ìˆ˜ë¦¬ ì •ë³´ í‘œì‹œ í•¨ìˆ˜
    function showRepairInfo(repair, groupRepairs = null, repairCount = 1) {
      // ê·¸ë£¹ì´ ìˆìœ¼ë©´ ê·¸ë£¹ ì •ë³´ í‘œì‹œ, ì—†ìœ¼ë©´ ë‹¨ì¼ í•­ëª© í‘œì‹œ
      const hasGroup = groupRepairs && groupRepairs.length > 1;

      let infoContent = `
        <div style="padding: 10px; max-width: 300px;">
          <h4 style="margin: 0 0 8px 0; color: #8E24AA;">ìˆ˜ë¦¬ ì´ë ¥</h4>
          ${hasGroup ? `<p style="margin: 4px 0; font-weight: bold; color: #8E24AA;">ì´ ìœ„ì¹˜ ì´ ${repairCount}íšŒ ìˆ˜ë¦¬</p>` : ''}
          <p style="margin: 4px 0;"><strong>ì—°ë„:</strong> ${repair.year}ë…„</p>
          <p style="margin: 4px 0;"><strong>ìœ„ì¹˜:</strong> ${repair.location}</p>
          <p style="margin: 4px 0;"><strong>ëŒ€ìƒ:</strong> ${repair.target}</p>
          <p style="margin: 4px 0;"><strong>ë‚´ìš©:</strong> ${repair.workDescription}</p>
          ${repair.cost ? `<p style="margin: 4px 0;"><strong>ë¹„ìš©:</strong> ${repair.cost}</p>` : ''}
      `;

      // ê·¸ë£¹ì´ ìˆìœ¼ë©´ ì „ì²´ ëª©ë¡ í‘œì‹œ
      if (hasGroup && groupRepairs.length > 1) {
        infoContent += `
          <hr style="margin: 10px 0; border: none; border-top: 1px solid #ddd;">
          <p style="margin: 4px 0; font-size: 12px; color: #666;"><strong>ì „ì²´ ìˆ˜ë¦¬ ì´ë ¥:</strong></p>
          <div style="max-height: 150px; overflow-y: auto;">
        `;
        groupRepairs.forEach((r, index) => {
          infoContent += `
            <p style="margin: 4px 0; font-size: 11px; padding: 4px; background: #f5f5f5; border-radius: 3px;">
              ${index + 1}. ${r.year}ë…„ - ${r.workDescription.substring(0, 30)}${r.workDescription.length > 30 ? '...' : ''}
            </p>
          `;
        });
        infoContent += '</div>';
      }

      infoContent += '</div>';

      const infoWindow = new google.maps.InfoWindow({
        content: infoContent,
        position: repair.coordinates
      });

      infoWindow.open(map);
    }

    // ìˆ˜ë¦¬ ì´ë ¥ í•„í„° ì„ íƒ
    function selectRepairFilter(filterType) {
      // ëª¨ë“  ì„œë¸Œë©”ë‰´ ì•„ì´í…œ ë¹„í™œì„±í™”
      document.querySelectorAll('#repairSubmenu .submenu-item').forEach(item => {
        item.classList.remove('active');
      });
      // í´ë¦­í•œ ì•„ì´í…œ í™œì„±í™”
      event.currentTarget.classList.add('active');

      console.log('ìˆ˜ë¦¬ ì´ë ¥ ì„ íƒëœ í•„í„°:', filterType);

      // DataLoaderì˜ í•„í„°ë§ í•¨ìˆ˜ ì‚¬ìš© (elementType ê¸°ë°˜)
      const filtered = DataLoader.filterHistory(allRepairHistory, filterType);
      console.log(`ìˆ˜ë¦¬ ì´ë ¥ í•„í„°ë§ ê²°ê³¼: ${filtered.length}ê°œ í•­ëª©`);

      // í•„í„°ë§ëœ ë°ì´í„°ë¡œ ì§€ë„ ì—…ë°ì´íŠ¸
      renderRepairHistory(filtered);
    }

    // í´ë¦¬ê³¤ ì œê±°
    function clearPolygons() {
      polygons.forEach(polygon => polygon.setMap(null));
      polygons = [];
    }

    // ëª¨ë‹¬ ë‹«ê¸°
    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
      setActiveMenu(-1);
    }

    // ë³´ê³ ì„œ í‘œì‹œ
    function showReport() {
      alert('ì•ˆì „ ì ê²€ ë³´ê³ ì„œë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');
      document.getElementById('inspectionPopup').classList.remove('active');
    }

    // ì‚¬ì§„ í‘œì‹œ
    function showPhotos() {
      alert('ì ê²€ ì‚¬ì§„ì„ í‘œì‹œí•©ë‹ˆë‹¤.');
      document.getElementById('inspectionPopup').classList.remove('active');
    }

    // ë©”íƒ€í¬íŠ¸ ì—´ê¸°
    function openMetafort() {
      alert('ë©”íƒ€í¬íŠ¸ ë§í¬ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
      document.getElementById('inspectionPopup').classList.remove('active');
    }

    // í´ë¦­ ì‹œ íŒì—… ë‹«ê¸°
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.inspection-popup') && !e.target.closest('.gm-style')) {
        document.getElementById('inspectionPopup').classList.remove('active');
      }
    });

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          overlay.classList.remove('active');
          setActiveMenu(-1);
        }
      });
    });
  </script>

  <!-- Google Maps API -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA38pzCsLGAwnkQMIoKiWPqTw_a1XJE5W0&callback=initMap">
  </script>
</body>
</html>
