<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>대상지 상세 정보 | 전통조경 안전지도 시범서비스</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/reset.css">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-family);
      height: 100vh;
      overflow: hidden;
    }

    /* Map Container - 전체 화면 */
    #map {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 1;
    }

    /* Sidebar */
    .sidebar {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 100;
      width: 240px;
    }

    .sidebar__logo {
      display: inline-flex;
      align-items: center;
      padding: 10px 20px;
      background-color: var(--color-logo-bg);
      border-radius: var(--radius-full);
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-semibold);
      color: var(--color-logo-text);
      text-decoration: none;
      border: 1px solid #D4E8FF;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .sidebar__logo:hover {
      background-color: #D4E8FF;
    }

    .sidebar__menu {
      background: var(--color-bg-white);
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
      overflow: hidden;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 20px;
      font-size: var(--font-size-base);
      color: var(--color-text-primary);
      cursor: pointer;
      transition: all var(--transition-fast);
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      border-bottom: 1px solid #F0F0F0;
    }

    .menu-item:last-child {
      border-bottom: none;
    }

    .menu-item:hover {
      background: #F5F9FC;
    }

    .menu-item.active {
      background: var(--color-primary-light);
      color: var(--color-primary);
      font-weight: var(--font-weight-medium);
    }

    .menu-item__icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    /* Modal Overlay */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 200;
      display: none;
      justify-content: center;
      align-items: center;
    }

    .modal-overlay.active {
      display: flex;
    }

    /* Modal Content */
    .modal {
      background: var(--color-bg-white);
      border-radius: 12px;
      max-width: 900px;
      max-height: 85vh;
      width: 90%;
      overflow: hidden;
      box-shadow: 0 16px 48px rgba(0,0,0,0.2);
    }

    .modal__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 24px;
      border-bottom: 1px solid var(--color-border-light);
    }

    .modal__title {
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-semibold);
    }

    .modal__close {
      width: 32px;
      height: 32px;
      border: none;
      background: none;
      cursor: pointer;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background var(--transition-fast);
    }

    .modal__close:hover {
      background: #F0F0F0;
    }

    .modal__close svg {
      width: 20px;
      height: 20px;
    }

    .modal__body {
      padding: 24px;
      max-height: calc(85vh - 60px);
      overflow-y: auto;
    }

    /* 기본 정보 테이블 */
    .info-table {
      width: 100%;
      border-collapse: collapse;
      font-size: var(--font-size-sm);
    }

    .info-table th,
    .info-table td {
      padding: 12px 16px;
      border: 1px solid #E0E0E0;
      text-align: left;
    }

    .info-table th {
      background: #4A7A8C;
      color: white;
      font-weight: var(--font-weight-medium);
      width: 140px;
    }

    .info-table td {
      background: white;
    }

    .info-table .section-header {
      background: #5A8A9C;
      color: white;
      text-align: center;
      font-weight: var(--font-weight-semibold);
    }

    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .checkbox-item input {
      width: 16px;
      height: 16px;
    }

    .check-mark {
      display: inline-block;
      width: 12px;
      height: 12px;
      background: var(--color-primary);
      border-radius: 50%;
      margin-right: 6px;
    }

    /* 이력 오버레이 (재해/수리) */
    .history-overlay {
      position: absolute;
      top: 0;
      left: 260px;
      right: 0;
      bottom: 0;
      z-index: 50;
      pointer-events: none;
      display: none;
    }

    .history-overlay.active {
      display: block;
    }

    /* 상단 필터 바 */
    .filter-bar {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.95);
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: flex;
      gap: 16px;
      align-items: center;
      pointer-events: auto;
    }

    .filter-select {
      padding: 8px 12px;
      border: 1px solid #DDD;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
    }

    /* 범례 */
    .legend {
      position: absolute;
      bottom: 30px;
      right: 30px;
      background: var(--color-bg-white);
      border-radius: 8px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.15);
      padding: 16px;
      min-width: 160px;
      pointer-events: auto;
    }

    .legend__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      font-size: 14px;
      font-weight: var(--font-weight-semibold);
    }

    .legend__toggle {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    .legend__item {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .legend__item:last-child {
      margin-bottom: 0;
    }

    .legend__color {
      width: 16px;
      height: 16px;
      border-radius: 50%;
    }

    /* 재해 범례 색상 */
    .legend__color--disaster-high { background: #E53935; }
    .legend__color--disaster-mid { background: #FB8C00; }
    .legend__color--disaster-low { background: #FFD54F; }

    /* 수리 범례 색상 */
    .legend__color--repair-high { background: #8E24AA; }
    .legend__color--repair-mid { background: #AB47BC; }
    .legend__color--repair-low { background: #CE93D8; }

    /* 경고 배너 */
    .warning-banner {
      position: absolute;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      font-size: 13px;
      pointer-events: auto;
    }

    /* 점검 이력 팝업 */
    .inspection-popup {
      position: absolute;
      background: var(--color-bg-white);
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.2);
      padding: 16px;
      min-width: 200px;
      z-index: 150;
      display: none;
    }

    .inspection-popup.active {
      display: block;
    }

    .popup-item {
      padding: 10px 16px;
      cursor: pointer;
      border-radius: 6px;
      font-size: 14px;
      transition: background var(--transition-fast);
    }

    .popup-item:hover {
      background: #F5F5F5;
    }

    /* 점검 이력 마커들 */
    .inspection-markers {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      z-index: 60;
      display: none;
    }

    .inspection-markers.active {
      display: block;
    }

    /* 수리 이력 서브메뉴 */
    .repair-submenu {
      background: var(--color-bg-white);
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-top: 8px;
      overflow: hidden;
      display: none;
    }

    .repair-submenu.active {
      display: block;
    }

    .submenu-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 16px;
      font-size: 13px;
      color: var(--color-text-primary);
      cursor: pointer;
      transition: all var(--transition-fast);
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      border-bottom: 1px solid #F0F0F0;
    }

    .submenu-item:last-child {
      border-bottom: none;
    }

    .submenu-item:hover {
      background: #F5F9FC;
    }

    .submenu-item.active {
      background: var(--color-primary-light);
      color: var(--color-primary);
    }

    .submenu-item__radio {
      width: 16px;
      height: 16px;
      border: 2px solid #CCC;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .submenu-item.active .submenu-item__radio {
      border-color: var(--color-primary);
    }

    .submenu-item__radio-inner {
      width: 8px;
      height: 8px;
      background: var(--color-primary);
      border-radius: 50%;
      display: none;
    }

    .submenu-item.active .submenu-item__radio-inner {
      display: block;
    }
  </style>
</head>
<body>
  <!-- Google Map -->
  <div id="map"></div>

  <!-- Sidebar -->
  <div class="sidebar">
    <a href="index.html" class="sidebar__logo">전통조경 안전지도 시범서비스</a>

    <div class="sidebar__menu">
      <button class="menu-item" onclick="showBasicInfo()">
        <svg class="menu-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 16v-4"/>
          <path d="M12 8h.01"/>
        </svg>
        기본 정보
      </button>
      <button class="menu-item" onclick="showInspectionHistory()">
        <svg class="menu-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
          <line x1="16" y1="13" x2="8" y2="13"/>
          <line x1="16" y1="17" x2="8" y2="17"/>
        </svg>
        점검 이력
      </button>
      <button class="menu-item" onclick="showDisasterHistory()">
        <svg class="menu-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
        </svg>
        재해 이력
      </button>
      <button class="menu-item" onclick="showRepairHistory()">
        <svg class="menu-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
        </svg>
        수리 이력
      </button>
    </div>

    <!-- 수리 이력 서브메뉴 -->
    <div class="repair-submenu" id="repairSubmenu">
      <button class="submenu-item" onclick="selectRepairFilter('flood')">
        <span class="submenu-item__radio"><span class="submenu-item__radio-inner"></span></span>
        범람 위험 요소
      </button>
      <button class="submenu-item" onclick="selectRepairFilter('terrain')">
        <span class="submenu-item__radio"><span class="submenu-item__radio-inner"></span></span>
        인접 지형
      </button>
      <button class="submenu-item" onclick="selectRepairFilter('surrounding')">
        <span class="submenu-item__radio"><span class="submenu-item__radio-inner"></span></span>
        주변 영향
      </button>
      <button class="submenu-item" onclick="selectRepairFilter('elevation')">
        <span class="submenu-item__radio"><span class="submenu-item__radio-inner"></span></span>
        고저차
      </button>
      <button class="submenu-item" onclick="selectRepairFilter('hydraulic')">
        <span class="submenu-item__radio"><span class="submenu-item__radio-inner"></span></span>
        수리 조건
      </button>
      <button class="submenu-item" onclick="selectRepairFilter('rainfall')">
        <span class="submenu-item__radio"><span class="submenu-item__radio-inner"></span></span>
        강우 이력
      </button>
    </div>
  </div>

  <!-- 기본 정보 모달 -->
  <div class="modal-overlay" id="basicInfoModal">
    <div class="modal">
      <div class="modal__header">
        <h2 class="modal__title">기본 정보</h2>
        <button class="modal__close" onclick="closeModal('basicInfoModal')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18"/>
            <path d="M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="modal__body">
        <table class="info-table">
          <tr>
            <th rowspan="4" class="section-header">국가<br>유산<br>개요</th>
            <th>국가유산명</th>
            <td>창덕궁 낙선재 권역</td>
            <th rowspan="5" class="section-header">국가<br>유산<br>관리</th>
            <th>종합정비계획</th>
            <td><span class="check-mark"></span></td>
          </tr>
          <tr>
            <th>국가유산유형</th>
            <td>사적</td>
            <th>정기조사</th>
            <td><span class="check-mark"></span></td>
          </tr>
          <tr>
            <th>소재지</th>
            <td>서울특별시 종로구 율곡로 99-0</td>
            <th>돌봄사업</th>
            <td>-</td>
          </tr>
          <tr>
            <th>소유자/관리자</th>
            <td>국가유산청 창덕궁관리소</td>
            <th>모니터링</th>
            <td><span class="check-mark"></span></td>
          </tr>
          <tr>
            <th rowspan="6" class="section-header">주변<br>환경</th>
            <th>범람위험요소</th>
            <td colspan="2">
              <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" checked disabled> 강, 하천</label>
                <label class="checkbox-item"><input type="checkbox" disabled> 계곡</label>
                <label class="checkbox-item"><input type="checkbox" disabled> 저수지</label>
                <label class="checkbox-item"><input type="checkbox" disabled> 바다</label>
                <label class="checkbox-item"><input type="checkbox" disabled> 기타</label>
              </div>
            </td>
            <th>국가유산지킴이</th>
            <td><span class="check-mark"></span></td>
          </tr>
          <tr>
            <th>인접지형</th>
            <td colspan="4">
              <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" checked disabled> 경사</label>
                <label class="checkbox-item"><input type="checkbox" disabled> 옹벽</label>
                <label class="checkbox-item"><input type="checkbox" checked disabled> 전도위험</label>
                <label class="checkbox-item"><input type="checkbox" disabled> 절개지</label>
                <label class="checkbox-item"><input type="checkbox" disabled> 기타</label>
              </div>
            </td>
          </tr>
          <tr>
            <th>주변 영향</th>
            <td colspan="4">
              <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" disabled> 습해</label>
                <label class="checkbox-item"><input type="checkbox" disabled> 공해</label>
                <label class="checkbox-item"><input type="checkbox" disabled> 염해</label>
                <label class="checkbox-item"><input type="checkbox" disabled> 진동</label>
                <label class="checkbox-item"><input type="checkbox" disabled> 기타</label>
              </div>
            </td>
          </tr>
          <tr>
            <th>고저차</th>
            <td colspan="4">
              당해 국가유산이 주변지형에 비해 &nbsp;
              <label class="checkbox-item"><input type="checkbox" checked disabled> 낮음</label>
              <label class="checkbox-item"><input type="checkbox" disabled> 높음</label>
            </td>
          </tr>
          <tr>
            <th>수리조건</th>
            <td colspan="4">
              <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" checked disabled> dry</label>
                <label class="checkbox-item"><input type="checkbox" disabled> damp</label>
                <label class="checkbox-item"><input type="checkbox" disabled> wet</label>
                <label class="checkbox-item"><input type="checkbox" disabled> dripping</label>
                <label class="checkbox-item"><input type="checkbox" disabled> flowing</label>
              </div>
            </td>
          </tr>
          <tr>
            <th>강우이력</th>
            <td colspan="4">해당 지역 최근 10개년 최대 일강우강도 누년 평균값과 최근 2개년 최대 강우량</td>
          </tr>
        </table>
      </div>
    </div>
  </div>

  <!-- 재해 이력 오버레이 -->
  <div class="history-overlay" id="disasterOverlay">
    <div class="filter-bar">
      <select class="filter-select">
        <option>전통조경요소</option>
        <option>석축</option>
        <option>옹벽</option>
        <option>담장</option>
        <option>수목</option>
      </select>
      <select class="filter-select">
        <option>재해</option>
        <option>호우</option>
        <option>강풍</option>
        <option>태풍</option>
      </select>
      <select class="filter-select">
        <option>연도</option>
        <option>2023</option>
        <option>2022</option>
        <option>2021</option>
        <option>2020</option>
      </select>
    </div>
    <div class="warning-banner">
      ※ 본 지도의 조사 영역과 결과는 실제 조사 결과가 아닌 이해를 돕기 위한 예시 이미지 입니다
    </div>
    <div class="legend" id="disasterLegend">
      <div class="legend__header">
        재해 이력 범례
        <svg class="legend__toggle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 15l-6-6-6 6"/>
        </svg>
      </div>
      <div class="legend__item">
        <span class="legend__color legend__color--disaster-high"></span>
        10회 이상 발생
      </div>
      <div class="legend__item">
        <span class="legend__color legend__color--disaster-mid"></span>
        5회 이상 발생
      </div>
      <div class="legend__item">
        <span class="legend__color legend__color--disaster-low"></span>
        1회 이상 발생
      </div>
    </div>
  </div>

  <!-- 수리 이력 오버레이 -->
  <div class="history-overlay" id="repairOverlay">
    <div class="warning-banner">
      ※ 본 지도의 조사 영역과 결과는 실제 조사 결과가 아닌 이해를 돕기 위한 예시 이미지 입니다
    </div>
    <div class="legend" id="repairLegend">
      <div class="legend__header">
        수리 이력 범례
        <svg class="legend__toggle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 15l-6-6-6 6"/>
        </svg>
      </div>
      <div class="legend__item">
        <span class="legend__color legend__color--repair-high"></span>
        10회 이상
      </div>
      <div class="legend__item">
        <span class="legend__color legend__color--repair-mid"></span>
        5회 이상
      </div>
      <div class="legend__item">
        <span class="legend__color legend__color--repair-low"></span>
        1회 이상
      </div>
    </div>
  </div>

  <!-- 점검 이력 팝업 -->
  <div class="inspection-popup" id="inspectionPopup">
    <div class="popup-item" onclick="showReport()">안전 점검 보고서</div>
    <div class="popup-item" onclick="showPhotos()">사진</div>
    <div class="popup-item" onclick="openMetafort()">메타포트</div>
  </div>

  <!-- Config -->
  <script src="config.js"></script>

  <!-- 데이터 로더 및 GIS 렌더러 -->
  <script src="js/data-loader.js"></script>
  <script src="js/gis-renderer.js"></script>

  <script>
    let map;
    let mainMarker;
    let inspectionMarkers = [];
    let polygons = [];
    let currentMode = null;
    let inspectionsData = [];

    // 대상지 좌표 (창덕궁 낙선재)
    const siteInfo = DataLoader.getSiteInfo();
    const siteLocation = siteInfo.center;

    // 재해 이력 폴리곤 데이터 - 매우 작은 크기, 좁은 범위 (중심: 37.5795, 126.9910)
    const disasterPolygons = [
      // 고위험 (빨강) - 4개
      { paths: [
        { lat: 37.57962, lng: 126.99065 }, { lat: 37.57968, lng: 126.99072 },
        { lat: 37.57963, lng: 126.99078 }, { lat: 37.57957, lng: 126.99070 }
      ], color: '#E53935', level: 'high' },
      { paths: [
        { lat: 37.57985, lng: 126.99120 }, { lat: 37.57990, lng: 126.99125 }, { lat: 37.57992, lng: 126.99132 },
        { lat: 37.57986, lng: 126.99135 }, { lat: 37.57982, lng: 126.99128 }
      ], color: '#E53935', level: 'high' },
      { paths: [
        { lat: 37.57925, lng: 126.99085 }, { lat: 37.57932, lng: 126.99088 },
        { lat: 37.57930, lng: 126.99095 }, { lat: 37.57923, lng: 126.99092 }
      ], color: '#E53935', level: 'high' },
      { paths: [
        { lat: 37.57970, lng: 126.99145 }, { lat: 37.57976, lng: 126.99148 }, { lat: 37.57978, lng: 126.99154 },
        { lat: 37.57972, lng: 126.99156 }, { lat: 37.57968, lng: 126.99150 }
      ], color: '#E53935', level: 'high' },
      // 중위험 (주황) - 4개
      { paths: [
        { lat: 37.57945, lng: 126.99105 }, { lat: 37.57952, lng: 126.99108 },
        { lat: 37.57950, lng: 126.99115 }, { lat: 37.57943, lng: 126.99112 }
      ], color: '#FB8C00', level: 'mid' },
      { paths: [
        { lat: 37.57998, lng: 126.99095 }, { lat: 37.58003, lng: 126.99100 }, { lat: 37.58000, lng: 126.99107 },
        { lat: 37.57995, lng: 126.99102 }
      ], color: '#FB8C00', level: 'mid' },
      { paths: [
        { lat: 37.57938, lng: 126.99135 }, { lat: 37.57944, lng: 126.99138 }, { lat: 37.57946, lng: 126.99145 },
        { lat: 37.57940, lng: 126.99147 }, { lat: 37.57936, lng: 126.99140 }
      ], color: '#FB8C00', level: 'mid' },
      { paths: [
        { lat: 37.57978, lng: 126.99078 }, { lat: 37.57984, lng: 126.99082 },
        { lat: 37.57982, lng: 126.99088 }, { lat: 37.57976, lng: 126.99085 }
      ], color: '#FB8C00', level: 'mid' },
      // 저위험 (노랑) - 4개
      { paths: [
        { lat: 37.57955, lng: 126.99125 }, { lat: 37.57960, lng: 126.99128 },
        { lat: 37.57958, lng: 126.99134 }, { lat: 37.57953, lng: 126.99131 }
      ], color: '#FFD54F', level: 'low' },
      { paths: [
        { lat: 37.57990, lng: 126.99060 }, { lat: 37.57995, lng: 126.99063 }, { lat: 37.57993, lng: 126.99070 },
        { lat: 37.57988, lng: 126.99067 }
      ], color: '#FFD54F', level: 'low' },
      { paths: [
        { lat: 37.57918, lng: 126.99115 }, { lat: 37.57924, lng: 126.99118 }, { lat: 37.57926, lng: 126.99124 },
        { lat: 37.57920, lng: 126.99126 }, { lat: 37.57916, lng: 126.99120 }
      ], color: '#FFD54F', level: 'low' },
      { paths: [
        { lat: 37.57968, lng: 126.99098 }, { lat: 37.57973, lng: 126.99102 },
        { lat: 37.57970, lng: 126.99108 }, { lat: 37.57965, lng: 126.99104 }
      ], color: '#FFD54F', level: 'low' }
    ];

    // 수리 이력 폴리곤 데이터 - 매우 작은 크기, 좁은 범위 (중심: 37.5795, 126.9910)
    const repairPolygons = [
      // 수리 필요 높음 (보라) - 4개
      { paths: [
        { lat: 37.57942, lng: 126.99075 }, { lat: 37.57948, lng: 126.99080 },
        { lat: 37.57945, lng: 126.99087 }, { lat: 37.57939, lng: 126.99082 }
      ], color: '#8E24AA', level: 'high' },
      { paths: [
        { lat: 37.57975, lng: 126.99110 }, { lat: 37.57980, lng: 126.99115 }, { lat: 37.57982, lng: 126.99122 },
        { lat: 37.57976, lng: 126.99124 }, { lat: 37.57972, lng: 126.99117 }
      ], color: '#8E24AA', level: 'high' },
      { paths: [
        { lat: 37.57995, lng: 126.99082 }, { lat: 37.58000, lng: 126.99085 },
        { lat: 37.57998, lng: 126.99092 }, { lat: 37.57993, lng: 126.99089 }
      ], color: '#8E24AA', level: 'high' },
      { paths: [
        { lat: 37.57932, lng: 126.99140 }, { lat: 37.57938, lng: 126.99143 }, { lat: 37.57940, lng: 126.99150 },
        { lat: 37.57934, lng: 126.99152 }, { lat: 37.57930, lng: 126.99145 }
      ], color: '#8E24AA', level: 'high' },
      // 수리 필요 중간 (연보라) - 4개
      { paths: [
        { lat: 37.57958, lng: 126.99092 }, { lat: 37.57964, lng: 126.99095 },
        { lat: 37.57962, lng: 126.99102 }, { lat: 37.57956, lng: 126.99099 }
      ], color: '#AB47BC', level: 'mid' },
      { paths: [
        { lat: 37.57988, lng: 126.99135 }, { lat: 37.57993, lng: 126.99138 }, { lat: 37.57990, lng: 126.99145 },
        { lat: 37.57985, lng: 126.99142 }
      ], color: '#AB47BC', level: 'mid' },
      { paths: [
        { lat: 37.57922, lng: 126.99102 }, { lat: 37.57928, lng: 126.99105 }, { lat: 37.57930, lng: 126.99112 },
        { lat: 37.57924, lng: 126.99114 }, { lat: 37.57920, lng: 126.99107 }
      ], color: '#AB47BC', level: 'mid' },
      { paths: [
        { lat: 37.57965, lng: 126.99058 }, { lat: 37.57970, lng: 126.99062 },
        { lat: 37.57968, lng: 126.99068 }, { lat: 37.57963, lng: 126.99065 }
      ], color: '#AB47BC', level: 'mid' },
      // 수리 필요 낮음 (연한 보라) - 4개
      { paths: [
        { lat: 37.57948, lng: 126.99118 }, { lat: 37.57953, lng: 126.99122 },
        { lat: 37.57950, lng: 126.99128 }, { lat: 37.57945, lng: 126.99125 }
      ], color: '#CE93D8', level: 'low' },
      { paths: [
        { lat: 37.57982, lng: 126.99068 }, { lat: 37.57987, lng: 126.99072 }, { lat: 37.57985, lng: 126.99078 },
        { lat: 37.57980, lng: 126.99075 }
      ], color: '#CE93D8', level: 'low' },
      { paths: [
        { lat: 37.57935, lng: 126.99125 }, { lat: 37.57940, lng: 126.99128 }, { lat: 37.57942, lng: 126.99135 },
        { lat: 37.57936, lng: 126.99137 }, { lat: 37.57933, lng: 126.99130 }
      ], color: '#CE93D8', level: 'low' },
      { paths: [
        { lat: 37.58002, lng: 126.99115 }, { lat: 37.58007, lng: 126.99118 }, { lat: 37.58005, lng: 126.99125 },
        { lat: 37.58000, lng: 126.99122 }
      ], color: '#CE93D8', level: 'low' }
    ];

    // Google Maps 초기화
    async function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: siteLocation,
        zoom: siteInfo.zoom,
        mapTypeId: 'satellite',
        mapTypeControl: false,
        streetViewControl: false,
        fullscreenControl: false,
      });

      // GIS 렌더러 초기화
      GISRenderer.init(map);

      // 점검표 데이터 로드
      inspectionsData = await DataLoader.loadAllInspections();
      console.log(`점검표 ${inspectionsData.length}개 로드 완료`);

      // GIS 레이어 로드 (배경)
      const gisData = await DataLoader.loadAllGIS();
      await GISRenderer.renderAllLayers(gisData);
      console.log('GIS 레이어 로드 완료');
    }

    // 메뉴 활성화 상태 업데이트
    function setActiveMenu(index) {
      const menuItems = document.querySelectorAll('.menu-item');
      menuItems.forEach((item, i) => {
        item.classList.toggle('active', i === index);
      });
    }

    // 모든 오버레이 숨기기
    function hideAllOverlays() {
      document.getElementById('disasterOverlay').classList.remove('active');
      document.getElementById('repairOverlay').classList.remove('active');
      document.getElementById('repairSubmenu').classList.remove('active');
      clearPolygons();
      clearInspectionMarkers();
      currentMode = null;
    }

    // 기본 정보 표시
    function showBasicInfo() {
      hideAllOverlays();
      setActiveMenu(0);
      document.getElementById('basicInfoModal').classList.add('active');
    }

    // 점검 이력 표시
    function showInspectionHistory() {
      hideAllOverlays();
      setActiveMenu(1);
      currentMode = 'inspection';

      // 실제 점검표 데이터로 마커 생성
      if (inspectionsData && inspectionsData.length > 0) {
        GISRenderer.addAllInspectionMarkers(inspectionsData, (inspection) => {
          // 클릭 시 inspection-confirm.html로 이동
          window.location.href = `inspection-confirm.html?id=${inspection.id}`;
        });
      } else {
        console.warn('점검표 데이터가 없습니다.');
      }
    }

    // 점검 이력 팝업 표시
    function showInspectionPopup(x, y, point) {
      const popup = document.getElementById('inspectionPopup');
      popup.style.left = x + 'px';
      popup.style.top = y + 'px';
      popup.classList.add('active');
      popup.dataset.pointId = point.id;
    }

    // 점검 이력 마커 제거
    function clearInspectionMarkers() {
      GISRenderer.clearMarkers();
      document.getElementById('inspectionPopup').classList.remove('active');
    }

    // 재해 이력 표시
    function showDisasterHistory() {
      hideAllOverlays();
      setActiveMenu(2);
      currentMode = 'disaster';
      document.getElementById('disasterOverlay').classList.add('active');

      // 폴리곤 생성
      disasterPolygons.forEach(data => {
        const polygon = new google.maps.Polygon({
          paths: data.paths,
          strokeColor: data.color,
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: data.color,
          fillOpacity: 0.5,
          map: map
        });
        polygons.push(polygon);
      });
    }

    // 수리 이력 표시
    function showRepairHistory() {
      hideAllOverlays();
      setActiveMenu(3);
      currentMode = 'repair';
      document.getElementById('repairOverlay').classList.add('active');
      document.getElementById('repairSubmenu').classList.add('active');

      // 폴리곤 생성
      repairPolygons.forEach(data => {
        const polygon = new google.maps.Polygon({
          paths: data.paths,
          strokeColor: data.color,
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: data.color,
          fillOpacity: 0.5,
          map: map
        });
        polygons.push(polygon);
      });
    }

    // 수리 이력 서브메뉴 필터 선택
    function selectRepairFilter(filterType) {
      // 모든 서브메뉴 아이템 비활성화
      document.querySelectorAll('.submenu-item').forEach(item => {
        item.classList.remove('active');
      });
      // 클릭한 아이템 활성화
      event.currentTarget.classList.add('active');

      // 필터 타입에 따른 동작 (추후 데이터 연동 시 구현)
      console.log('선택된 필터:', filterType);
    }

    // 폴리곤 제거
    function clearPolygons() {
      polygons.forEach(polygon => polygon.setMap(null));
      polygons = [];
    }

    // 모달 닫기
    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
      setActiveMenu(-1);
    }

    // 보고서 표시
    function showReport() {
      alert('안전 점검 보고서를 표시합니다.');
      document.getElementById('inspectionPopup').classList.remove('active');
    }

    // 사진 표시
    function showPhotos() {
      alert('점검 사진을 표시합니다.');
      document.getElementById('inspectionPopup').classList.remove('active');
    }

    // 메타포트 열기
    function openMetafort() {
      alert('메타포트 링크로 이동합니다.');
      document.getElementById('inspectionPopup').classList.remove('active');
    }

    // 클릭 시 팝업 닫기
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.inspection-popup') && !e.target.closest('.gm-style')) {
        document.getElementById('inspectionPopup').classList.remove('active');
      }
    });

    // 모달 외부 클릭 시 닫기
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          overlay.classList.remove('active');
          setActiveMenu(-1);
        }
      });
    });
  </script>

  <!-- Google Maps API -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA38pzCsLGAwnkQMIoKiWPqTw_a1XJE5W0&callback=initMap">
  </script>
</body>
</html>
